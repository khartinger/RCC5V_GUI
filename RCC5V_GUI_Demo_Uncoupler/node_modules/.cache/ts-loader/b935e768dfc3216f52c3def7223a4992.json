{"remainingRequest":"G:\\work3\\vue\\haus3\\node_modules\\thread-loader\\dist\\cjs.js!G:\\work3\\vue\\haus3\\node_modules\\ts-loader\\index.js??ref--13-2!G:\\work3\\vue\\haus3\\src\\controller\\CiWindow1Controller.ts","dependencies":[{"path":"G:\\work3\\vue\\haus3\\src\\controller\\CiWindow1Controller.ts","mtime":1677095295828},{"path":"G:\\work3\\vue\\haus3\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus3\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus3\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgX19leHRlbmRzIH0gZnJvbSAidHNsaWIiOw0KLy8gX19fX19fQ2lXaW5kb3cxQ29udHJvbGxlci50c19fX19fX19fX19fX19fX19fX2toYXJ0aW5nZXJfX19fXw0KLy8gMjAyMi0wMS0wODogbmV3DQovLyAyMDIzLTAyLTIwOiBjaGFuZ2UgYXQgQ2lCYXNlIChhZGQgR2VvLnRzKQ0KaW1wb3J0IHsgcmVhY3RpdmUgfSBmcm9tICd2dWUnOw0KaW1wb3J0IHsgQ2lCYXNlQ29udHJvbGxlciB9IGZyb20gJy4vQ2lCYXNlQ29udHJvbGxlcic7DQp2YXIgQ2lXaW5kb3cxQ29udHJvbGxlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsNCiAgICBfX2V4dGVuZHMoQ2lXaW5kb3cxQ29udHJvbGxlciwgX3N1cGVyKTsNCiAgICBmdW5jdGlvbiBDaVdpbmRvdzFDb250cm9sbGVyKCkgew0KICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsNCiAgICAgICAgX3RoaXMud2luZG93MXMgPSByZWFjdGl2ZShbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWQ6ICd3aW5fc2wzXzEnLA0KICAgICAgICAgICAgICAgIG5hbWU6ICdLaXBwZmVuc3RlcicsDQogICAgICAgICAgICAgICAgaVdpbmRvdzFTdGF0ZTogLTEsDQogICAgICAgICAgICAgICAgdHlwZTogJ3piJywNCiAgICAgICAgICAgICAgICBiYXR0ZXJ5OiAnLScsDQogICAgICAgICAgICAgICAgc3ViVG9waWM6ICd6Yi9oL28yL3NsL2ZlbnN0ZXIvLTEnLA0KICAgICAgICAgICAgICAgIHB1YlRvcGljOiAnJw0KICAgICAgICAgICAgfQ0KICAgICAgICBdKTsNCiAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS1zdGF0ZSBjb25zdGFudHMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgX3RoaXMuc3RhdGVPcGVuID0gLTE7DQogICAgICAgIF90aGlzLnN0YXRlQ2xvc2UgPSAtMjsNCiAgICAgICAgX3RoaXMuc3RhdGVMb2NrID0gLTM7DQogICAgICAgIF90aGlzLnN0YXRlTm90T2sgPSAtOTk4Ow0KICAgICAgICBfdGhpcy5zdGF0ZU5vU3RhdGUgPSAtOTk5Ow0KICAgICAgICByZXR1cm4gX3RoaXM7DQogICAgfQ0KICAgIENpV2luZG93MUNvbnRyb2xsZXIucHJvdG90eXBlLm9uTWVzc2FnZSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7DQogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7DQogICAgICAgIHRoaXMud2luZG93MXMuZm9yRWFjaChmdW5jdGlvbiAod2luZG93MSkgew0KICAgICAgICAgICAgdmFyIGFTdWJUb3BpYyA9IHdpbmRvdzEuc3ViVG9waWMuc3BsaXQoJyAnKTsNCiAgICAgICAgICAgIGlmIChhU3ViVG9waWMuaW5jbHVkZXMobWVzc2FnZS50b3BpYykpIHsNCiAgICAgICAgICAgICAgICAvLyAtLS13aW5kb3cxIHRvcGljIGZvdW5kIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgICAgICAgICAgaWYgKHdpbmRvdzEudHlwZSA9PT0gJ3piJykgew0KICAgICAgICAgICAgICAgICAgICAvLyAtLS13aW5kb3cgdHlwZSAxLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYVBheWxvYWQgPSBKU09OLnBhcnNlKG1lc3NhZ2UucGF5bG9hZCk7DQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cxLmJhdHRlcnkgPSAiIiArIGFQYXlsb2FkLmJhdHRlcnk7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgd2luZG93c3RhdGVfID0gU3RyaW5nKGFQYXlsb2FkLmNvbnRhY3QpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvd3N0YXRlXyA9PT0gJ3RydWUnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdzEuaVdpbmRvdzFTdGF0ZSA9IF90aGlzLnN0YXRlQ2xvc2U7DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93c3RhdGVfID09PSAnZmFsc2UnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cxLmlXaW5kb3cxU3RhdGUgPSBfdGhpcy5zdGF0ZU9wZW47DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cxLmlXaW5kb3cxU3RhdGUgPSBfdGhpcy5zdGF0ZU5vdE9rOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNhdGNoIChlcnJvcikgeyB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICh3aW5kb3cxLnR5cGUgPT09ICdEMScpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gLS0td2luZG93IHR5cGUgMi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS50b3BpYy5pbmNsdWRlcygnc3RhdHVzJykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgobWVzc2FnZS5wYXlsb2FkID09PSAnMScpIHx8IChtZXNzYWdlLnBheWxvYWQgPT09ICdvbicpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdzEuaVdpbmRvdzFTdGF0ZSA9IF90aGlzLnN0YXRlT3BlbjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgobWVzc2FnZS5wYXlsb2FkID09PSAnMCcpIHx8IChtZXNzYWdlLnBheWxvYWQgPT09ICdvZmYnKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93MS5pV2luZG93MVN0YXRlID0gX3RoaXMuc3RhdGVDbG9zZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucGF5bG9hZCA9PT0gJy0xJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdzEuaVdpbmRvdzFTdGF0ZSA9IF90aGlzLnN0YXRlTG9jazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93MS5pV2luZG93MVN0YXRlID0gX3RoaXMuc3RhdGVOb3RPazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudG9waWMuaW5jbHVkZXMoJ3ZvbHRhZ2UnKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93MS5iYXR0ZXJ5ID0gIiIgKyBtZXNzYWdlLnBheWxvYWQ7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gLS0td2luZG93IHR5cGUgMy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAgICAgICAgIGlmICh3aW5kb3cxLnR5cGUgPT09ICdzb21ldGhpbmdfZWxzZScpIHsNCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC4uLmFkZCBmdW5jdGlvbmFsaXR5IGZvciBhbm90aGVyIHNlbnNvciBoZXJlLi4uDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7IH0NCiAgICAgICAgICAgICAgICB9IC8vIC0tLS0tLUVORCB3b3JrIG9uIGRpZmZlcmVudCB3aW5kb3cxIHR5cGVzLS0tLS0tLS0tLS0tDQogICAgICAgICAgICAgICAgLy8gLS0tRU5EIHdpbmRvdzEgdG9waWMgZm91bmQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9Ow0KICAgIENpV2luZG93MUNvbnRyb2xsZXIucHJvdG90eXBlLnB1Ymxpc2hDaSA9IGZ1bmN0aW9uICh0b3BpYywgcGF5bG9hZCkgew0KICAgICAgICAvLyBjb25zb2xlLmxvZygnQ2lXaW5kb3cxQ29udHJvbGxlcjpwdWJsaXNoQ2k6JywgJy10ICcgKyB0b3BpYyArICcgLW0gJyArIHBheWxvYWQpDQogICAgICAgIHRoaXMucHVibGlzaCh0b3BpYywgcGF5bG9hZCwgZmFsc2UsIDApLmNhdGNoKGZ1bmN0aW9uIChlKSB7IGNvbnNvbGUuZXJyb3IoJ0NpV2luZG93MUNvbnRyb2xsZXI6IEVSUk9SOicsIGUpOyB9KTsNCiAgICB9Ow0KICAgIHJldHVybiBDaVdpbmRvdzFDb250cm9sbGVyOw0KfShDaUJhc2VDb250cm9sbGVyKSk7DQpleHBvcnQgeyBDaVdpbmRvdzFDb250cm9sbGVyIH07DQpleHBvcnQgdmFyIGNpV2luZG93MUNvbnRyb2xsZXIgPSBuZXcgQ2lXaW5kb3cxQ29udHJvbGxlcigpOw0K"},{"version":3,"file":"G:\\work3\\vue\\haus3\\src\\controller\\CiWindow1Controller.ts","sourceRoot":"","sources":["G:\\work3\\vue\\haus3\\src\\controller\\CiWindow1Controller.ts"],"names":[],"mappings":"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","sourcesContent":["// ______CiWindow1Controller.ts__________________khartinger_____\r\n// 2022-01-08: new\r\n// 2023-02-20: change at CiBase (add Geo.ts)\r\nimport { reactive } from 'vue'\r\nimport { Message } from '@/services/CiMqttClient'\r\nimport { CiBaseController, IBase } from './CiBaseController'\r\n\r\nexport interface Window1 extends IBase {\r\n  // ---------mandatory-----------------------------------------\r\n  iWindow1State: number;\r\n  type: string;\r\n  // ---------optional------------------------------------------\r\n  battery?: string;\r\n  textHeader?: string;\r\n  textFooter?: string;\r\n}\r\n\r\nexport class CiWindow1Controller extends CiBaseController {\r\n  public window1s: Array<Window1> = reactive(\r\n    [\r\n      { // ---1. Stock: Bereich 2, Schlafzimmer-----------------\r\n        id: 'win_sl3_1',\r\n        name: 'Kippfenster',\r\n        iWindow1State: -1,\r\n        type: 'zb',\r\n        battery: '-',\r\n        subTopic: 'zb/h/o2/sl/fenster/-1',\r\n        pubTopic: ''\r\n      }\r\n    ]\r\n  );\r\n\r\n  // --------------state constants------------------------------\r\n  public stateOpen = -1;\r\n  public stateClose = -2;\r\n  public stateLock = -3;\r\n  public stateNotOk = -998;\r\n  public stateNoState = -999;\r\n\r\n  public onMessage (message: Message): void {\r\n    this.window1s.forEach(window1 => {\r\n      const aSubTopic = window1.subTopic.split(' ')\r\n      if (aSubTopic.includes(message.topic)) {\r\n        // ---window1 topic found --------------------------------\r\n        if (window1.type === 'zb') {\r\n        // ---window type 1---------------------------------------\r\n          try {\r\n            const aPayload = JSON.parse(message.payload)\r\n            window1.battery = `${aPayload.battery}`\r\n            const windowstate_ = String(aPayload.contact)\r\n            if (windowstate_ === 'true') window1.iWindow1State = this.stateClose\r\n            else {\r\n              if (windowstate_ === 'false') window1.iWindow1State = this.stateOpen\r\n              else window1.iWindow1State = this.stateNotOk\r\n            }\r\n          } catch (error) { }\r\n        }\r\n        if (window1.type === 'D1') {\r\n        // ---window type 2---------------------------------------\r\n          if (message.topic.includes('status')) {\r\n            if ((message.payload === '1') || (message.payload === 'on')) window1.iWindow1State = this.stateOpen\r\n            else {\r\n              if ((message.payload === '0') || (message.payload === 'off')) window1.iWindow1State = this.stateClose\r\n              else {\r\n                if (message.payload === '-1') window1.iWindow1State = this.stateLock\r\n                else window1.iWindow1State = this.stateNotOk\r\n              }\r\n            }\r\n          }\r\n          if (message.topic.includes('voltage')) {\r\n            window1.battery = `${message.payload}`\r\n          }\r\n        }\r\n        // ---window type 3---------------------------------------\r\n        if (window1.type === 'something_else') {\r\n          try {\r\n            // ...add functionality for another sensor here...\r\n          } catch (error) { }\r\n        } // ------END work on different window1 types------------\r\n        // ---END window1 topic found ----------------------------\r\n      }\r\n    })\r\n  }\r\n\r\n  public publishCi (topic: string, payload: string): void {\r\n    // console.log('CiWindow1Controller:publishCi:', '-t ' + topic + ' -m ' + payload)\r\n    this.publish(topic, payload, false, 0).catch((e) => { console.error('CiWindow1Controller: ERROR:', e) })\r\n  }\r\n}\r\n\r\nexport const ciWindow1Controller = new CiWindow1Controller()\r\n"]}]}