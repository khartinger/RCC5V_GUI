{"remainingRequest":"G:\\work3\\vue\\haus3\\node_modules\\thread-loader\\dist\\cjs.js!G:\\work3\\vue\\haus3\\node_modules\\ts-loader\\index.js??ref--13-2!G:\\work3\\vue\\haus3\\src\\controller\\CiRepeater1Controller.ts","dependencies":[{"path":"G:\\work3\\vue\\haus3\\src\\controller\\CiRepeater1Controller.ts","mtime":1677938756617},{"path":"G:\\work3\\vue\\haus3\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus3\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus3\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgX19leHRlbmRzIH0gZnJvbSAidHNsaWIiOw0KLy8gX19fX19fQ2lSZXBlYXRlcjFDb250cm9sbGVyLnRzX19fX19fX19fX19fX19fX2toYXJ0aW5nZXJfX19fXw0KLy8gMjAyMi0xMC0xOTogbmV3DQovLyAyMDIzLTAyLTEwOiBjaGFuZ2UgYXQgQ2lCYXNlIChhZGQgR2VvLnRzKQ0KaW1wb3J0IHsgcmVhY3RpdmUgfSBmcm9tICd2dWUnOw0KaW1wb3J0IHsgQ2lCYXNlQ29udHJvbGxlciB9IGZyb20gJy4vQ2lCYXNlQ29udHJvbGxlcic7DQppbXBvcnQgeyBnZW8wZiB9IGZyb20gJy4uL2NsYXNzZXMvR2VvJzsNCnZhciBDaVJlcGVhdGVyMUNvbnRyb2xsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7DQogICAgX19leHRlbmRzKENpUmVwZWF0ZXIxQ29udHJvbGxlciwgX3N1cGVyKTsNCiAgICBmdW5jdGlvbiBDaVJlcGVhdGVyMUNvbnRyb2xsZXIoKSB7DQogICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOw0KICAgICAgICBfdGhpcy5yZXBlYXRlcjFzID0gcmVhY3RpdmUoWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlkOiAncmVwZWF0ZXIxJywNCiAgICAgICAgICAgICAgICBuYW1lOiAnUmVwZWF0MSBJS0VBJywNCiAgICAgICAgICAgICAgICB0eXBlOiAnVFJBREZSSScsDQogICAgICAgICAgICAgICAgaVJlcGVhdGVyMVN0YXRlOiAtOTksDQogICAgICAgICAgICAgICAgbGFzdFJlcGVhdGVyMURhdGU6ICdEYXRlPycsDQogICAgICAgICAgICAgICAgbGFzdFJlcGVhdGVyMVRpbWU6ICdUaW1lPycsDQogICAgICAgICAgICAgICAgc3ViVG9waWM6ICd6Yi9oL2UxL2t1L3JlcGVhdGVyIHpiL2gvZTEva3UvcmVwZWF0ZXIvdGltZScsDQogICAgICAgICAgICAgICAgcHViVG9waWM6ICcnDQogICAgICAgICAgICB9DQogICAgICAgIF0pOw0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLXN0YXRlIGNvbnN0YW50cy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBfdGhpcy5zdGF0ZU9rID0gLTE7DQogICAgICAgIF90aGlzLnN0YXRlTGFzdFNlZW4gPSAtMjsNCiAgICAgICAgX3RoaXMuc3RhdGVOb3RPayA9IC05OTg7DQogICAgICAgIF90aGlzLnN0YXRlTm9TdGF0ZSA9IC05OTk7DQogICAgICAgIHJldHVybiBfdGhpczsNCiAgICB9DQogICAgLy8gLS0tLS0tLS0tLS0tLS1NZXNzYWdlIGZvciB0aGlzIGNpIChjb250cm9sL2luZGljYXRvcik/LS0tLS0NCiAgICBDaVJlcGVhdGVyMUNvbnRyb2xsZXIucHJvdG90eXBlLm9uTWVzc2FnZSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7DQogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7DQogICAgICAgIHRoaXMucmVwZWF0ZXIxcy5mb3JFYWNoKGZ1bmN0aW9uIChyZXBlYXRlcjEpIHsNCiAgICAgICAgICAgIHZhciBhU3ViVG9waWMgPSByZXBlYXRlcjEuc3ViVG9waWMuc3BsaXQoJyAnKTsNCiAgICAgICAgICAgIGlmIChhU3ViVG9waWMuaW5jbHVkZXMobWVzc2FnZS50b3BpYykpIHsNCiAgICAgICAgICAgICAgICAvLyAtLS0tLS0tLXJlcGVhdGVyMSB0b3BpYyBmb3VuZCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnb25NZXNzYWdlOicsIG1lc3NhZ2UudG9waWMsICcsIHBheWxvYWQnLCBtZXNzYWdlLnBheWxvYWQpDQogICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudG9waWMuaW5jbHVkZXMoJ3RpbWUnKSkgew0KICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLS1icm9rZXJ0aW1lIHl5eXltbWRkIEhITU1TUyByZWNlaXZlZD8tLS0tLS0tLS0NCiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucGF5bG9hZC5sZW5ndGggPT09IDE1KSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXRlcjEubGFzdFJlcGVhdGVyMURhdGUgPSBtZXNzYWdlLnBheWxvYWQuc3Vic3RyaW5nKDYsIDgpICsgJy4nICsgbWVzc2FnZS5wYXlsb2FkLnN1YnN0cmluZyg0LCA2KSArICcuJyArIG1lc3NhZ2UucGF5bG9hZC5zdWJzdHJpbmcoMiwgNCk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXRlcjEubGFzdFJlcGVhdGVyMVRpbWUgPSBtZXNzYWdlLnBheWxvYWQuc3Vic3RyaW5nKDksIDExKSArICc6JyArIG1lc3NhZ2UucGF5bG9hZC5zdWJzdHJpbmcoMTEsIDEzKSArICc6JyArIG1lc3NhZ2UucGF5bG9hZC5zdWJzdHJpbmcoMTMsIDE1KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdGVyMS5pUmVwZWF0ZXIxU3RhdGUgPSBfdGhpcy5zdGF0ZU9rOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0ZXIxLmxhc3RSZXBlYXRlcjFEYXRlID0gZ2VvMGYubm9EYXRlOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0ZXIxLmxhc3RSZXBlYXRlcjFUaW1lID0gZ2VvMGYubm9UaW1lOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tLUVORCBicm9rZXJ0aW1lIHl5eXltbWRkIEhITU1TUyByZWNlaXZlZD8tLS0tLQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0td29yayBvbiBkaWZmZXJlbnQgcmVwZWF0ZXIgdHlwZXMtLS0tLS0tLS0tLS0tDQogICAgICAgICAgICAgICAgICAgIHJlcGVhdGVyMS5pUmVwZWF0ZXIxU3RhdGUgPSBfdGhpcy5zdGF0ZU5vdE9rOw0KICAgICAgICAgICAgICAgICAgICByZXBlYXRlcjEubGFzdFJlcGVhdGVyMURhdGUgPSBnZW8wZi5ub0RhdGU7DQogICAgICAgICAgICAgICAgICAgIHJlcGVhdGVyMS5sYXN0UmVwZWF0ZXIxVGltZSA9IGdlbzBmLm5vVGltZTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcGVhdGVyMS50eXBlID09PSAnVFJBREZSSScpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFQYXlsb2FkID0gSlNPTi5wYXJzZShtZXNzYWdlLnBheWxvYWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHsibGFzdF9zZWVuIjoiMjAyMi0xMC0xOVQxNzowMzowMCswMjowMCIsImxpbmtxdWFsaXR5Ijo3MiwidXBkYXRlIjp7InN0YXRlIjoiaWRsZSJ9LCJ1cGRhdGVfYXZhaWxhYmxlIjpmYWxzZX0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYVBheWxvYWQubGFzdF9zZWVuLmxlbmd0aCA+IDI0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkdCA9IGFQYXlsb2FkLmxhc3Rfc2VlbjsgLy8gImxhc3Rfc2VlbiI6IjIwMjItMTAtMTlUMTc6MDM6MDArMDI6MDAiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRlMSA9IGR0LnN1YnN0cmluZyg4LCAxMCkgKyAnLicgKyBkdC5zdWJzdHJpbmcoNSwgNykgKyAnLicgKyBkdC5zdWJzdHJpbmcoMiwgNCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdGVyMS5sYXN0UmVwZWF0ZXIxRGF0ZSA9IGRhdGUxOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXRlcjEubGFzdFJlcGVhdGVyMVRpbWUgPSBkdC5zdWJzdHJpbmcoMTEsIDE5KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxxaVBlcmNlbnQgPSBNYXRoLnJvdW5kKGFQYXlsb2FkLmxpbmtxdWFsaXR5ICogMTAwIC8gMjU1KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0ZXIxLmxpbmtxdWFsaXR5ID0gJyBsaW5rICcgKyAoIiIgKyBscWlQZXJjZW50KSArICclID0gJyArICgiIiArIGFQYXlsb2FkLmxpbmtxdWFsaXR5KSArICcgbHFpJzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0ZXIxLmlSZXBlYXRlcjFTdGF0ZSA9IF90aGlzLnN0YXRlTGFzdFNlZW47DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdSZXBlYXRlcjonLCBhUGF5bG9hZC5sYXN0X3NlZW4gKyAnID0gJyArIGRhdGUxICsgJyAnICsgZHQuc3Vic3RyaW5nKDExLCAxOSkgKyAnIHN0YXRlPScgKyByZXBlYXRlcjEuaVJlcGVhdGVyMVN0YXRlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdGVyMS5sYXN0UmVwZWF0ZXIxRGF0ZSA9ICdFUlJPUic7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0ZXIxLmxhc3RSZXBlYXRlcjFUaW1lID0gJ2pzb24nOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvbk1lc3NhZ2UgZXJyb3I9JywgZXJyb3IpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChyZXBlYXRlcjEudHlwZSA9PT0gJ3NvbWV0aGluZ19lbHNlJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAuLi5hZGQgZnVuY3Rpb25hbGl0eSBmb3IgYW5vdGhlciBzZW5zb3IgaGVyZS4uLg0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7IH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0gLy8gLS0tLS0tRU5EIHdvcmsgb24gZGlmZmVyZW50IHJlcGVhdGVyIHR5cGVzLS0tLS0tLS0tLQ0KICAgICAgICAgICAgfSAvLyAtLS0tLS0tLUVORCByZXBlYXRlcjEgdG9waWMgZm91bmQtLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgfSk7DQogICAgfTsNCiAgICBDaVJlcGVhdGVyMUNvbnRyb2xsZXIucHJvdG90eXBlLnB1Ymxpc2hDaSA9IGZ1bmN0aW9uICh0b3BpYywgcGF5bG9hZCkgew0KICAgICAgICAvLyBjb25zb2xlLmxvZygncHVibGlzaDonLCAnLXQgJyArIHRvcGljICsgJyAtbSAnICsgcGF5bG9hZCkNCiAgICAgICAgdGhpcy5wdWJsaXNoKHRvcGljLCBwYXlsb2FkLCBmYWxzZSwgMCkuY2F0Y2goZnVuY3Rpb24gKGUpIHsgY29uc29sZS5lcnJvcignQ2lSZXBlYXRlckNvbnRyb2xsZXI6IEVSUk9SOicsIGUpOyB9KTsNCiAgICB9Ow0KICAgIHJldHVybiBDaVJlcGVhdGVyMUNvbnRyb2xsZXI7DQp9KENpQmFzZUNvbnRyb2xsZXIpKTsNCmV4cG9ydCB7IENpUmVwZWF0ZXIxQ29udHJvbGxlciB9Ow0KZXhwb3J0IHZhciBjaVJlcGVhdGVyMUNvbnRyb2xsZXIgPSBuZXcgQ2lSZXBlYXRlcjFDb250cm9sbGVyKCk7DQo="},{"version":3,"file":"G:\\work3\\vue\\haus3\\src\\controller\\CiRepeater1Controller.ts","sourceRoot":"","sources":["G:\\work3\\vue\\haus3\\src\\controller\\CiRepeater1Controller.ts"],"names":[],"mappings":";AAAA,gEAAgE;AAChE,kBAAkB;AAClB,4CAA4C;AAC5C,OAAO,EAAE,QAAQ,EAAE,MAAM,KAAK,CAAA;AAE9B,OAAO,EAAE,gBAAgB,EAAS,MAAM,oBAAoB,CAAA;AAC5D,OAAO,EAAE,KAAK,EAAE,MAAM,gBAAgB,CAAA;AAatC;IAA2C,yCAAgB;IAA3D;QAAA,qEA+EC;QA9EQ,gBAAU,GAAqB,QAAQ,CAC5C;YACE;gBACE,EAAE,EAAE,WAAW;gBACf,IAAI,EAAE,cAAc;gBACpB,IAAI,EAAE,SAAS;gBACf,eAAe,EAAE,CAAC,EAAE;gBACpB,iBAAiB,EAAE,OAAO;gBAC1B,iBAAiB,EAAE,OAAO;gBAC1B,QAAQ,EAAE,8CAA8C;gBACxD,QAAQ,EAAE,EAAE;aACb;SACF,CACF,CAAC;QAEF,8DAA8D;QACvD,aAAO,GAAG,CAAC,CAAC,CAAC;QACb,mBAAa,GAAG,CAAC,CAAC,CAAC;QACnB,gBAAU,GAAG,CAAC,GAAG,CAAC;QAClB,kBAAY,GAAG,CAAC,GAAG,CAAC;;IA2D7B,CAAC;IAzDC,8DAA8D;IACvD,yCAAS,GAAhB,UAAkB,OAAgB;QAAlC,iBAkDC;QAjDC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,UAAA,SAAS;YAC/B,IAAM,SAAS,GAAG,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;YAC/C,IAAI,SAAS,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBACrC,yDAAyD;gBACzD,yEAAyE;gBACzE,IAAI,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;oBAClC,sDAAsD;oBACtD,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,KAAK,EAAE,EAAE;wBACjC,SAAS,CAAC,iBAAiB,GAAG,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,GAAG,GAAG,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,GAAG,GAAG,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;wBAC7I,SAAS,CAAC,iBAAiB,GAAG,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC,GAAG,GAAG,GAAG,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE,EAAE,EAAE,CAAC,GAAG,GAAG,GAAG,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE,EAAE,EAAE,CAAC,CAAA;wBAClJ,SAAS,CAAC,eAAe,GAAG,KAAI,CAAC,OAAO,CAAA;qBACzC;yBAAM;wBACL,SAAS,CAAC,iBAAiB,GAAG,KAAK,CAAC,MAAM,CAAA;wBAC1C,SAAS,CAAC,iBAAiB,GAAG,KAAK,CAAC,MAAM,CAAA;qBAC3C;oBACD,sDAAsD;iBACvD;qBAAM;oBACL,sDAAsD;oBACtD,SAAS,CAAC,eAAe,GAAG,KAAI,CAAC,UAAU,CAAA;oBAC3C,SAAS,CAAC,iBAAiB,GAAG,KAAK,CAAC,MAAM,CAAA;oBAC1C,SAAS,CAAC,iBAAiB,GAAG,KAAK,CAAC,MAAM,CAAA;oBAC1C,IAAI,SAAS,CAAC,IAAI,KAAK,SAAS,EAAE;wBAChC,IAAI;4BACF,IAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,CAAA;4BAC5C,gHAAgH;4BAChH,IAAI,QAAQ,CAAC,SAAS,CAAC,MAAM,GAAG,EAAE,EAAE;gCAClC,IAAM,EAAE,GAAG,QAAQ,CAAC,SAAS,CAAA,CAAC,0CAA0C;gCACxE,IAAM,KAAK,GAAG,EAAE,CAAC,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC,GAAG,GAAG,GAAG,EAAE,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,GAAG,GAAG,EAAE,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;gCACvF,SAAS,CAAC,iBAAiB,GAAG,KAAK,CAAA;gCACnC,SAAS,CAAC,iBAAiB,GAAG,EAAE,CAAC,SAAS,CAAC,EAAE,EAAE,EAAE,CAAC,CAAA;gCAClD,IAAM,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,WAAW,GAAG,GAAG,GAAG,GAAG,CAAC,CAAA;gCAC/D,SAAS,CAAC,WAAW,GAAG,QAAQ,IAAG,KAAG,UAAY,CAAA,GAAG,MAAM,IAAG,KAAG,QAAQ,CAAC,WAAa,CAAA,GAAG,MAAM,CAAA;gCAChG,SAAS,CAAC,eAAe,GAAG,KAAI,CAAC,aAAa,CAAA;gCAC9C,oIAAoI;6BACrI;yBACF;wBAAC,OAAO,KAAK,EAAE;4BACd,SAAS,CAAC,iBAAiB,GAAG,OAAO,CAAA;4BACrC,SAAS,CAAC,iBAAiB,GAAG,MAAM,CAAA;4BACpC,OAAO,CAAC,GAAG,CAAC,kBAAkB,EAAE,KAAK,CAAC,CAAA;yBACvC;qBACF;oBACD,IAAI,SAAS,CAAC,IAAI,KAAK,gBAAgB,EAAE;wBACvC,IAAI;4BACF,kDAAkD;yBACnD;wBAAC,OAAO,KAAK,EAAE,GAAG;qBACpB;iBACF,CAAC,uDAAuD;aAC1D,CAAC,yDAAyD;QAC7D,CAAC,CAAC,CAAA;IACJ,CAAC;IAEM,yCAAS,GAAhB,UAAkB,KAAa,EAAE,OAAe;QAC9C,4DAA4D;QAC5D,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,UAAC,CAAC,IAAO,OAAO,CAAC,KAAK,CAAC,8BAA8B,EAAE,CAAC,CAAC,CAAA,CAAC,CAAC,CAAC,CAAA;IAC3G,CAAC;IACH,4BAAC;AAAD,CAAC,AA/ED,CAA2C,gBAAgB,GA+E1D;;AAED,MAAM,CAAC,IAAM,qBAAqB,GAAG,IAAI,qBAAqB,EAAE,CAAA","sourcesContent":["// ______CiRepeater1Controller.ts________________khartinger_____\r\n// 2022-10-19: new\r\n// 2023-02-10: change at CiBase (add Geo.ts)\r\nimport { reactive } from 'vue'\r\nimport { Message } from '@/services/CiMqttClient'\r\nimport { CiBaseController, IBase } from './CiBaseController'\r\nimport { geo0f } from '../classes/Geo'\r\n\r\nexport interface Repeater1 extends IBase {\r\n  // ---------mandatory-----------------------------------------\r\n  iRepeater1State: number;\r\n  type: string;\r\n  lastRepeater1Date: string;\r\n  lastRepeater1Time: string;\r\n  // ---------optional------------------------------------------\r\n  linkquality?: string;\r\n  textFooter?: string;\r\n}\r\n\r\nexport class CiRepeater1Controller extends CiBaseController {\r\n  public repeater1s: Array<Repeater1> = reactive(\r\n    [\r\n      { // ---repeater1: IKEA-------------------------------------\r\n        id: 'repeater1',\r\n        name: 'Repeat1 IKEA',\r\n        type: 'TRADFRI', // IKEA\r\n        iRepeater1State: -99,\r\n        lastRepeater1Date: 'Date?',\r\n        lastRepeater1Time: 'Time?',\r\n        subTopic: 'zb/h/e1/ku/repeater zb/h/e1/ku/repeater/time',\r\n        pubTopic: ''\r\n      }\r\n    ]\r\n  );\r\n\r\n  // --------------state constants------------------------------\r\n  public stateOk = -1;\r\n  public stateLastSeen = -2;\r\n  public stateNotOk = -998;\r\n  public stateNoState = -999;\r\n\r\n  // --------------Message for this ci (control/indicator)?-----\r\n  public onMessage (message: Message): void {\r\n    this.repeater1s.forEach(repeater1 => {\r\n      const aSubTopic = repeater1.subTopic.split(' ')\r\n      if (aSubTopic.includes(message.topic)) {\r\n        // --------repeater1 topic found ------------------------\r\n        // console.log('onMessage:', message.topic, ', payload', message.payload)\r\n        if (message.topic.includes('time')) {\r\n          // ------brokertime yyyymmdd HHMMSS received?---------\r\n          if (message.payload.length === 15) {\r\n            repeater1.lastRepeater1Date = message.payload.substring(6, 8) + '.' + message.payload.substring(4, 6) + '.' + message.payload.substring(2, 4)\r\n            repeater1.lastRepeater1Time = message.payload.substring(9, 11) + ':' + message.payload.substring(11, 13) + ':' + message.payload.substring(13, 15)\r\n            repeater1.iRepeater1State = this.stateOk\r\n          } else {\r\n            repeater1.lastRepeater1Date = geo0f.noDate\r\n            repeater1.lastRepeater1Time = geo0f.noTime\r\n          }\r\n          // ------END brokertime yyyymmdd HHMMSS received?-----\r\n        } else {\r\n          // ------work on different repeater types-------------\r\n          repeater1.iRepeater1State = this.stateNotOk\r\n          repeater1.lastRepeater1Date = geo0f.noDate\r\n          repeater1.lastRepeater1Time = geo0f.noTime\r\n          if (repeater1.type === 'TRADFRI') {\r\n            try {\r\n              const aPayload = JSON.parse(message.payload)\r\n              // {\"last_seen\":\"2022-10-19T17:03:00+02:00\",\"linkquality\":72,\"update\":{\"state\":\"idle\"},\"update_available\":false}\r\n              if (aPayload.last_seen.length > 24) {\r\n                const dt = aPayload.last_seen // \"last_seen\":\"2022-10-19T17:03:00+02:00\"\r\n                const date1 = dt.substring(8, 10) + '.' + dt.substring(5, 7) + '.' + dt.substring(2, 4)\r\n                repeater1.lastRepeater1Date = date1\r\n                repeater1.lastRepeater1Time = dt.substring(11, 19)\r\n                const lqiPercent = Math.round(aPayload.linkquality * 100 / 255)\r\n                repeater1.linkquality = ' link ' + `${lqiPercent}` + '% = ' + `${aPayload.linkquality}` + ' lqi'\r\n                repeater1.iRepeater1State = this.stateLastSeen\r\n                // console.log('Repeater:', aPayload.last_seen + ' = ' + date1 + ' ' + dt.substring(11, 19) + ' state=' + repeater1.iRepeater1State)\r\n              }\r\n            } catch (error) {\r\n              repeater1.lastRepeater1Date = 'ERROR'\r\n              repeater1.lastRepeater1Time = 'json'\r\n              console.log('onMessage error=', error)\r\n            }\r\n          }\r\n          if (repeater1.type === 'something_else') {\r\n            try {\r\n              // ...add functionality for another sensor here...\r\n            } catch (error) { }\r\n          }\r\n        } // ------END work on different repeater types----------\r\n      } // --------END repeater1 topic found---------------------\r\n    })\r\n  }\r\n\r\n  public publishCi (topic: string, payload: string): void {\r\n    // console.log('publish:', '-t ' + topic + ' -m ' + payload)\r\n    this.publish(topic, payload, false, 0).catch((e) => { console.error('CiRepeaterController: ERROR:', e) })\r\n  }\r\n}\r\n\r\nexport const ciRepeater1Controller = new CiRepeater1Controller()\r\n"]}]}