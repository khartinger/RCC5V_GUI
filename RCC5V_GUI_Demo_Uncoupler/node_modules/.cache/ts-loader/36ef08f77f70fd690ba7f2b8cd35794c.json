{"remainingRequest":"G:\\work3\\vue\\haus2\\node_modules\\thread-loader\\dist\\cjs.js!G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js??ref--13-2!G:\\work3\\vue\\haus2\\src\\controller\\CiLampController.ts","dependencies":[{"path":"G:\\work3\\vue\\haus2\\src\\controller\\CiLampController.ts","mtime":1641220201063},{"path":"G:\\work3\\vue\\haus2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus2\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgX19leHRlbmRzIH0gZnJvbSAidHNsaWIiOw0KLy8gX19fX19fQ2lMYW1wQ29udHJvbGxlci50c19fX19fX19fX19fX19fX19fX19fXzIwMjEtMTItMjhfX19fXw0KaW1wb3J0IHsgcmVhY3RpdmUgfSBmcm9tICd2dWUnOw0KaW1wb3J0IHsgQ2lCYXNlQ29udHJvbGxlciB9IGZyb20gJy4vQ2lCYXNlQ29udHJvbGxlcic7DQp2YXIgQ2lMYW1wQ29udHJvbGxlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsNCiAgICBfX2V4dGVuZHMoQ2lMYW1wQ29udHJvbGxlciwgX3N1cGVyKTsNCiAgICBmdW5jdGlvbiBDaUxhbXBDb250cm9sbGVyKCkgew0KICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsNCiAgICAgICAgX3RoaXMubGFtcHMgPSByZWFjdGl2ZShbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWQ6ICdsZTFhcjMnLA0KICAgICAgICAgICAgICAgIG5hbWU6ICdMYW1wZTMnLA0KICAgICAgICAgICAgICAgIGlMYW1wU3RhdGU6IC0xLA0KICAgICAgICAgICAgICAgIHN1YlRvcGljOiAnZTEvYXIvbGljaHQvMy9yZXQvbGljaHQnLA0KICAgICAgICAgICAgICAgIHB1YlRvcGljOiAnZTEvYXIvbGljaHQvMy9zZXQvbGljaHQnLA0KICAgICAgICAgICAgICAgIHB1YlBheWxvYWQ6ICd1bScNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWQ6ICdsbzJzbDEnLA0KICAgICAgICAgICAgICAgIG5hbWU6ICdMYW1wZTEnLA0KICAgICAgICAgICAgICAgIGlMYW1wU3RhdGU6IC0xLA0KICAgICAgICAgICAgICAgIHN1YlRvcGljOiAnbzIvc2wvbGljaHQvMS9yZXQvbGljaHQnLA0KICAgICAgICAgICAgICAgIHB1YlRvcGljOiAnbzIvc2wvbGljaHQvMS9zZXQvbGljaHQnLA0KICAgICAgICAgICAgICAgIHB1YlBheWxvYWQ6ICctMScNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWQ6ICdsZTNodTEnLA0KICAgICAgICAgICAgICAgIG5hbWU6ICdIdWV0dGUnLA0KICAgICAgICAgICAgICAgIGlMYW1wU3RhdGU6IC0xLA0KICAgICAgICAgICAgICAgIHN1YlRvcGljOiAnZTMvaHUvcmV0L3N0YXR1cyBlMy9odS9yZXQvbGFtcGUnLA0KICAgICAgICAgICAgICAgIHB1YlRvcGljOiAnZTMvaHUvc2V0L2xhbXBlJywNCiAgICAgICAgICAgICAgICBwdWJQYXlsb2FkOiAnLTEnDQogICAgICAgICAgICB9DQogICAgICAgIF0pOw0KICAgICAgICByZXR1cm4gX3RoaXM7DQogICAgfQ0KICAgIC8vIC0tLS0tLS0tLU1lc3NhZ2UgZm9yIHRoaXMgY2kgKGNvbnRyb2wvaW5kaWNhdG9yKT8tLS0tLS0tLS0tDQogICAgQ2lMYW1wQ29udHJvbGxlci5wcm90b3R5cGUub25NZXNzYWdlID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHsNCiAgICAgICAgdGhpcy5sYW1wcy5mb3JFYWNoKGZ1bmN0aW9uIChsYW1wKSB7DQogICAgICAgICAgICB2YXIgYVN1YlRvcGljID0gbGFtcC5zdWJUb3BpYy5zcGxpdCgnICcpOw0KICAgICAgICAgICAgaWYgKGFTdWJUb3BpYy5pbmNsdWRlcyhtZXNzYWdlLnRvcGljKSkgew0KICAgICAgICAgICAgICAgIC8vIC0tLWxhbXAgdG9waWMgZm91bmQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudG9waWMuaW5jbHVkZXMoJ3JldC9zdGF0dXMnKSkgew0KICAgICAgICAgICAgICAgICAgICAvLyAtbGFtcCBzdGF0ZSBmcm9tIGh1ZXR0ZSAtIHN0YXR1cy0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ0NpTGFtcENvbnRyb2xsZXIub25NZXNzYWdlIC10ICcsIG1lc3NhZ2UudG9waWMgKyAnIC1tICcgKyBtZXNzYWdlLnBheWxvYWQpDQogICAgICAgICAgICAgICAgICAgIHZhciBhUGF5bG9hZCA9IEpTT04ucGFyc2UobWVzc2FnZS5wYXlsb2FkKTsNCiAgICAgICAgICAgICAgICAgICAgbGFtcC5pTGFtcFN0YXRlID0gLTE7DQogICAgICAgICAgICAgICAgICAgIGlmIChhUGF5bG9hZC5MYW1wID09PSAwIHx8IGFQYXlsb2FkLkxhbXAgPT09ICcwJykNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhbXAuaUxhbXBTdGF0ZSA9IDA7DQogICAgICAgICAgICAgICAgICAgIGlmIChhUGF5bG9hZC5MYW1wID09PSAxIHx8IGFQYXlsb2FkLkxhbXAgPT09ICcxJykNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhbXAuaUxhbXBTdGF0ZSA9IDE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAvLyAtb3RoZXIgbGFtcC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgICAgICAgICAgICAgaWYgKChtZXNzYWdlLnBheWxvYWQgPT09ICcxJykgfHwgKG1lc3NhZ2UucGF5bG9hZCA9PT0gJ29uJykpDQogICAgICAgICAgICAgICAgICAgICAgICBsYW1wLmlMYW1wU3RhdGUgPSAxOw0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgobWVzc2FnZS5wYXlsb2FkID09PSAnMCcpIHx8IChtZXNzYWdlLnBheWxvYWQgPT09ICdvZmYnKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYW1wLmlMYW1wU3RhdGUgPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFtcC5pTGFtcFN0YXRlID0gLTE7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ0NpTGFtcENvbnRyb2xsZXI6b25NZXNzYWdlOiBtZXNzYWdlLnBheWxvYWQ9JywgbWVzc2FnZS5wYXlsb2FkKQ0KICAgICAgICAgICAgfSAvLyBFTkQgbGFtcCB0b3BpYyBmb3VuZA0KICAgICAgICB9KTsNCiAgICB9Ow0KICAgIENpTGFtcENvbnRyb2xsZXIucHJvdG90eXBlLnB1Ymxpc2hDaSA9IGZ1bmN0aW9uICh0b3BpYywgcGF5bG9hZCkgew0KICAgICAgICAvLyBjb25zb2xlLmxvZygnQ2lMYW1wQ29udHJvbGxlcjpwdWJsaXNoQ2k6JywgJy10ICcgKyB0b3BpYyArICcgLW0gJyArIHBheWxvYWQpDQogICAgICAgIHRoaXMucHVibGlzaCh0b3BpYywgcGF5bG9hZCwgZmFsc2UsIDApOw0KICAgIH07DQogICAgcmV0dXJuIENpTGFtcENvbnRyb2xsZXI7DQp9KENpQmFzZUNvbnRyb2xsZXIpKTsNCmV4cG9ydCB7IENpTGFtcENvbnRyb2xsZXIgfTsNCmV4cG9ydCB2YXIgY2lMYW1wQ29udHJvbGxlciA9IG5ldyBDaUxhbXBDb250cm9sbGVyKCk7DQo="},{"version":3,"file":"G:\\work3\\vue\\haus2\\src\\controller\\CiLampController.ts","sourceRoot":"","sources":["G:\\work3\\vue\\haus2\\src\\controller\\CiLampController.ts"],"names":[],"mappings":";AAAA,gEAAgE;AAChE,OAAO,EAAE,QAAQ,EAAE,MAAM,KAAK,CAAA;AAE9B,OAAO,EAAE,gBAAgB,EAAS,MAAM,oBAAoB,CAAA;AAQ5D;IAAsC,oCAAgB;IAAtD;QAAA,qEA4DC;QA3DQ,WAAK,GAAgB,QAAQ,CAClC;YACE;gBACE,EAAE,EAAE,QAAQ;gBACZ,IAAI,EAAE,QAAQ;gBACd,UAAU,EAAE,CAAC,CAAC;gBACd,QAAQ,EAAE,yBAAyB;gBACnC,QAAQ,EAAE,yBAAyB;gBACnC,UAAU,EAAE,IAAI;aACjB;YACD;gBACE,EAAE,EAAE,QAAQ;gBACZ,IAAI,EAAE,QAAQ;gBACd,UAAU,EAAE,CAAC,CAAC;gBACd,QAAQ,EAAE,yBAAyB;gBACnC,QAAQ,EAAE,yBAAyB;gBACnC,UAAU,EAAE,IAAI;aACjB;YACD;gBACE,EAAE,EAAE,QAAQ;gBACZ,IAAI,EAAE,QAAQ;gBACd,UAAU,EAAE,CAAC,CAAC;gBACd,QAAQ,EAAE,kCAAkC;gBAC5C,QAAQ,EAAE,iBAAiB;gBAC3B,UAAU,EAAE,IAAI;aACjB;SACF,CACF,CAAC;;IAgCJ,CAAC;IA9BC,8DAA8D;IACvD,oCAAS,GAAhB,UAAkB,OAAgB;QAChC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,UAAA,IAAI;YACrB,IAAM,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;YAC1C,IAAI,SAAS,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBACrC,wDAAwD;gBACxD,IAAI,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE;oBACxC,sDAAsD;oBACtD,0FAA0F;oBAC1F,IAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,CAAA;oBAC5C,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,CAAA;oBACpB,IAAI,QAAQ,CAAC,IAAI,KAAK,CAAC,IAAI,QAAQ,CAAC,IAAI,KAAK,GAAG;wBAAE,IAAI,CAAC,UAAU,GAAG,CAAC,CAAA;oBACrE,IAAI,QAAQ,CAAC,IAAI,KAAK,CAAC,IAAI,QAAQ,CAAC,IAAI,KAAK,GAAG;wBAAE,IAAI,CAAC,UAAU,GAAG,CAAC,CAAA;iBACtE;qBAAM;oBACL,sDAAsD;oBACtD,IAAI,CAAC,OAAO,CAAC,OAAO,KAAK,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,KAAK,IAAI,CAAC;wBAAE,IAAI,CAAC,UAAU,GAAG,CAAC,CAAA;yBAC3E;wBACH,IAAI,CAAC,OAAO,CAAC,OAAO,KAAK,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,KAAK,KAAK,CAAC;4BAAE,IAAI,CAAC,UAAU,GAAG,CAAC,CAAA;6BAC5E;4BAAE,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,CAAA;yBAAE;qBAC9B;iBACF;gBACD,+EAA+E;aAChF,CAAC,uBAAuB;QAC3B,CAAC,CAAC,CAAA;IACJ,CAAC;IAEM,oCAAS,GAAhB,UAAkB,KAAa,EAAE,OAAe;QAC9C,+EAA+E;QAC/E,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC,CAAA;IACxC,CAAC;IACH,uBAAC;AAAD,CAAC,AA5DD,CAAsC,gBAAgB,GA4DrD;;AAED,MAAM,CAAC,IAAM,gBAAgB,GAAG,IAAI,gBAAgB,EAAE,CAAA","sourcesContent":["// ______CiLampController.ts_____________________2021-12-28_____\r\nimport { reactive } from 'vue'\r\nimport { Message } from '@/services/CiMqttClient'\r\nimport { CiBaseController, IBase } from './CiBaseController'\r\n\r\nexport interface Lamp extends IBase {\r\n  iLampState: number;\r\n  battery?: string;\r\n  text5?: string;\r\n}\r\n\r\nexport class CiLampController extends CiBaseController {\r\n  public lamps: Array<Lamp> = reactive(\r\n    [\r\n      {\r\n        id: 'le1ar3',\r\n        name: 'Lampe3',\r\n        iLampState: -1,\r\n        subTopic: 'e1/ar/licht/3/ret/licht',\r\n        pubTopic: 'e1/ar/licht/3/set/licht',\r\n        pubPayload: 'um'\r\n      },\r\n      {\r\n        id: 'lo2sl1',\r\n        name: 'Lampe1',\r\n        iLampState: -1,\r\n        subTopic: 'o2/sl/licht/1/ret/licht',\r\n        pubTopic: 'o2/sl/licht/1/set/licht',\r\n        pubPayload: '-1'\r\n      },\r\n      {\r\n        id: 'le3hu1',\r\n        name: 'Huette',\r\n        iLampState: -1,\r\n        subTopic: 'e3/hu/ret/status e3/hu/ret/lampe',\r\n        pubTopic: 'e3/hu/set/lampe',\r\n        pubPayload: '-1'\r\n      }\r\n    ]\r\n  );\r\n\r\n  // ---------Message for this ci (control/indicator)?----------\r\n  public onMessage (message: Message): void {\r\n    this.lamps.forEach(lamp => {\r\n      const aSubTopic = lamp.subTopic.split(' ')\r\n      if (aSubTopic.includes(message.topic)) {\r\n        // ---lamp topic found ---------------------------------\r\n        if (message.topic.includes('ret/status')) {\r\n          // -lamp state from huette - status-------------------\r\n          // console.log('CiLampController.onMessage -t ', message.topic + ' -m ' + message.payload)\r\n          const aPayload = JSON.parse(message.payload)\r\n          lamp.iLampState = -1\r\n          if (aPayload.Lamp === 0 || aPayload.Lamp === '0') lamp.iLampState = 0\r\n          if (aPayload.Lamp === 1 || aPayload.Lamp === '1') lamp.iLampState = 1\r\n        } else {\r\n          // -other lamp----------------------------------------\r\n          if ((message.payload === '1') || (message.payload === 'on')) lamp.iLampState = 1\r\n          else {\r\n            if ((message.payload === '0') || (message.payload === 'off')) lamp.iLampState = 0\r\n            else { lamp.iLampState = -1 }\r\n          }\r\n        }\r\n        // console.log('CiLampController:onMessage: message.payload=', message.payload)\r\n      } // END lamp topic found\r\n    })\r\n  }\r\n\r\n  public publishCi (topic: string, payload: string): void {\r\n    // console.log('CiLampController:publishCi:', '-t ' + topic + ' -m ' + payload)\r\n    this.publish(topic, payload, false, 0)\r\n  }\r\n}\r\n\r\nexport const ciLampController = new CiLampController()\r\n"]}]}