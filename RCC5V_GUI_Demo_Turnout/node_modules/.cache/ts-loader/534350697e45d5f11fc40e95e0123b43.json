{"remainingRequest":"G:\\work3\\vue\\haus3\\node_modules\\thread-loader\\dist\\cjs.js!G:\\work3\\vue\\haus3\\node_modules\\ts-loader\\index.js??ref--13-2!G:\\work3\\vue\\haus3\\src\\controller\\CiBlind1Controller.ts","dependencies":[{"path":"G:\\work3\\vue\\haus3\\src\\controller\\CiBlind1Controller.ts","mtime":1677094996248},{"path":"G:\\work3\\vue\\haus3\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus3\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus3\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgX19leHRlbmRzIH0gZnJvbSAidHNsaWIiOw0KLy8gX19fX19fQ2lCbGluZDFDb250cm9sbGVyLnRzX19fX19fX19fX19fX19fX19fX2toYXJ0aW5nZXJfX19fXw0KLy8gMjAyMi0wMS0wODogbmV3DQovLyAyMDIzLTAyLTIwOiBjaGFuZ2UgYXQgQ2lCYXNlIChhZGQgR2VvLnRzKQ0KaW1wb3J0IHsgcmVhY3RpdmUgfSBmcm9tICd2dWUnOw0KaW1wb3J0IHsgQ2lCYXNlQ29udHJvbGxlciB9IGZyb20gJy4vQ2lCYXNlQ29udHJvbGxlcic7DQp2YXIgQ2lCbGluZDFDb250cm9sbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgew0KICAgIF9fZXh0ZW5kcyhDaUJsaW5kMUNvbnRyb2xsZXIsIF9zdXBlcik7DQogICAgZnVuY3Rpb24gQ2lCbGluZDFDb250cm9sbGVyKCkgew0KICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsNCiAgICAgICAgX3RoaXMuYmxpbmQxcyA9IHJlYWN0aXZlKFsNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZDogJ2JsaW5kX3ZyMV8xJywNCiAgICAgICAgICAgICAgICBuYW1lOiAnUm9sbG8gPycsDQogICAgICAgICAgICAgICAgaUJsaW5kMVN0YXRlOiAtMSwNCiAgICAgICAgICAgICAgICB0eXBlOiAnemInLA0KICAgICAgICAgICAgICAgIGJhdHRlcnk6ICctJywNCiAgICAgICAgICAgICAgICBzdWJUb3BpYzogJ3piL2gvZTEvdm8vcm9sbG96dSBlMS9oL3ZvL3JvbGxvJywNCiAgICAgICAgICAgICAgICBwdWJUb3BpYzogJycNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWQ6ICdibGluZF93ejFfMScsDQogICAgICAgICAgICAgICAgbmFtZTogJ1JvbGxvID8nLA0KICAgICAgICAgICAgICAgIGlCbGluZDFTdGF0ZTogLTEsDQogICAgICAgICAgICAgICAgdHlwZTogJ3piJywNCiAgICAgICAgICAgICAgICBiYXR0ZXJ5OiAnLScsDQogICAgICAgICAgICAgICAgc3ViVG9waWM6ICd6Yi9oL2UxL3dvL3JvbGxvenUgZTEvaC93by9yb2xsbycsDQogICAgICAgICAgICAgICAgcHViVG9waWM6ICcnDQogICAgICAgICAgICB9DQogICAgICAgIF0pOw0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLXN0YXRlIGNvbnN0YW50cy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBfdGhpcy5zdGF0ZU9wZW4gPSAtMTsNCiAgICAgICAgX3RoaXMuc3RhdGVDbG9zZSA9IC0yOw0KICAgICAgICBfdGhpcy5zdGF0ZUxvY2sgPSAtMzsNCiAgICAgICAgX3RoaXMuc3RhdGVNb3RvckRvd24gPSAtNDsNCiAgICAgICAgX3RoaXMuc3RhdGVNb3RvclN0b3AgPSAtNTsNCiAgICAgICAgX3RoaXMuc3RhdGVNb3RvclVwID0gLTY7DQogICAgICAgIF90aGlzLnN0YXRlTm90T2sgPSAtOTk4Ow0KICAgICAgICBfdGhpcy5zdGF0ZU5vU3RhdGUgPSAtOTk5Ow0KICAgICAgICByZXR1cm4gX3RoaXM7DQogICAgfQ0KICAgIENpQmxpbmQxQ29udHJvbGxlci5wcm90b3R5cGUub25NZXNzYWdlID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHsNCiAgICAgICAgdmFyIF90aGlzID0gdGhpczsNCiAgICAgICAgdGhpcy5ibGluZDFzLmZvckVhY2goZnVuY3Rpb24gKGJsaW5kMSkgew0KICAgICAgICAgICAgdmFyIGFTdWJUb3BpYyA9IGJsaW5kMS5zdWJUb3BpYy5zcGxpdCgnICcpOw0KICAgICAgICAgICAgaWYgKGFTdWJUb3BpYy5pbmNsdWRlcyhtZXNzYWdlLnRvcGljKSkgew0KICAgICAgICAgICAgICAgIC8vIC0tLWJsaW5kMSB0b3BpYyBmb3VuZCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgICAgICAgICAgaWYgKGJsaW5kMS50eXBlID09PSAnemInKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIC0tLWJsaW5kIHR5cGUgMS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYVBheWxvYWQgPSBKU09OLnBhcnNlKG1lc3NhZ2UucGF5bG9hZCk7DQogICAgICAgICAgICAgICAgICAgICAgICBibGluZDEuYmF0dGVyeSA9ICIiICsgYVBheWxvYWQuYmF0dGVyeTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBibGluZHN0YXRlXyA9IFN0cmluZyhhUGF5bG9hZC5jb250YWN0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChibGluZHN0YXRlXyA9PT0gJ3RydWUnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsaW5kMS5pQmxpbmQxU3RhdGUgPSBfdGhpcy5zdGF0ZUNsb3NlOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJsaW5kc3RhdGVfID09PSAnZmFsc2UnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBibGluZDEuaUJsaW5kMVN0YXRlID0gX3RoaXMuc3RhdGVPcGVuOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxpbmQxLmlCbGluZDFTdGF0ZSA9IF90aGlzLnN0YXRlTm90T2s7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7IH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gLS0tYmxpbmQgdHlwZSAzLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgICAgICAgICBpZiAoYmxpbmQxLnR5cGUgPT09ICdzb21ldGhpbmdfZWxzZScpIHsNCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC4uLmFkZCBmdW5jdGlvbmFsaXR5IGZvciBhbm90aGVyIHNlbnNvciBoZXJlLi4uDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7IH0NCiAgICAgICAgICAgICAgICB9IC8vIC0tLS0tLUVORCB3b3JrIG9uIGRpZmZlcmVudCBibGluZDEgdHlwZXMtLS0tLS0tLS0tLQ0KICAgICAgICAgICAgICAgIC8vIC0tLUVORCBibGluZDEgdG9waWMgZm91bmQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIH07DQogICAgQ2lCbGluZDFDb250cm9sbGVyLnByb3RvdHlwZS5wdWJsaXNoQ2kgPSBmdW5jdGlvbiAodG9waWMsIHBheWxvYWQpIHsNCiAgICAgICAgLy8gY29uc29sZS5sb2coJ0NpQmxpbmQxQ29udHJvbGxlcjpwdWJsaXNoQ2k6JywgJy10ICcgKyB0b3BpYyArICcgLW0gJyArIHBheWxvYWQpDQogICAgICAgIHRoaXMucHVibGlzaCh0b3BpYywgcGF5bG9hZCwgZmFsc2UsIDApLmNhdGNoKGZ1bmN0aW9uIChlKSB7IGNvbnNvbGUuZXJyb3IoJ0NpQmxpbmQxQ29udHJvbGxlcjogRVJST1I6JywgZSk7IH0pOw0KICAgIH07DQogICAgcmV0dXJuIENpQmxpbmQxQ29udHJvbGxlcjsNCn0oQ2lCYXNlQ29udHJvbGxlcikpOw0KZXhwb3J0IHsgQ2lCbGluZDFDb250cm9sbGVyIH07DQpleHBvcnQgdmFyIGNpQmxpbmQxQ29udHJvbGxlciA9IG5ldyBDaUJsaW5kMUNvbnRyb2xsZXIoKTsNCg=="},{"version":3,"file":"G:\\work3\\vue\\haus3\\src\\controller\\CiBlind1Controller.ts","sourceRoot":"","sources":["G:\\work3\\vue\\haus3\\src\\controller\\CiBlind1Controller.ts"],"names":[],"mappings":"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","sourcesContent":["// ______CiBlind1Controller.ts___________________khartinger_____\r\n// 2022-01-08: new\r\n// 2023-02-20: change at CiBase (add Geo.ts)\r\nimport { reactive } from 'vue'\r\nimport { Message } from '@/services/CiMqttClient'\r\nimport { CiBaseController, IBase } from './CiBaseController'\r\n\r\nexport interface Blind1 extends IBase {\r\n  // ---------mandatory-----------------------------------------\r\n  iBlind1State: number;\r\n  type: string;\r\n  // ---------optional------------------------------------------\r\n  iMotorState?: number;\r\n  battery?: string;\r\n  textHeader?: string;\r\n  textFooter?: string;\r\n}\r\n\r\nexport class CiBlind1Controller extends CiBaseController {\r\n  public blind1s: Array<Blind1> = reactive(\r\n    [\r\n      {\r\n        id: 'blind_vr1_1',\r\n        name: 'Rollo ?',\r\n        iBlind1State: -1,\r\n        type: 'zb',\r\n        battery: '-',\r\n        subTopic: 'zb/h/e1/vo/rollozu e1/h/vo/rollo',\r\n        pubTopic: ''\r\n      },\r\n      {\r\n        id: 'blind_wz1_1',\r\n        name: 'Rollo ?',\r\n        iBlind1State: -1,\r\n        type: 'zb',\r\n        battery: '-',\r\n        subTopic: 'zb/h/e1/wo/rollozu e1/h/wo/rollo',\r\n        pubTopic: ''\r\n      }\r\n\r\n    ]\r\n  );\r\n\r\n  // --------------state constants------------------------------\r\n  public stateOpen = -1;\r\n  public stateClose = -2;\r\n  public stateLock = -3;\r\n  public stateMotorDown = -4;\r\n  public stateMotorStop = -5;\r\n  public stateMotorUp = -6;\r\n  public stateNotOk = -998;\r\n  public stateNoState = -999;\r\n\r\n  public onMessage (message: Message): void {\r\n    this.blind1s.forEach(blind1 => {\r\n      const aSubTopic = blind1.subTopic.split(' ')\r\n      if (aSubTopic.includes(message.topic)) {\r\n        // ---blind1 topic found -------------------------------\r\n        if (blind1.type === 'zb') {\r\n        // ---blind type 1--------------------------------------\r\n          try {\r\n            const aPayload = JSON.parse(message.payload)\r\n            blind1.battery = `${aPayload.battery}`\r\n            const blindstate_ = String(aPayload.contact)\r\n            if (blindstate_ === 'true') blind1.iBlind1State = this.stateClose\r\n            else {\r\n              if (blindstate_ === 'false') blind1.iBlind1State = this.stateOpen\r\n              else blind1.iBlind1State = this.stateNotOk\r\n            }\r\n          } catch (error) { }\r\n        }\r\n        // ---blind type 3--------------------------------------\r\n        if (blind1.type === 'something_else') {\r\n          try {\r\n            // ...add functionality for another sensor here...\r\n          } catch (error) { }\r\n        } // ------END work on different blind1 types-----------\r\n        // ---END blind1 topic found ---------------------------\r\n      }\r\n    })\r\n  }\r\n\r\n  public publishCi (topic: string, payload: string): void {\r\n    // console.log('CiBlind1Controller:publishCi:', '-t ' + topic + ' -m ' + payload)\r\n    this.publish(topic, payload, false, 0).catch((e) => { console.error('CiBlind1Controller: ERROR:', e) })\r\n  }\r\n}\r\n\r\nexport const ciBlind1Controller = new CiBlind1Controller()\r\n"]}]}