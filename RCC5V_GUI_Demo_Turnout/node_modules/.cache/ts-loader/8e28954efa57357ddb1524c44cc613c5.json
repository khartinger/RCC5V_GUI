{"remainingRequest":"G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js??ref--13-1!G:\\work3\\vue\\haus2\\src\\controller\\CiPumpController.ts","dependencies":[{"path":"G:\\work3\\vue\\haus2\\src\\controller\\CiPumpController.ts","mtime":1641048863981},{"path":"G:\\work3\\vue\\haus2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgX19leHRlbmRzIH0gZnJvbSAidHNsaWIiOw0KLy8gX19fX19fQ2lQdW1wQ29udHJvbGxlci50c19fX19fX19fX19fX19fX19fX19fXzIwMjItMDEtMDFfX19fXw0KaW1wb3J0IHsgcmVhY3RpdmUgfSBmcm9tICd2dWUnOw0KaW1wb3J0IHsgQ2lCYXNlQ29udHJvbGxlciB9IGZyb20gJy4vQ2lCYXNlQ29udHJvbGxlcic7DQppbXBvcnQgZ2VvMCBmcm9tICdAL2NvbXBvbmVudHMvQ2lCYXNlLnZ1ZSc7DQp2YXIgQ2lQdW1wQ29udHJvbGxlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHsNCiAgICBfX2V4dGVuZHMoQ2lQdW1wQ29udHJvbGxlciwgX3N1cGVyKTsNCiAgICBmdW5jdGlvbiBDaVB1bXBDb250cm9sbGVyKCkgew0KICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsNCiAgICAgICAgX3RoaXMucHVtcHMgPSByZWFjdGl2ZShbDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWQ6ICdwdW1wMScsDQogICAgICAgICAgICAgICAgbmFtZTogJ1B1bXBlMUUnLA0KICAgICAgICAgICAgICAgIHR5cGU6ICdFU1AzMicsDQogICAgICAgICAgICAgICAgaVB1bXBTdGF0ZTogLTEsDQogICAgICAgICAgICAgICAgc1NlbnNvcjogJy0nLA0KICAgICAgICAgICAgICAgIHNTdGF0dXM6ICdOTyBTVEFURScsDQogICAgICAgICAgICAgICAgbGFzdFB1bXBEYXRlOiAnLS0uLS0uLS0nLA0KICAgICAgICAgICAgICAgIGxhc3RQdW1wVGltZTogJy0tOi0tOi0tJywNCiAgICAgICAgICAgICAgICBzdWJUb3BpYzogJ2sxL3B1bXBlLzEvcmV0L3B1bXBlIGsxL3B1bXBlLzEvcmV0L3B1bXBlL3RpbWUnLA0KICAgICAgICAgICAgICAgIHB1YlRvcGljOiAnJw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZDogJ3B1bXAyJywNCiAgICAgICAgICAgICAgICBuYW1lOiAnUHVtcGUyRCcsDQogICAgICAgICAgICAgICAgdHlwZTogJ0QxJywNCiAgICAgICAgICAgICAgICBpUHVtcFN0YXRlOiAtMSwNCiAgICAgICAgICAgICAgICBzU2Vuc29yOiAnLScsDQogICAgICAgICAgICAgICAgc1N0YXR1czogJ05PIFNUQVRFJywNCiAgICAgICAgICAgICAgICBsYXN0UHVtcERhdGU6ICctLS4tLS4tLScsDQogICAgICAgICAgICAgICAgbGFzdFB1bXBUaW1lOiAnLS06LS06LS0nLA0KICAgICAgICAgICAgICAgIHN1YlRvcGljOiAnazEvcHVtcGUvMi9yZXQvcHVtcGUgazEvcHVtcGUvMi9yZXQvcHVtcGUvdGltZScsDQogICAgICAgICAgICAgICAgcHViVG9waWM6ICcnDQogICAgICAgICAgICB9DQogICAgICAgIF0pOw0KICAgICAgICByZXR1cm4gX3RoaXM7DQogICAgfQ0KICAgIC8vIC0tLS0tLS0tLU1lc3NhZ2UgZm9yIHRoaXMgY2kgKGNvbnRyb2wvaW5kaWNhdG9yKT8tLS0tLS0tLS0tDQogICAgQ2lQdW1wQ29udHJvbGxlci5wcm90b3R5cGUub25NZXNzYWdlID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHsNCiAgICAgICAgLy8gLS0tLS0tLXNlYXJjaCBmb3IgcHVtcCB0b3BpYy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHRoaXMucHVtcHMuZm9yRWFjaChmdW5jdGlvbiAocHVtcCkgew0KICAgICAgICAgICAgdmFyIGFTdWJUb3BpYyA9IHB1bXAuc3ViVG9waWMuc3BsaXQoJyAnKTsNCiAgICAgICAgICAgIGlmIChhU3ViVG9waWMuaW5jbHVkZXMobWVzc2FnZS50b3BpYykpIHsNCiAgICAgICAgICAgICAgICAvLyAtLS1wdW1wIHRvcGljIGZvdW5kIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnRvcGljLmluY2x1ZGVzKCd0aW1lJykpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucGF5bG9hZC5sZW5ndGggPT09IDE1KSB7DQogICAgICAgICAgICAgICAgICAgICAgICBwdW1wLmxhc3RQdW1wRGF0ZSA9IG1lc3NhZ2UucGF5bG9hZC5zdWJzdHJpbmcoNiwgOCkgKyAnLicgKyBtZXNzYWdlLnBheWxvYWQuc3Vic3RyaW5nKDQsIDYpICsgJy4nICsgbWVzc2FnZS5wYXlsb2FkLnN1YnN0cmluZygyLCA0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHB1bXAubGFzdFB1bXBUaW1lID0gbWVzc2FnZS5wYXlsb2FkLnN1YnN0cmluZyg5LCAxMSkgKyAnOicgKyBtZXNzYWdlLnBheWxvYWQuc3Vic3RyaW5nKDExLCAxMykgKyAnOicgKyBtZXNzYWdlLnBheWxvYWQuc3Vic3RyaW5nKDEzLCAxNSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBwdW1wLmxhc3RQdW1wRGF0ZSA9IGdlbzAubm9EYXRlOw0KICAgICAgICAgICAgICAgICAgICAgICAgcHVtcC5sYXN0UHVtcFRpbWUgPSBnZW8wLm5vVGltZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsgLy8gLXB1bXAgaW5mby0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgICAgICAgICAgICAgcHVtcC5sYXN0UHVtcERhdGUgPSBnZW8wLm5vRGF0ZTsNCiAgICAgICAgICAgICAgICAgICAgcHVtcC5sYXN0UHVtcFRpbWUgPSBnZW8wLm5vVGltZTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHB1bXAudHlwZSA9PT0gJ0QxJyB8fCBwdW1wLnR5cGUgPT09ICdFU1AzMicpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhUGF5bG9hZCA9IEpTT04ucGFyc2UobWVzc2FnZS5wYXlsb2FkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHB1bXAuaVB1bXBTdGF0ZSA9IC0xOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFQYXlsb2FkLnB1bXBlID09PSAwIHx8IGFQYXlsb2FkLnB1bXBlID09PSAnMCcpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVtcC5pUHVtcFN0YXRlID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhUGF5bG9hZC5wdW1wZSA9PT0gMSB8fCBhUGF5bG9hZC5wdW1wZSA9PT0gJzEnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1bXAuaVB1bXBTdGF0ZSA9IDE7DQogICAgICAgICAgICAgICAgICAgICAgICBwdW1wLnNTZW5zb3IgPSAiIiArIGFQYXlsb2FkLnNlbnNvcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHB1bXAuc1N0YXR1cyA9IGFQYXlsb2FkLnN0YXR1czsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gLy8gRU5EIHB1bXAgdG9waWMgZm91bmQNCiAgICAgICAgfSk7DQogICAgfTsNCiAgICBDaVB1bXBDb250cm9sbGVyLnByb3RvdHlwZS5wdWJsaXNoQ2kgPSBmdW5jdGlvbiAodG9waWMsIHBheWxvYWQpIHsNCiAgICAgICAgLy8gY29uc29sZS5sb2coJ3B1Ymxpc2g6JywgJy10ICcgKyB0b3BpYyArICcgLW0gJyArIHBheWxvYWQpDQogICAgICAgIHRoaXMucHVibGlzaCh0b3BpYywgcGF5bG9hZCwgZmFsc2UsIDApOw0KICAgIH07DQogICAgcmV0dXJuIENpUHVtcENvbnRyb2xsZXI7DQp9KENpQmFzZUNvbnRyb2xsZXIpKTsNCmV4cG9ydCB7IENpUHVtcENvbnRyb2xsZXIgfTsNCmV4cG9ydCB2YXIgY2lQdW1wQ29udHJvbGxlciA9IG5ldyBDaVB1bXBDb250cm9sbGVyKCk7DQo="},{"version":3,"file":"G:\\work3\\vue\\haus2\\src\\controller\\CiPumpController.ts","sourceRoot":"","sources":["G:\\work3\\vue\\haus2\\src\\controller\\CiPumpController.ts"],"names":[],"mappings":"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","sourcesContent":["// ______CiPumpController.ts_____________________2022-01-01_____\r\nimport { reactive } from 'vue'\r\nimport { Message } from '@/services/CiMqttClient'\r\nimport { CiBaseController, IBase } from './CiBaseController'\r\nimport geo0 from '@/components/CiBase.vue'\r\n\r\nexport interface Pump extends IBase {\r\n  type: string;\r\n  iPumpState: number;\r\n  sSensor?: string;\r\n  sStatus?: string;\r\n  lastPumpDate: string;\r\n  lastPumpTime: string;\r\n}\r\n\r\nexport class CiPumpController extends CiBaseController {\r\n  public pumps: Array<Pump> = reactive(\r\n    [\r\n      { // Keller: Bereich 1, Heizraum\r\n        id: 'pump1',\r\n        name: 'Pumpe1E',\r\n        type: 'ESP32',\r\n        iPumpState: -1,\r\n        sSensor: '-',\r\n        sStatus: 'NO STATE',\r\n        lastPumpDate: '--.--.--',\r\n        lastPumpTime: '--:--:--',\r\n        subTopic: 'k1/pumpe/1/ret/pumpe k1/pumpe/1/ret/pumpe/time',\r\n        pubTopic: ''\r\n      },\r\n      { // Keller: Bereich 1, Heizraum\r\n        id: 'pump2',\r\n        name: 'Pumpe2D',\r\n        type: 'D1',\r\n        iPumpState: -1,\r\n        sSensor: '-',\r\n        sStatus: 'NO STATE',\r\n        lastPumpDate: '--.--.--',\r\n        lastPumpTime: '--:--:--',\r\n        subTopic: 'k1/pumpe/2/ret/pumpe k1/pumpe/2/ret/pumpe/time',\r\n        pubTopic: ''\r\n      }\r\n    ]\r\n  );\r\n\r\n  // ---------Message for this ci (control/indicator)?----------\r\n  public onMessage (message: Message): void {\r\n    // -------search for pump topic-----------------------------\r\n    this.pumps.forEach(pump => {\r\n      const aSubTopic = pump.subTopic.split(' ')\r\n      if (aSubTopic.includes(message.topic)) {\r\n        // ---pump topic found ---------------------------------\r\n        if (message.topic.includes('time')) {\r\n          if (message.payload.length === 15) {\r\n            pump.lastPumpDate = message.payload.substring(6, 8) + '.' + message.payload.substring(4, 6) + '.' + message.payload.substring(2, 4)\r\n            pump.lastPumpTime = message.payload.substring(9, 11) + ':' + message.payload.substring(11, 13) + ':' + message.payload.substring(13, 15)\r\n          } else {\r\n            pump.lastPumpDate = geo0.noDate\r\n            pump.lastPumpTime = geo0.noTime\r\n          }\r\n        } else { // -pump info----------------------------------\r\n          pump.lastPumpDate = geo0.noDate\r\n          pump.lastPumpTime = geo0.noTime\r\n          if (pump.type === 'D1' || pump.type === 'ESP32') {\r\n            const aPayload = JSON.parse(message.payload)\r\n            pump.iPumpState = -1\r\n            if (aPayload.pumpe === 0 || aPayload.pumpe === '0') pump.iPumpState = 0\r\n            if (aPayload.pumpe === 1 || aPayload.pumpe === '1') pump.iPumpState = 1\r\n            pump.sSensor = `${aPayload.sensor}`\r\n            pump.sStatus = aPayload.status\r\n          }\r\n        }\r\n      } // END pump topic found\r\n    })\r\n  }\r\n\r\n  public publishCi (topic: string, payload: string): void {\r\n    // console.log('publish:', '-t ' + topic + ' -m ' + payload)\r\n    this.publish(topic, payload, false, 0)\r\n  }\r\n}\r\n\r\nexport const ciPumpController = new CiPumpController()\r\n"]}]}