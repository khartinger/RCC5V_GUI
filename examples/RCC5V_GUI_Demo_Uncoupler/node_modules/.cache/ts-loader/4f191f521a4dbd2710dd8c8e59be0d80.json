{"remainingRequest":"G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js??ref--13-1!G:\\work3\\vue\\haus2\\src\\controller\\CiPumpController.ts","dependencies":[{"path":"G:\\work3\\vue\\haus2\\src\\controller\\CiPumpController.ts","mtime":1672656666382},{"path":"G:\\work3\\vue\\haus2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgX19leHRlbmRzIH0gZnJvbSAidHNsaWIiOw0KLy8gX19fX19fQ2lQdW1wQ29udHJvbGxlci50c19fX19fX19fX19fX19fX19fX19fX2toYXJ0aW5nZXJfX19fXw0KLy8gMjAyMi0wMS0wMTogbmV3DQovLyAyMDIyLTA5LTE0OiBhZGQgLmNhdGNoKChlKSAuLikgdG8gdGhpcy5wdWJsaXNoDQovLyAyMDIzLTAxLTAyOiBpbXBvcnQgeyBnZW8wIH0gY2hhbmdlZA0KaW1wb3J0IHsgcmVhY3RpdmUgfSBmcm9tICd2dWUnOw0KaW1wb3J0IHsgQ2lCYXNlQ29udHJvbGxlciB9IGZyb20gJy4vQ2lCYXNlQ29udHJvbGxlcic7DQppbXBvcnQgeyBnZW8wIH0gZnJvbSAnLi4vY2xhc3Nlcy9HZW8nOw0KdmFyIENpUHVtcENvbnRyb2xsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7DQogICAgX19leHRlbmRzKENpUHVtcENvbnRyb2xsZXIsIF9zdXBlcik7DQogICAgZnVuY3Rpb24gQ2lQdW1wQ29udHJvbGxlcigpIHsNCiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7DQogICAgICAgIF90aGlzLnB1bXBzID0gcmVhY3RpdmUoWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlkOiAncHVtcDMnLA0KICAgICAgICAgICAgICAgIG5hbWU6ICdQdW1wZTMtMzInLA0KICAgICAgICAgICAgICAgIHR5cGU6ICdFU1AzMicsDQogICAgICAgICAgICAgICAgaVB1bXBTdGF0ZTogLTEsDQogICAgICAgICAgICAgICAgc1NlbnNvcjogJy0nLA0KICAgICAgICAgICAgICAgIHNTdGF0dXM6ICdOTyBTVEFURScsDQogICAgICAgICAgICAgICAgbGFzdFB1bXBEYXRlOiAnLS0uLS0uLS0nLA0KICAgICAgICAgICAgICAgIGxhc3RQdW1wVGltZTogJy0tOi0tOi0tJywNCiAgICAgICAgICAgICAgICBzdWJUb3BpYzogJ2lwL2gvaHowL3B1bXBlLzMvcmV0L3N0YXR1cyBpcC9oL2h6MC9wdW1wZS8zL3RpbWUnLA0KICAgICAgICAgICAgICAgIHB1YlRvcGljOiAnJw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLyoNCiAgICAgICAgICAgIHsgLy8gS2VsbGVyOiBCZXJlaWNoIDEsIEhlaXpyYXVtDQogICAgICAgICAgICAgIGlkOiAncHVtcDEnLA0KICAgICAgICAgICAgICBuYW1lOiAnUHVtcGUxRScsDQogICAgICAgICAgICAgIHR5cGU6ICdFU1AzMicsDQogICAgICAgICAgICAgIGlQdW1wU3RhdGU6IC0xLA0KICAgICAgICAgICAgICBzU2Vuc29yOiAnLScsDQogICAgICAgICAgICAgIHNTdGF0dXM6ICdOTyBTVEFURScsDQogICAgICAgICAgICAgIGxhc3RQdW1wRGF0ZTogJy0tLi0tLi0tJywNCiAgICAgICAgICAgICAgbGFzdFB1bXBUaW1lOiAnLS06LS06LS0nLA0KICAgICAgICAgICAgICBzdWJUb3BpYzogJ2sxL3B1bXBlLzEvcmV0L3B1bXBlIGsxL3B1bXBlLzEvcmV0L3B1bXBlL3RpbWUnLA0KICAgICAgICAgICAgICBwdWJUb3BpYzogJycNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7IC8vIEtlbGxlcjogQmVyZWljaCAxLCBIZWl6cmF1bQ0KICAgICAgICAgICAgICBpZDogJ3B1bXAyJywNCiAgICAgICAgICAgICAgbmFtZTogJ1B1bXBlMkQnLA0KICAgICAgICAgICAgICB0eXBlOiAnRDEnLA0KICAgICAgICAgICAgICBpUHVtcFN0YXRlOiAtMSwNCiAgICAgICAgICAgICAgc1NlbnNvcjogJy0nLA0KICAgICAgICAgICAgICBzU3RhdHVzOiAnTk8gU1RBVEUnLA0KICAgICAgICAgICAgICBsYXN0UHVtcERhdGU6ICctLS4tLS4tLScsDQogICAgICAgICAgICAgIGxhc3RQdW1wVGltZTogJy0tOi0tOi0tJywNCiAgICAgICAgICAgICAgc3ViVG9waWM6ICdrMS9wdW1wZS8yL3JldC9wdW1wZSBrMS9wdW1wZS8yL3JldC9wdW1wZS90aW1lJywNCiAgICAgICAgICAgICAgcHViVG9waWM6ICcnDQogICAgICAgICAgICB9DQogICAgICAgICAgICAqLw0KICAgICAgICBdKTsNCiAgICAgICAgcmV0dXJuIF90aGlzOw0KICAgIH0NCiAgICAvLyAtLS0tLS0tLS1NZXNzYWdlIGZvciB0aGlzIGNpIChjb250cm9sL2luZGljYXRvcik/LS0tLS0tLS0tLQ0KICAgIENpUHVtcENvbnRyb2xsZXIucHJvdG90eXBlLm9uTWVzc2FnZSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7DQogICAgICAgIC8vIC0tLS0tLS1zZWFyY2ggZm9yIHB1bXAgdG9waWMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICB0aGlzLnB1bXBzLmZvckVhY2goZnVuY3Rpb24gKHB1bXApIHsNCiAgICAgICAgICAgIHZhciBhU3ViVG9waWMgPSBwdW1wLnN1YlRvcGljLnNwbGl0KCcgJyk7DQogICAgICAgICAgICBpZiAoYVN1YlRvcGljLmluY2x1ZGVzKG1lc3NhZ2UudG9waWMpKSB7DQogICAgICAgICAgICAgICAgLy8gLS0tcHVtcCB0b3BpYyBmb3VuZCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS50b3BpYy5pbmNsdWRlcygndGltZScpKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCd0aW1lLXBheWxvYWQ6ICcsIG1lc3NhZ2UucGF5bG9hZCArICcsIGxlbj0nICsgbWVzc2FnZS5wYXlsb2FkLmxlbmd0aCkNCiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucGF5bG9hZC5sZW5ndGggPT09IDE1KSB7IC8vIHRpbWUgc3RyaW5nIG1heSBiZSBPSw0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3RpbWUtcGF5bG9hZDogJywgbWVzc2FnZS5wYXlsb2FkICsgJywgbGVuPScgKyBtZXNzYWdlLnBheWxvYWQubGVuZ3RoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHB1bXAubGFzdFB1bXBEYXRlID0gbWVzc2FnZS5wYXlsb2FkLnN1YnN0cmluZyg2LCA4KSArICcuJyArIG1lc3NhZ2UucGF5bG9hZC5zdWJzdHJpbmcoNCwgNikgKyAnLicgKyBtZXNzYWdlLnBheWxvYWQuc3Vic3RyaW5nKDIsIDQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcHVtcC5sYXN0UHVtcFRpbWUgPSBtZXNzYWdlLnBheWxvYWQuc3Vic3RyaW5nKDksIDExKSArICc6JyArIG1lc3NhZ2UucGF5bG9hZC5zdWJzdHJpbmcoMTEsIDEzKSArICc6JyArIG1lc3NhZ2UucGF5bG9hZC5zdWJzdHJpbmcoMTMsIDE1KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsgLy8gd3JvbmcgdGltZSBzdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgICAgIHB1bXAubGFzdFB1bXBEYXRlID0gZ2VvMC5ub0RhdGU7DQogICAgICAgICAgICAgICAgICAgICAgICBwdW1wLmxhc3RQdW1wVGltZSA9IGdlbzAubm9UaW1lOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvbk1lc3NhZ2UgLSB0aW1lIGxhc3RQdW1wZGF0ZTogJywgcHVtcC5sYXN0UHVtcERhdGUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsgLy8gLXB1bXAgaW5mby0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2dlbzAubm9EYXRlPScsIGdlbzAubm9EYXRlKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gcHVtcC5sYXN0UHVtcERhdGUgPSBnZW8wLm5vRGF0ZQ0KICAgICAgICAgICAgICAgICAgICAvLyBwdW1wLmxhc3RQdW1wVGltZSA9IGdlbzAubm9UaW1lDQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvbk1lc3NhZ2UgLSBwdW1waW5mbyBsYXN0UHVtcGRhdGU6ICcsIHB1bXAubGFzdFB1bXBEYXRlKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHB1bXAudHlwZSA9PT0gJ0QxJyB8fCBwdW1wLnR5cGUgPT09ICdFU1AzMicpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhUGF5bG9hZCA9IEpTT04ucGFyc2UobWVzc2FnZS5wYXlsb2FkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHB1bXAuaVB1bXBTdGF0ZSA9IC0xOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFQYXlsb2FkLnB1bXBlID09PSAwIHx8IGFQYXlsb2FkLnB1bXBlID09PSAnMCcpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVtcC5pUHVtcFN0YXRlID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhUGF5bG9hZC5wdW1wZSA9PT0gMSB8fCBhUGF5bG9hZC5wdW1wZSA9PT0gJzEnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1bXAuaVB1bXBTdGF0ZSA9IDE7DQogICAgICAgICAgICAgICAgICAgICAgICBwdW1wLnNTZW5zb3IgPSAiIiArIGFQYXlsb2FkLnNlbnNvcjsNCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpMSA9IChhUGF5bG9hZC53YXRlcmxldmVsKS5pbmRleE9mKCd8Jyk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaTEgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVtcC5zU3RhdHVzID0gKGFQYXlsb2FkLndhdGVybGV2ZWwpLnN1YnN0cmluZygwLCAzKSArICcgJyArIChhUGF5bG9hZC53YXRlcmxldmVsKS5zdWJzdHJpbmcoaTEgKyAyLCBpMSArIDgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVtcC5zU3RhdHVzID0gJ25vIHctbGV2ZWwnOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSAvLyBFTkQgcHVtcCB0b3BpYyBmb3VuZA0KICAgICAgICB9KTsNCiAgICB9Ow0KICAgIENpUHVtcENvbnRyb2xsZXIucHJvdG90eXBlLnB1Ymxpc2hDaSA9IGZ1bmN0aW9uICh0b3BpYywgcGF5bG9hZCkgew0KICAgICAgICAvLyBjb25zb2xlLmxvZygncHVibGlzaDonLCAnLXQgJyArIHRvcGljICsgJyAtbSAnICsgcGF5bG9hZCkNCiAgICAgICAgdGhpcy5wdWJsaXNoKHRvcGljLCBwYXlsb2FkLCBmYWxzZSwgMCkuY2F0Y2goZnVuY3Rpb24gKGUpIHsgY29uc29sZS5lcnJvcignQ2lQdW1wQ29udHJvbGxlcjogRVJST1I6JywgZSk7IH0pOw0KICAgIH07DQogICAgcmV0dXJuIENpUHVtcENvbnRyb2xsZXI7DQp9KENpQmFzZUNvbnRyb2xsZXIpKTsNCmV4cG9ydCB7IENpUHVtcENvbnRyb2xsZXIgfTsNCmV4cG9ydCB2YXIgY2lQdW1wQ29udHJvbGxlciA9IG5ldyBDaVB1bXBDb250cm9sbGVyKCk7DQo="},{"version":3,"file":"G:\\work3\\vue\\haus2\\src\\controller\\CiPumpController.ts","sourceRoot":"","sources":["G:\\work3\\vue\\haus2\\src\\controller\\CiPumpController.ts"],"names":[],"mappings":"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","sourcesContent":["// ______CiPumpController.ts_____________________khartinger_____\r\n// 2022-01-01: new\r\n// 2022-09-14: add .catch((e) ..) to this.publish\r\n// 2023-01-02: import { geo0 } changed\r\nimport { reactive } from 'vue'\r\nimport { Message } from '@/services/CiMqttClient'\r\nimport { CiBaseController, IBase } from './CiBaseController'\r\nimport { geo0 } from '../classes/Geo'\r\n\r\nexport interface Pump extends IBase {\r\n  type: string;\r\n  iPumpState: number;\r\n  sSensor?: string;\r\n  sStatus?: string;\r\n  lastPumpDate: string;\r\n  lastPumpTime: string;\r\n}\r\n\r\nexport class CiPumpController extends CiBaseController {\r\n  public pumps: Array<Pump> = reactive(\r\n    [\r\n      { // Keller: Bereich 1, Heizraum\r\n        id: 'pump3',\r\n        name: 'Pumpe3-32',\r\n        type: 'ESP32',\r\n        iPumpState: -1,\r\n        sSensor: '-',\r\n        sStatus: 'NO STATE',\r\n        lastPumpDate: '--.--.--',\r\n        lastPumpTime: '--:--:--',\r\n        subTopic: 'ip/h/hz0/pumpe/3/ret/status ip/h/hz0/pumpe/3/time',\r\n        pubTopic: ''\r\n      }\r\n      /*\r\n      { // Keller: Bereich 1, Heizraum\r\n        id: 'pump1',\r\n        name: 'Pumpe1E',\r\n        type: 'ESP32',\r\n        iPumpState: -1,\r\n        sSensor: '-',\r\n        sStatus: 'NO STATE',\r\n        lastPumpDate: '--.--.--',\r\n        lastPumpTime: '--:--:--',\r\n        subTopic: 'k1/pumpe/1/ret/pumpe k1/pumpe/1/ret/pumpe/time',\r\n        pubTopic: ''\r\n      },\r\n      { // Keller: Bereich 1, Heizraum\r\n        id: 'pump2',\r\n        name: 'Pumpe2D',\r\n        type: 'D1',\r\n        iPumpState: -1,\r\n        sSensor: '-',\r\n        sStatus: 'NO STATE',\r\n        lastPumpDate: '--.--.--',\r\n        lastPumpTime: '--:--:--',\r\n        subTopic: 'k1/pumpe/2/ret/pumpe k1/pumpe/2/ret/pumpe/time',\r\n        pubTopic: ''\r\n      }\r\n      */\r\n    ]\r\n  );\r\n\r\n  // ---------Message for this ci (control/indicator)?----------\r\n  public onMessage (message: Message): void {\r\n    // -------search for pump topic-----------------------------\r\n    this.pumps.forEach(pump => {\r\n      const aSubTopic = pump.subTopic.split(' ')\r\n      if (aSubTopic.includes(message.topic)) {\r\n        // ---pump topic found ---------------------------------\r\n        if (message.topic.includes('time')) {\r\n          // console.log('time-payload: ', message.payload + ', len=' + message.payload.length)\r\n          if (message.payload.length === 15) { // time string may be OK\r\n            console.log('time-payload: ', message.payload + ', len=' + message.payload.length)\r\n            pump.lastPumpDate = message.payload.substring(6, 8) + '.' + message.payload.substring(4, 6) + '.' + message.payload.substring(2, 4)\r\n            pump.lastPumpTime = message.payload.substring(9, 11) + ':' + message.payload.substring(11, 13) + ':' + message.payload.substring(13, 15)\r\n          } else { // wrong time string\r\n            pump.lastPumpDate = geo0.noDate\r\n            pump.lastPumpTime = geo0.noTime\r\n          }\r\n          console.log('onMessage - time lastPumpdate: ', pump.lastPumpDate)\r\n        } else { // -pump info----------------------------------\r\n          console.log('geo0.noDate=', geo0.noDate)\r\n          // pump.lastPumpDate = geo0.noDate\r\n          // pump.lastPumpTime = geo0.noTime\r\n          console.log('onMessage - pumpinfo lastPumpdate: ', pump.lastPumpDate)\r\n          if (pump.type === 'D1' || pump.type === 'ESP32') {\r\n            const aPayload = JSON.parse(message.payload)\r\n            pump.iPumpState = -1\r\n            if (aPayload.pumpe === 0 || aPayload.pumpe === '0') pump.iPumpState = 0\r\n            if (aPayload.pumpe === 1 || aPayload.pumpe === '1') pump.iPumpState = 1\r\n            pump.sSensor = `${aPayload.sensor}`\r\n            const i1 = (aPayload.waterlevel).indexOf('|')\r\n            if (i1 > 0) {\r\n              pump.sStatus = (aPayload.waterlevel).substring(0, 3) + ' ' + (aPayload.waterlevel).substring(i1 + 2, i1 + 8)\r\n            } else {\r\n              pump.sStatus = 'no w-level'\r\n            }\r\n          }\r\n        }\r\n      } // END pump topic found\r\n    })\r\n  }\r\n\r\n  public publishCi (topic: string, payload: string): void {\r\n    // console.log('publish:', '-t ' + topic + ' -m ' + payload)\r\n    this.publish(topic, payload, false, 0).catch((e) => { console.error('CiPumpController: ERROR:', e) })\r\n  }\r\n}\r\n\r\nexport const ciPumpController = new CiPumpController()\r\n"]}]}