{"remainingRequest":"G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js??ref--13-1!G:\\work3\\vue\\haus2\\src\\controller\\CiSocket2Controller.ts","dependencies":[{"path":"G:\\work3\\vue\\haus2\\src\\controller\\CiSocket2Controller.ts","mtime":1663146307792},{"path":"G:\\work3\\vue\\haus2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgX19leHRlbmRzIH0gZnJvbSAidHNsaWIiOw0KLy8gX19fX19fQ2lTb2NrZXQyQ29udHJvbGxlci50c19fX19fX19fX19fX19fX19fX2toYXJ0aW5nZXJfX19fXw0KLy8gMjAyMi0wOC0wNzogbmV3DQovLyAyMDIyLTA5LTE0OiBhZGQgLmNhdGNoKChlKSAuLikgdG8gdGhpcy5wdWJsaXNoDQppbXBvcnQgeyByZWFjdGl2ZSB9IGZyb20gJ3Z1ZSc7DQppbXBvcnQgeyBDaUJhc2VDb250cm9sbGVyIH0gZnJvbSAnLi9DaUJhc2VDb250cm9sbGVyJzsNCnZhciBDaVNvY2tldDJDb250cm9sbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgew0KICAgIF9fZXh0ZW5kcyhDaVNvY2tldDJDb250cm9sbGVyLCBfc3VwZXIpOw0KICAgIGZ1bmN0aW9uIENpU29ja2V0MkNvbnRyb2xsZXIoKSB7DQogICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOw0KICAgICAgICBfdGhpcy5zb2NrZXRzID0gcmVhY3RpdmUoWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIHR5cGU6ICdkZWxvY2sxMTgyNicsDQogICAgICAgICAgICAgICAgaWQ6ICdzMS0zMTEzJywNCiAgICAgICAgICAgICAgICBuYW1lOiAnczEnLA0KICAgICAgICAgICAgICAgIGlTb2NrZXRTdGF0ZTogLTksDQogICAgICAgICAgICAgICAgYmF0dGVyeTogJy0nLA0KICAgICAgICAgICAgICAgIHRleHQ1OiAnc29ja2V0X3MxJywNCiAgICAgICAgICAgICAgICBzdWJUb3BpYzogJ2lwL2gvc3RlY2tkb3NlL3MxL1JFU1VMVCcsDQogICAgICAgICAgICAgICAgcHViVG9waWM6ICdpcC9oL3N0ZWNrZG9zZS9zMS9jbW5kL1BPV0VSJywNCiAgICAgICAgICAgICAgICBwdWJQYXlsb2FkOiAnT0ZGJywNCiAgICAgICAgICAgICAgICBwdWJQYXlsb2FkT246ICdPTicNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgdHlwZTogJ2RlbG9jazExODI2JywNCiAgICAgICAgICAgICAgICBpZDogJ3MyLTQ0OTcnLA0KICAgICAgICAgICAgICAgIG5hbWU6ICdzMicsDQogICAgICAgICAgICAgICAgaVNvY2tldFN0YXRlOiAtOSwNCiAgICAgICAgICAgICAgICBiYXR0ZXJ5OiAnLScsDQogICAgICAgICAgICAgICAgdGV4dDU6ICdzb2NrZXRfczInLA0KICAgICAgICAgICAgICAgIHN1YlRvcGljOiAnaXAvaC9zdGVja2Rvc2UvczIvUkVTVUxUJywNCiAgICAgICAgICAgICAgICBwdWJUb3BpYzogJ2lwL2gvc3RlY2tkb3NlL3MyL2NtbmQvUE9XRVInLA0KICAgICAgICAgICAgICAgIHB1YlBheWxvYWQ6ICdPRkYnLA0KICAgICAgICAgICAgICAgIHB1YlBheWxvYWRPbjogJ09OJw0KICAgICAgICAgICAgfQ0KICAgICAgICBdKTsNCiAgICAgICAgcmV0dXJuIF90aGlzOw0KICAgIH0NCiAgICBDaVNvY2tldDJDb250cm9sbGVyLnByb3RvdHlwZS5vbk1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSkgew0KICAgICAgICB0aGlzLnNvY2tldHMuZm9yRWFjaChmdW5jdGlvbiAoc29ja2V0KSB7DQogICAgICAgICAgICB2YXIgYVN1YlRvcGljID0gc29ja2V0LnN1YlRvcGljLnNwbGl0KCcgJyk7DQogICAgICAgICAgICBpZiAoYVN1YlRvcGljLmluY2x1ZGVzKG1lc3NhZ2UudG9waWMpKSB7DQogICAgICAgICAgICAgICAgLy8gLS0tc29ja2V0IGZvdW5kIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAgICAgICAgIGlmIChzb2NrZXQudHlwZSA9PT0gJ2RlbG9jazExODI2Jykgew0KICAgICAgICAgICAgICAgICAgICB2YXIgYVBheWxvYWQgPSBKU09OLnBhcnNlKG1lc3NhZ2UucGF5bG9hZCk7DQogICAgICAgICAgICAgICAgICAgIGlmICgoYVBheWxvYWQuUE9XRVIgPT09ICdPTicpIHx8IChhUGF5bG9hZC5QT1dFUiA9PT0gJ29uJykpDQogICAgICAgICAgICAgICAgICAgICAgICBzb2NrZXQuaVNvY2tldFN0YXRlID0gLTE7DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChhUGF5bG9hZC5QT1dFUiA9PT0gJ09GRicpIHx8IChhUGF5bG9hZC5QT1dFUiA9PT0gJ29mZicpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvY2tldC5pU29ja2V0U3RhdGUgPSAtMjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvY2tldC5pU29ja2V0U3RhdGUgPSAtOTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnQ2lTb2NrZXRDb250cm9sbGVyOm9uTWVzc2FnZTogbWVzc2FnZS5wYXlsb2FkPScsIG1lc3NhZ2UucGF5bG9hZCkNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgfTsNCiAgICBDaVNvY2tldDJDb250cm9sbGVyLnByb3RvdHlwZS5wdWJsaXNoQ2kgPSBmdW5jdGlvbiAodG9waWMsIHBheWxvYWQpIHsNCiAgICAgICAgLy8gY29uc29sZS5sb2coJ0NpU29ja2V0Q29udHJvbGxlcjpwdWJsaXNoQ2k6JywgJy10ICcgKyB0b3BpYyArICcgLW0gJyArIHBheWxvYWQpDQogICAgICAgIHRoaXMucHVibGlzaCh0b3BpYywgcGF5bG9hZCwgZmFsc2UsIDApLmNhdGNoKGZ1bmN0aW9uIChlKSB7IGNvbnNvbGUuZXJyb3IoJ0NpU29ja2V0MkNvbnRyb2xsZXI6IEVSUk9SOicsIGUpOyB9KTsNCiAgICB9Ow0KICAgIHJldHVybiBDaVNvY2tldDJDb250cm9sbGVyOw0KfShDaUJhc2VDb250cm9sbGVyKSk7DQpleHBvcnQgeyBDaVNvY2tldDJDb250cm9sbGVyIH07DQpleHBvcnQgdmFyIGNpU29ja2V0MkNvbnRyb2xsZXIgPSBuZXcgQ2lTb2NrZXQyQ29udHJvbGxlcigpOw0K"},{"version":3,"file":"G:\\work3\\vue\\haus2\\src\\controller\\CiSocket2Controller.ts","sourceRoot":"","sources":["G:\\work3\\vue\\haus2\\src\\controller\\CiSocket2Controller.ts"],"names":[],"mappings":";AAAA,gEAAgE;AAChE,kBAAkB;AAClB,iDAAiD;AACjD,OAAO,EAAE,QAAQ,EAAE,MAAM,KAAK,CAAA;AAE9B,OAAO,EAAE,gBAAgB,EAAS,MAAM,oBAAoB,CAAA;AAU5D;IAAyC,uCAAgB;IAAzD;QAAA,qEAoDC;QAnDQ,aAAO,GAAkB,QAAQ,CACtC;YACE;gBACE,IAAI,EAAE,aAAa;gBACnB,EAAE,EAAE,SAAS;gBACb,IAAI,EAAE,IAAI;gBACV,YAAY,EAAE,CAAC,CAAC;gBAChB,OAAO,EAAE,GAAG;gBACZ,KAAK,EAAE,WAAW;gBAClB,QAAQ,EAAE,0BAA0B;gBACpC,QAAQ,EAAE,8BAA8B;gBACxC,UAAU,EAAE,KAAK;gBACjB,YAAY,EAAE,IAAI;aACnB;YACD;gBACE,IAAI,EAAE,aAAa;gBACnB,EAAE,EAAE,SAAS;gBACb,IAAI,EAAE,IAAI;gBACV,YAAY,EAAE,CAAC,CAAC;gBAChB,OAAO,EAAE,GAAG;gBACZ,KAAK,EAAE,WAAW;gBAClB,QAAQ,EAAE,0BAA0B;gBACpC,QAAQ,EAAE,8BAA8B;gBACxC,UAAU,EAAE,KAAK;gBACjB,YAAY,EAAE,IAAI;aACnB;SACF,CACF,CAAC;;IAwBJ,CAAC;IAtBQ,uCAAS,GAAhB,UAAkB,OAAgB;QAChC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,UAAA,MAAM;YACzB,IAAM,SAAS,GAAG,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;YAC5C,IAAI,SAAS,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBACrC,oDAAoD;gBACpD,IAAI,MAAM,CAAC,IAAI,KAAK,aAAa,EAAE;oBACjC,IAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,CAAA;oBAC5C,IAAI,CAAC,QAAQ,CAAC,KAAK,KAAK,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,KAAK,IAAI,CAAC;wBAAE,MAAM,CAAC,YAAY,GAAG,CAAC,CAAC,CAAA;yBAC/E;wBACH,IAAI,CAAC,QAAQ,CAAC,KAAK,KAAK,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,KAAK,KAAK,CAAC;4BAAE,MAAM,CAAC,YAAY,GAAG,CAAC,CAAC,CAAA;6BACjF;4BAAE,MAAM,CAAC,YAAY,GAAG,CAAC,CAAC,CAAA;yBAAE;qBAClC;iBACF;gBACD,iFAAiF;aAClF;QACH,CAAC,CAAC,CAAA;IACJ,CAAC;IAEM,uCAAS,GAAhB,UAAkB,KAAa,EAAE,OAAe;QAC9C,iFAAiF;QACjF,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,UAAC,CAAC,IAAO,OAAO,CAAC,KAAK,CAAC,6BAA6B,EAAE,CAAC,CAAC,CAAA,CAAC,CAAC,CAAC,CAAA;IAC1G,CAAC;IACH,0BAAC;AAAD,CAAC,AApDD,CAAyC,gBAAgB,GAoDxD;;AAED,MAAM,CAAC,IAAM,mBAAmB,GAAG,IAAI,mBAAmB,EAAE,CAAA","sourcesContent":["// ______CiSocket2Controller.ts__________________khartinger_____\r\n// 2022-08-07: new\r\n// 2022-09-14: add .catch((e) ..) to this.publish\r\nimport { reactive } from 'vue'\r\nimport { Message } from '@/services/CiMqttClient'\r\nimport { CiBaseController, IBase } from './CiBaseController'\r\n\r\nexport interface Socket extends IBase {\r\n  type: string;\r\n  iSocketState: number;\r\n  battery?: string;\r\n  text5?: string;\r\n  pubPayloadOn?: string;\r\n}\r\n\r\nexport class CiSocket2Controller extends CiBaseController {\r\n  public sockets: Array<Socket> = reactive(\r\n    [\r\n      {\r\n        type: 'delock11826', // e1603=IKEA\r\n        id: 's1-3113',\r\n        name: 's1',\r\n        iSocketState: -9, // 0x9999FF,\r\n        battery: '-',\r\n        text5: 'socket_s1',\r\n        subTopic: 'ip/h/steckdose/s1/RESULT',\r\n        pubTopic: 'ip/h/steckdose/s1/cmnd/POWER',\r\n        pubPayload: 'OFF',\r\n        pubPayloadOn: 'ON'\r\n      },\r\n      {\r\n        type: 'delock11826', // e1603=IKEA\r\n        id: 's2-4497',\r\n        name: 's2',\r\n        iSocketState: -9, // 0x9999FF,\r\n        battery: '-',\r\n        text5: 'socket_s2',\r\n        subTopic: 'ip/h/steckdose/s2/RESULT',\r\n        pubTopic: 'ip/h/steckdose/s2/cmnd/POWER',\r\n        pubPayload: 'OFF',\r\n        pubPayloadOn: 'ON'\r\n      }\r\n    ]\r\n  );\r\n\r\n  public onMessage (message: Message): void {\r\n    this.sockets.forEach(socket => {\r\n      const aSubTopic = socket.subTopic.split(' ')\r\n      if (aSubTopic.includes(message.topic)) {\r\n        // ---socket found ---------------------------------\r\n        if (socket.type === 'delock11826') {\r\n          const aPayload = JSON.parse(message.payload)\r\n          if ((aPayload.POWER === 'ON') || (aPayload.POWER === 'on')) socket.iSocketState = -1\r\n          else {\r\n            if ((aPayload.POWER === 'OFF') || (aPayload.POWER === 'off')) socket.iSocketState = -2\r\n            else { socket.iSocketState = -9 }\r\n          }\r\n        }\r\n        // console.log('CiSocketController:onMessage: message.payload=', message.payload)\r\n      }\r\n    })\r\n  }\r\n\r\n  public publishCi (topic: string, payload: string): void {\r\n    // console.log('CiSocketController:publishCi:', '-t ' + topic + ' -m ' + payload)\r\n    this.publish(topic, payload, false, 0).catch((e) => { console.error('CiSocket2Controller: ERROR:', e) })\r\n  }\r\n}\r\n\r\nexport const ciSocket2Controller = new CiSocket2Controller()\r\n"]}]}