{"remainingRequest":"G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js??ref--13-1!G:\\work3\\vue\\haus2\\src\\controller\\CiLampController.ts","dependencies":[{"path":"G:\\work3\\vue\\haus2\\src\\controller\\CiLampController.ts","mtime":1663146210857},{"path":"G:\\work3\\vue\\haus2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgX19leHRlbmRzIH0gZnJvbSAidHNsaWIiOw0KLy8gX19fX19fQ2lMYW1wQ29udHJvbGxlci50c19fX19fX19fX19fX19fX19fX19fX2toYXJ0aW5nZXJfX19fXw0KLy8gMjAyMS0xMi0yODogbmV3DQovLyAyMDIyLTA5LTE0OiBhZGQgLmNhdGNoKChlKSAuLikgdG8gdGhpcy5wdWJsaXNoDQppbXBvcnQgeyByZWFjdGl2ZSB9IGZyb20gJ3Z1ZSc7DQppbXBvcnQgeyBDaUJhc2VDb250cm9sbGVyIH0gZnJvbSAnLi9DaUJhc2VDb250cm9sbGVyJzsNCnZhciBDaUxhbXBDb250cm9sbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgew0KICAgIF9fZXh0ZW5kcyhDaUxhbXBDb250cm9sbGVyLCBfc3VwZXIpOw0KICAgIGZ1bmN0aW9uIENpTGFtcENvbnRyb2xsZXIoKSB7DQogICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzOw0KICAgICAgICBfdGhpcy5sYW1wcyA9IHJlYWN0aXZlKFsNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZDogJ2xlMWFyMycsDQogICAgICAgICAgICAgICAgbmFtZTogJ0xhbXBlMycsDQogICAgICAgICAgICAgICAgaUxhbXBTdGF0ZTogLTEsDQogICAgICAgICAgICAgICAgc3ViVG9waWM6ICdlMS9hci9saWNodC8zL3JldC9saWNodCcsDQogICAgICAgICAgICAgICAgcHViVG9waWM6ICdlMS9hci9saWNodC8zL3NldC9saWNodCcsDQogICAgICAgICAgICAgICAgcHViUGF5bG9hZDogJ3VtJw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZDogJ2xvMnNsMScsDQogICAgICAgICAgICAgICAgbmFtZTogJ0xhbXBlMScsDQogICAgICAgICAgICAgICAgaUxhbXBTdGF0ZTogLTEsDQogICAgICAgICAgICAgICAgc3ViVG9waWM6ICdvMi9zbC9saWNodC8xL3JldC9saWNodCcsDQogICAgICAgICAgICAgICAgcHViVG9waWM6ICdvMi9zbC9saWNodC8xL3NldC9saWNodCcsDQogICAgICAgICAgICAgICAgcHViUGF5bG9hZDogJy0xJw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZDogJ2xlM2h1MScsDQogICAgICAgICAgICAgICAgbmFtZTogJ0h1ZXR0ZScsDQogICAgICAgICAgICAgICAgaUxhbXBTdGF0ZTogLTEsDQogICAgICAgICAgICAgICAgc3ViVG9waWM6ICdpcC9oL2h1Mi9odWV0dGUvcmV0L3N0YXR1cyBpcC9oL2h1Mi9odWV0dGUvcmV0L2xhbXBlJywNCiAgICAgICAgICAgICAgICBwdWJUb3BpYzogJ2lwL2gvaHUyL2h1ZXR0ZS9zZXQvbGFtcGUnLA0KICAgICAgICAgICAgICAgIHB1YlBheWxvYWQ6ICctMScNCiAgICAgICAgICAgIH0NCiAgICAgICAgXSk7DQogICAgICAgIHJldHVybiBfdGhpczsNCiAgICB9DQogICAgLy8gLS0tLS0tLS0tTWVzc2FnZSBmb3IgdGhpcyBjaSAoY29udHJvbC9pbmRpY2F0b3IpPy0tLS0tLS0tLS0NCiAgICBDaUxhbXBDb250cm9sbGVyLnByb3RvdHlwZS5vbk1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSkgew0KICAgICAgICB0aGlzLmxhbXBzLmZvckVhY2goZnVuY3Rpb24gKGxhbXApIHsNCiAgICAgICAgICAgIHZhciBhU3ViVG9waWMgPSBsYW1wLnN1YlRvcGljLnNwbGl0KCcgJyk7DQogICAgICAgICAgICBpZiAoYVN1YlRvcGljLmluY2x1ZGVzKG1lc3NhZ2UudG9waWMpKSB7DQogICAgICAgICAgICAgICAgLy8gLS0tbGFtcCB0b3BpYyBmb3VuZCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS50b3BpYy5pbmNsdWRlcygncmV0L3N0YXR1cycpKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIC1sYW1wIHN0YXRlIGZyb20gaHVldHRlIC0gc3RhdHVzLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnQ2lMYW1wQ29udHJvbGxlci5vbk1lc3NhZ2UgLXQgJywgbWVzc2FnZS50b3BpYyArICcgLW0gJyArIG1lc3NhZ2UucGF5bG9hZCkNCiAgICAgICAgICAgICAgICAgICAgdmFyIGFQYXlsb2FkID0gSlNPTi5wYXJzZShtZXNzYWdlLnBheWxvYWQpOw0KICAgICAgICAgICAgICAgICAgICBsYW1wLmlMYW1wU3RhdGUgPSAtMTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGFQYXlsb2FkLkxhbXAgPT09IDAgfHwgYVBheWxvYWQuTGFtcCA9PT0gJzAnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgbGFtcC5pTGFtcFN0YXRlID0gMDsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGFQYXlsb2FkLkxhbXAgPT09IDEgfHwgYVBheWxvYWQuTGFtcCA9PT0gJzEnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgbGFtcC5pTGFtcFN0YXRlID0gMTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIC8vIC1vdGhlciBsYW1wLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAgICAgICAgICAgICBpZiAoKG1lc3NhZ2UucGF5bG9hZCA9PT0gJzEnKSB8fCAobWVzc2FnZS5wYXlsb2FkID09PSAnb24nKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGxhbXAuaUxhbXBTdGF0ZSA9IDE7DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChtZXNzYWdlLnBheWxvYWQgPT09ICcwJykgfHwgKG1lc3NhZ2UucGF5bG9hZCA9PT0gJ29mZicpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbXAuaUxhbXBTdGF0ZSA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYW1wLmlMYW1wU3RhdGUgPSAtMTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnQ2lMYW1wQ29udHJvbGxlcjpvbk1lc3NhZ2U6IG1lc3NhZ2UucGF5bG9hZD0nLCBtZXNzYWdlLnBheWxvYWQpDQogICAgICAgICAgICB9IC8vIEVORCBsYW1wIHRvcGljIGZvdW5kDQogICAgICAgIH0pOw0KICAgIH07DQogICAgQ2lMYW1wQ29udHJvbGxlci5wcm90b3R5cGUucHVibGlzaENpID0gZnVuY3Rpb24gKHRvcGljLCBwYXlsb2FkKSB7DQogICAgICAgIC8vIGNvbnNvbGUubG9nKCdDaUxhbXBDb250cm9sbGVyOnB1Ymxpc2hDaTonLCAnLXQgJyArIHRvcGljICsgJyAtbSAnICsgcGF5bG9hZCkNCiAgICAgICAgdGhpcy5wdWJsaXNoKHRvcGljLCBwYXlsb2FkLCBmYWxzZSwgMCkuY2F0Y2goZnVuY3Rpb24gKGUpIHsgY29uc29sZS5lcnJvcignQ2lMYW1wQ29udHJvbGxlcjogRVJST1I6JywgZSk7IH0pOw0KICAgIH07DQogICAgcmV0dXJuIENpTGFtcENvbnRyb2xsZXI7DQp9KENpQmFzZUNvbnRyb2xsZXIpKTsNCmV4cG9ydCB7IENpTGFtcENvbnRyb2xsZXIgfTsNCmV4cG9ydCB2YXIgY2lMYW1wQ29udHJvbGxlciA9IG5ldyBDaUxhbXBDb250cm9sbGVyKCk7DQo="},{"version":3,"file":"G:\\work3\\vue\\haus2\\src\\controller\\CiLampController.ts","sourceRoot":"","sources":["G:\\work3\\vue\\haus2\\src\\controller\\CiLampController.ts"],"names":[],"mappings":";AAAA,gEAAgE;AAChE,kBAAkB;AAClB,iDAAiD;AACjD,OAAO,EAAE,QAAQ,EAAE,MAAM,KAAK,CAAA;AAE9B,OAAO,EAAE,gBAAgB,EAAS,MAAM,oBAAoB,CAAA;AAQ5D;IAAsC,oCAAgB;IAAtD;QAAA,qEA4DC;QA3DQ,WAAK,GAAgB,QAAQ,CAClC;YACE;gBACE,EAAE,EAAE,QAAQ;gBACZ,IAAI,EAAE,QAAQ;gBACd,UAAU,EAAE,CAAC,CAAC;gBACd,QAAQ,EAAE,yBAAyB;gBACnC,QAAQ,EAAE,yBAAyB;gBACnC,UAAU,EAAE,IAAI;aACjB;YACD;gBACE,EAAE,EAAE,QAAQ;gBACZ,IAAI,EAAE,QAAQ;gBACd,UAAU,EAAE,CAAC,CAAC;gBACd,QAAQ,EAAE,yBAAyB;gBACnC,QAAQ,EAAE,yBAAyB;gBACnC,UAAU,EAAE,IAAI;aACjB;YACD;gBACE,EAAE,EAAE,QAAQ;gBACZ,IAAI,EAAE,QAAQ;gBACd,UAAU,EAAE,CAAC,CAAC;gBACd,QAAQ,EAAE,sDAAsD;gBAChE,QAAQ,EAAE,2BAA2B;gBACrC,UAAU,EAAE,IAAI;aACjB;SACF,CACF,CAAC;;IAgCJ,CAAC;IA9BC,8DAA8D;IACvD,oCAAS,GAAhB,UAAkB,OAAgB;QAChC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,UAAA,IAAI;YACrB,IAAM,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;YAC1C,IAAI,SAAS,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBACrC,wDAAwD;gBACxD,IAAI,OAAO,CAAC,KAAK,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE;oBACxC,sDAAsD;oBACtD,0FAA0F;oBAC1F,IAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,CAAA;oBAC5C,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,CAAA;oBACpB,IAAI,QAAQ,CAAC,IAAI,KAAK,CAAC,IAAI,QAAQ,CAAC,IAAI,KAAK,GAAG;wBAAE,IAAI,CAAC,UAAU,GAAG,CAAC,CAAA;oBACrE,IAAI,QAAQ,CAAC,IAAI,KAAK,CAAC,IAAI,QAAQ,CAAC,IAAI,KAAK,GAAG;wBAAE,IAAI,CAAC,UAAU,GAAG,CAAC,CAAA;iBACtE;qBAAM;oBACL,sDAAsD;oBACtD,IAAI,CAAC,OAAO,CAAC,OAAO,KAAK,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,KAAK,IAAI,CAAC;wBAAE,IAAI,CAAC,UAAU,GAAG,CAAC,CAAA;yBAC3E;wBACH,IAAI,CAAC,OAAO,CAAC,OAAO,KAAK,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,KAAK,KAAK,CAAC;4BAAE,IAAI,CAAC,UAAU,GAAG,CAAC,CAAA;6BAC5E;4BAAE,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,CAAA;yBAAE;qBAC9B;iBACF;gBACD,+EAA+E;aAChF,CAAC,uBAAuB;QAC3B,CAAC,CAAC,CAAA;IACJ,CAAC;IAEM,oCAAS,GAAhB,UAAkB,KAAa,EAAE,OAAe;QAC9C,+EAA+E;QAC/E,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,UAAC,CAAC,IAAO,OAAO,CAAC,KAAK,CAAC,0BAA0B,EAAE,CAAC,CAAC,CAAA,CAAC,CAAC,CAAC,CAAA;IACvG,CAAC;IACH,uBAAC;AAAD,CAAC,AA5DD,CAAsC,gBAAgB,GA4DrD;;AAED,MAAM,CAAC,IAAM,gBAAgB,GAAG,IAAI,gBAAgB,EAAE,CAAA","sourcesContent":["// ______CiLampController.ts_____________________khartinger_____\r\n// 2021-12-28: new\r\n// 2022-09-14: add .catch((e) ..) to this.publish\r\nimport { reactive } from 'vue'\r\nimport { Message } from '@/services/CiMqttClient'\r\nimport { CiBaseController, IBase } from './CiBaseController'\r\n\r\nexport interface Lamp extends IBase {\r\n  iLampState: number;\r\n  battery?: string;\r\n  text5?: string;\r\n}\r\n\r\nexport class CiLampController extends CiBaseController {\r\n  public lamps: Array<Lamp> = reactive(\r\n    [\r\n      {\r\n        id: 'le1ar3',\r\n        name: 'Lampe3',\r\n        iLampState: -1,\r\n        subTopic: 'e1/ar/licht/3/ret/licht',\r\n        pubTopic: 'e1/ar/licht/3/set/licht',\r\n        pubPayload: 'um'\r\n      },\r\n      {\r\n        id: 'lo2sl1',\r\n        name: 'Lampe1',\r\n        iLampState: -1,\r\n        subTopic: 'o2/sl/licht/1/ret/licht',\r\n        pubTopic: 'o2/sl/licht/1/set/licht',\r\n        pubPayload: '-1'\r\n      },\r\n      {\r\n        id: 'le3hu1',\r\n        name: 'Huette',\r\n        iLampState: -1,\r\n        subTopic: 'ip/h/hu2/huette/ret/status ip/h/hu2/huette/ret/lampe',\r\n        pubTopic: 'ip/h/hu2/huette/set/lampe',\r\n        pubPayload: '-1'\r\n      }\r\n    ]\r\n  );\r\n\r\n  // ---------Message for this ci (control/indicator)?----------\r\n  public onMessage (message: Message): void {\r\n    this.lamps.forEach(lamp => {\r\n      const aSubTopic = lamp.subTopic.split(' ')\r\n      if (aSubTopic.includes(message.topic)) {\r\n        // ---lamp topic found ---------------------------------\r\n        if (message.topic.includes('ret/status')) {\r\n          // -lamp state from huette - status-------------------\r\n          // console.log('CiLampController.onMessage -t ', message.topic + ' -m ' + message.payload)\r\n          const aPayload = JSON.parse(message.payload)\r\n          lamp.iLampState = -1\r\n          if (aPayload.Lamp === 0 || aPayload.Lamp === '0') lamp.iLampState = 0\r\n          if (aPayload.Lamp === 1 || aPayload.Lamp === '1') lamp.iLampState = 1\r\n        } else {\r\n          // -other lamp----------------------------------------\r\n          if ((message.payload === '1') || (message.payload === 'on')) lamp.iLampState = 1\r\n          else {\r\n            if ((message.payload === '0') || (message.payload === 'off')) lamp.iLampState = 0\r\n            else { lamp.iLampState = -1 }\r\n          }\r\n        }\r\n        // console.log('CiLampController:onMessage: message.payload=', message.payload)\r\n      } // END lamp topic found\r\n    })\r\n  }\r\n\r\n  public publishCi (topic: string, payload: string): void {\r\n    // console.log('CiLampController:publishCi:', '-t ' + topic + ' -m ' + payload)\r\n    this.publish(topic, payload, false, 0).catch((e) => { console.error('CiLampController: ERROR:', e) })\r\n  }\r\n}\r\n\r\nexport const ciLampController = new CiLampController()\r\n"]}]}