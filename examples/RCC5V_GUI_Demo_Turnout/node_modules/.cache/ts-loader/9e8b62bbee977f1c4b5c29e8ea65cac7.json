{"remainingRequest":"G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js??ref--13-1!G:\\work3\\vue\\haus2\\src\\controller\\CiMotionController.ts","dependencies":[{"path":"G:\\work3\\vue\\haus2\\src\\controller\\CiMotionController.ts","mtime":1641048153183},{"path":"G:\\work3\\vue\\haus2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgX19leHRlbmRzIH0gZnJvbSAidHNsaWIiOw0KLy8gX19fX19fQ2lNb3Rpb25Db250cm9sbGVyLnRzX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXw0KaW1wb3J0IHsgcmVhY3RpdmUgfSBmcm9tICd2dWUnOw0KaW1wb3J0IHsgQ2lCYXNlQ29udHJvbGxlciB9IGZyb20gJy4vQ2lCYXNlQ29udHJvbGxlcic7DQppbXBvcnQgZ2VvMCBmcm9tICdAL2NvbXBvbmVudHMvQ2lCYXNlLnZ1ZSc7DQp2YXIgQ2lNb3Rpb25Db250cm9sbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgew0KICAgIF9fZXh0ZW5kcyhDaU1vdGlvbkNvbnRyb2xsZXIsIF9zdXBlcik7DQogICAgZnVuY3Rpb24gQ2lNb3Rpb25Db250cm9sbGVyKCkgew0KICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsNCiAgICAgICAgX3RoaXMubW90aW9ucyA9IHJlYWN0aXZlKFsNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZDogJ2Jld2VndW5nMScsDQogICAgICAgICAgICAgICAgdHlwZTogJ0UxNzQ1JywNCiAgICAgICAgICAgICAgICBuYW1lOiAnQmV3ZWcxIElLRUEnLA0KICAgICAgICAgICAgICAgIGlNb3Rpb25TdGF0ZTogLTEsDQogICAgICAgICAgICAgICAgYmF0dGVyeTogJy0nLA0KICAgICAgICAgICAgICAgIGxhc3RNb3Rpb25EYXRlOiAnLS0uLS0uLS0nLA0KICAgICAgICAgICAgICAgIGxhc3RNb3Rpb25UaW1lOiAnLS06LS06LS0nLA0KICAgICAgICAgICAgICAgIHN1YlRvcGljOiAnemIvaC92ci9iZXdlZ3VuZy8tMSB6Yi9oL3ZyL2Jld2VndW5nLy0xL3RpbWUnLA0KICAgICAgICAgICAgICAgIHB1YlRvcGljOiAnJw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZDogJ2Jld2VndW5nMycsDQogICAgICAgICAgICAgICAgdHlwZTogJ1JUQ0dRMTFMTScsDQogICAgICAgICAgICAgICAgbmFtZTogJ0Jld2VndW5nXzMnLA0KICAgICAgICAgICAgICAgIGlNb3Rpb25TdGF0ZTogLTEsDQogICAgICAgICAgICAgICAgYmF0dGVyeTogJy0nLA0KICAgICAgICAgICAgICAgIGxhc3RNb3Rpb25EYXRlOiAnLS0uLS0uLS0nLA0KICAgICAgICAgICAgICAgIGxhc3RNb3Rpb25UaW1lOiAnLS06LS06LS0nLA0KICAgICAgICAgICAgICAgIHN1YlRvcGljOiAnemIvaC92ci9iZXdlZ3VuZy8tMyB6Yi9oL3ZyL2Jld2VndW5nLy0zL3RpbWUnLA0KICAgICAgICAgICAgICAgIHB1YlRvcGljOiAnJw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZDogJ2Jld2VndW5nMicsDQogICAgICAgICAgICAgICAgdHlwZTogJ1JUQ0dRMTFMTScsDQogICAgICAgICAgICAgICAgbmFtZTogJ0Jld2VndW5nXzInLA0KICAgICAgICAgICAgICAgIGlNb3Rpb25TdGF0ZTogLTEsDQogICAgICAgICAgICAgICAgYmF0dGVyeTogJy0nLA0KICAgICAgICAgICAgICAgIGxhc3RNb3Rpb25EYXRlOiAnLS0uLS0uLS0nLA0KICAgICAgICAgICAgICAgIGxhc3RNb3Rpb25UaW1lOiAnLS06LS06LS0nLA0KICAgICAgICAgICAgICAgIHN1YlRvcGljOiAnemIvaC94eC9iZXdlZ3VuZy8tMiB6Yi9oL3h4L2Jld2VndW5nLy0yL3RpbWUnLA0KICAgICAgICAgICAgICAgIHB1YlRvcGljOiAnJw0KICAgICAgICAgICAgfQ0KICAgICAgICBdKTsNCiAgICAgICAgcmV0dXJuIF90aGlzOw0KICAgIH0NCiAgICAvLyAtLS0tLS0tLS1NZXNzYWdlIGZvciB0aGlzIGNpIChjb250cm9sL2luZGljYXRvcik/LS0tLS0tLS0tLQ0KICAgIENpTW90aW9uQ29udHJvbGxlci5wcm90b3R5cGUub25NZXNzYWdlID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHsNCiAgICAgICAgLy8gLS0tLS0tLXNlYXJjaCBmb3IgbW90aW9uIHRvcGljLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHRoaXMubW90aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChtb3Rpb24pIHsNCiAgICAgICAgICAgIHZhciBhU3ViVG9waWMgPSBtb3Rpb24uc3ViVG9waWMuc3BsaXQoJyAnKTsNCiAgICAgICAgICAgIGlmIChhU3ViVG9waWMuaW5jbHVkZXMobWVzc2FnZS50b3BpYykpIHsNCiAgICAgICAgICAgICAgICAvLyAtLS1tb3Rpb24gdG9waWMgZm91bmQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnRvcGljLmluY2x1ZGVzKCd0aW1lJykpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucGF5bG9hZC5sZW5ndGggPT09IDE1KSB7DQogICAgICAgICAgICAgICAgICAgICAgICBtb3Rpb24ubGFzdE1vdGlvbkRhdGUgPSBtZXNzYWdlLnBheWxvYWQuc3Vic3RyaW5nKDYsIDgpICsgJy4nICsgbWVzc2FnZS5wYXlsb2FkLnN1YnN0cmluZyg0LCA2KSArICcuJyArIG1lc3NhZ2UucGF5bG9hZC5zdWJzdHJpbmcoMiwgNCk7DQogICAgICAgICAgICAgICAgICAgICAgICBtb3Rpb24ubGFzdE1vdGlvblRpbWUgPSBtZXNzYWdlLnBheWxvYWQuc3Vic3RyaW5nKDksIDExKSArICc6JyArIG1lc3NhZ2UucGF5bG9hZC5zdWJzdHJpbmcoMTEsIDEzKSArICc6JyArIG1lc3NhZ2UucGF5bG9hZC5zdWJzdHJpbmcoMTMsIDE1KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1vdGlvbi5sYXN0TW90aW9uRGF0ZSA9IGdlbzAubm9EYXRlOw0KICAgICAgICAgICAgICAgICAgICAgICAgbW90aW9uLmxhc3RNb3Rpb25UaW1lID0gZ2VvMC5ub1RpbWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7IC8vIC1tb3Rpb24gaW5mby0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgICAgICAgICAgICAgIG1vdGlvbi5sYXN0TW90aW9uRGF0ZSA9IGdlbzAubm9EYXRlOw0KICAgICAgICAgICAgICAgICAgICBtb3Rpb24ubGFzdE1vdGlvblRpbWUgPSBnZW8wLm5vVGltZTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG1vdGlvbi50eXBlID09PSAnUlRDR1ExMUxNJyB8fCBtb3Rpb24udHlwZSA9PT0gJ0UxNzQ1Jykgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFQYXlsb2FkID0gSlNPTi5wYXJzZShtZXNzYWdlLnBheWxvYWQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgbW90aW9uLmlNb3Rpb25TdGF0ZSA9IC0xOw0KICAgICAgICAgICAgICAgICAgICAgICAgbW90aW9uLmJhdHRlcnkgPSAiIiArIGFQYXlsb2FkLmJhdHRlcnk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYVBheWxvYWQub2NjdXBhbmN5ID09PSB0cnVlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdGlvbi5pTW90aW9uU3RhdGUgPSAxOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFQYXlsb2FkLm9jY3VwYW5jeSA9PT0gJ3RydWUnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdGlvbi5pTW90aW9uU3RhdGUgPSAxOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFQYXlsb2FkLm9jY3VwYW5jeSA9PT0gZmFsc2UpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW90aW9uLmlNb3Rpb25TdGF0ZSA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYVBheWxvYWQub2NjdXBhbmN5ID09PSAnZmFsc2UnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdGlvbi5pTW90aW9uU3RhdGUgPSAwOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIC8vIGlmIChtb3Rpb24udHlwZSA9PT0gJ0QxJykgew0KICAgICAgICAgICAgICAgICAgICAvLyB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSAvLyBFTkQgbW90aW9uIHRvcGljIGZvdW5kDQogICAgICAgIH0pOw0KICAgIH07DQogICAgQ2lNb3Rpb25Db250cm9sbGVyLnByb3RvdHlwZS5wdWJsaXNoQ2kgPSBmdW5jdGlvbiAodG9waWMsIHBheWxvYWQpIHsNCiAgICAgICAgLy8gY29uc29sZS5sb2coJ3B1Ymxpc2g6JywgJy10ICcgKyB0b3BpYyArICcgLW0gJyArIHBheWxvYWQpDQogICAgICAgIHRoaXMucHVibGlzaCh0b3BpYywgcGF5bG9hZCwgZmFsc2UsIDApOw0KICAgIH07DQogICAgcmV0dXJuIENpTW90aW9uQ29udHJvbGxlcjsNCn0oQ2lCYXNlQ29udHJvbGxlcikpOw0KZXhwb3J0IHsgQ2lNb3Rpb25Db250cm9sbGVyIH07DQpleHBvcnQgdmFyIGNpTW90aW9uQ29udHJvbGxlciA9IG5ldyBDaU1vdGlvbkNvbnRyb2xsZXIoKTsNCg=="},{"version":3,"file":"G:\\work3\\vue\\haus2\\src\\controller\\CiMotionController.ts","sourceRoot":"","sources":["G:\\work3\\vue\\haus2\\src\\controller\\CiMotionController.ts"],"names":[],"mappings":"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","sourcesContent":["// ______CiMotionController.ts__________________________________\r\nimport { reactive } from 'vue'\r\nimport { Message } from '@/services/CiMqttClient'\r\nimport { CiBaseController, IBase } from './CiBaseController'\r\nimport geo0 from '@/components/CiBase.vue'\r\n\r\nexport interface Motion extends IBase {\r\n  type: string;\r\n  iMotionState: number;\r\n  battery?: string;\r\n  text5?: string;\r\n  lastMotionDate: string;\r\n  lastMotionTime: string;\r\n}\r\n\r\nexport class CiMotionController extends CiBaseController {\r\n  public motions: Array<Motion> = reactive(\r\n    [\r\n      { // Erdgeschoss: Bereich 1, Vorraum\r\n        id: 'bewegung1',\r\n        type: 'E1745', // IKEA\r\n        name: 'Beweg1 IKEA',\r\n        iMotionState: -1,\r\n        battery: '-',\r\n        lastMotionDate: '--.--.--',\r\n        lastMotionTime: '--:--:--',\r\n        subTopic: 'zb/h/vr/bewegung/-1 zb/h/vr/bewegung/-1/time',\r\n        pubTopic: ''\r\n      },\r\n      { // Erdgeschoss: Bereich 1, Vorraum\r\n        id: 'bewegung3',\r\n        type: 'RTCGQ11LM', // Aqara 'zb',\r\n        name: 'Bewegung_3',\r\n        iMotionState: -1,\r\n        battery: '-',\r\n        lastMotionDate: '--.--.--',\r\n        lastMotionTime: '--:--:--',\r\n        subTopic: 'zb/h/vr/bewegung/-3 zb/h/vr/bewegung/-3/time',\r\n        pubTopic: ''\r\n      },\r\n      { // motion 2: TEST  Arbeitszimmer\r\n        id: 'bewegung2',\r\n        type: 'RTCGQ11LM', // Aqara 'zb',\r\n        name: 'Bewegung_2',\r\n        iMotionState: -1,\r\n        battery: '-',\r\n        lastMotionDate: '--.--.--',\r\n        lastMotionTime: '--:--:--',\r\n        subTopic: 'zb/h/xx/bewegung/-2 zb/h/xx/bewegung/-2/time',\r\n        pubTopic: ''\r\n      }\r\n    ]\r\n  );\r\n\r\n  // ---------Message for this ci (control/indicator)?----------\r\n  public onMessage (message: Message): void {\r\n    // -------search for motion topic---------------------------\r\n    this.motions.forEach(motion => {\r\n      const aSubTopic = motion.subTopic.split(' ')\r\n      if (aSubTopic.includes(message.topic)) {\r\n        // ---motion topic found -------------------------------\r\n        if (message.topic.includes('time')) {\r\n          if (message.payload.length === 15) {\r\n            motion.lastMotionDate = message.payload.substring(6, 8) + '.' + message.payload.substring(4, 6) + '.' + message.payload.substring(2, 4)\r\n            motion.lastMotionTime = message.payload.substring(9, 11) + ':' + message.payload.substring(11, 13) + ':' + message.payload.substring(13, 15)\r\n          } else {\r\n            motion.lastMotionDate = geo0.noDate\r\n            motion.lastMotionTime = geo0.noTime\r\n          }\r\n        } else { // -motion info--------------------------------\r\n          motion.lastMotionDate = geo0.noDate\r\n          motion.lastMotionTime = geo0.noTime\r\n          if (motion.type === 'RTCGQ11LM' || motion.type === 'E1745') {\r\n            const aPayload = JSON.parse(message.payload)\r\n            motion.iMotionState = -1\r\n            motion.battery = `${aPayload.battery}`\r\n            if (aPayload.occupancy === true) motion.iMotionState = 1\r\n            if (aPayload.occupancy === 'true') motion.iMotionState = 1\r\n            if (aPayload.occupancy === false) motion.iMotionState = 0\r\n            if (aPayload.occupancy === 'false') motion.iMotionState = 0\r\n          }\r\n          // if (motion.type === 'D1') {\r\n          // }\r\n        }\r\n      } // END motion topic found\r\n    })\r\n  }\r\n\r\n  public publishCi (topic: string, payload: string): void {\r\n    // console.log('publish:', '-t ' + topic + ' -m ' + payload)\r\n    this.publish(topic, payload, false, 0)\r\n  }\r\n}\r\n\r\nexport const ciMotionController = new CiMotionController()\r\n"]}]}