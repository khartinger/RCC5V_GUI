{"remainingRequest":"G:\\work3\\vue\\haus3\\node_modules\\ts-loader\\index.js??ref--13-1!G:\\work3\\vue\\haus3\\src\\controller\\CiMotion1Controller.ts","dependencies":[{"path":"G:\\work3\\vue\\haus3\\src\\controller\\CiMotion1Controller.ts","mtime":1677938756617},{"path":"G:\\work3\\vue\\haus3\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus3\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgX19leHRlbmRzIH0gZnJvbSAidHNsaWIiOw0KLy8gX19fX19fQ2lNb3Rpb24xQ29udHJvbGxlci50c19fX19fX19fX19fX19fX19fa2hhcnRpbmdlcl9fX19fDQovLyAyMDIyLTAxLTAxOiBuZXcNCi8vIDIwMjMtMDItMDk6IGNoYW5nZSBhdCBDaUJhc2UgKGFkZCBHZW8udHMpDQppbXBvcnQgeyByZWFjdGl2ZSB9IGZyb20gJ3Z1ZSc7DQppbXBvcnQgeyBDaUJhc2VDb250cm9sbGVyIH0gZnJvbSAnLi9DaUJhc2VDb250cm9sbGVyJzsNCmltcG9ydCB7IGdlbzBmIH0gZnJvbSAnLi4vY2xhc3Nlcy9HZW8nOw0KdmFyIENpTW90aW9uMUNvbnRyb2xsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7DQogICAgX19leHRlbmRzKENpTW90aW9uMUNvbnRyb2xsZXIsIF9zdXBlcik7DQogICAgZnVuY3Rpb24gQ2lNb3Rpb24xQ29udHJvbGxlcigpIHsNCiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7DQogICAgICAgIF90aGlzLm1vdGlvbjFzID0gcmVhY3RpdmUoWw0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlkOiAnYmV3ZWd1bmcxJywNCiAgICAgICAgICAgICAgICB0eXBlOiAnRTE3NDUnLA0KICAgICAgICAgICAgICAgIG5hbWU6ICdCZXdlZzEgSUtFQScsDQogICAgICAgICAgICAgICAgaU1vdGlvbjFTdGF0ZTogLTEsDQogICAgICAgICAgICAgICAgYmF0dGVyeTogJy0nLA0KICAgICAgICAgICAgICAgIGxhc3RNb3Rpb24xRGF0ZTogJy0tLi0tLi0tJywNCiAgICAgICAgICAgICAgICBsYXN0TW90aW9uMVRpbWU6ICctLTotLTotLScsDQogICAgICAgICAgICAgICAgc3ViVG9waWM6ICd6Yi9oL3ZyL2Jld2VndW5nLy0xIHpiL2gvdnIvYmV3ZWd1bmcvLTEvdGltZScsDQogICAgICAgICAgICAgICAgcHViVG9waWM6ICcnDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlkOiAnYmV3ZWd1bmczJywNCiAgICAgICAgICAgICAgICB0eXBlOiAnUlRDR1ExMUxNJywNCiAgICAgICAgICAgICAgICBuYW1lOiAnQmV3ZWd1bmdfMycsDQogICAgICAgICAgICAgICAgaU1vdGlvbjFTdGF0ZTogLTEsDQogICAgICAgICAgICAgICAgYmF0dGVyeTogJy0nLA0KICAgICAgICAgICAgICAgIGxhc3RNb3Rpb24xRGF0ZTogJy0tLi0tLi0tJywNCiAgICAgICAgICAgICAgICBsYXN0TW90aW9uMVRpbWU6ICctLTotLTotLScsDQogICAgICAgICAgICAgICAgc3ViVG9waWM6ICd6Yi9oL3ZyL2Jld2VndW5nLy0zIHpiL2gvdnIvYmV3ZWd1bmcvLTMvdGltZScsDQogICAgICAgICAgICAgICAgcHViVG9waWM6ICcnDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGlkOiAnYmV3ZWd1bmcyJywNCiAgICAgICAgICAgICAgICB0eXBlOiAnUlRDR1ExMUxNJywNCiAgICAgICAgICAgICAgICBuYW1lOiAnQmV3ZWd1bmdfMicsDQogICAgICAgICAgICAgICAgaU1vdGlvbjFTdGF0ZTogLTEsDQogICAgICAgICAgICAgICAgYmF0dGVyeTogJy0nLA0KICAgICAgICAgICAgICAgIGxhc3RNb3Rpb24xRGF0ZTogJy0tLi0tLi0tJywNCiAgICAgICAgICAgICAgICBsYXN0TW90aW9uMVRpbWU6ICctLTotLTotLScsDQogICAgICAgICAgICAgICAgc3ViVG9waWM6ICd6Yi9oL3h4L2Jld2VndW5nLy0yIHpiL2gveHgvYmV3ZWd1bmcvLTIvdGltZScsDQogICAgICAgICAgICAgICAgcHViVG9waWM6ICcnDQogICAgICAgICAgICB9DQogICAgICAgIF0pOw0KICAgICAgICAvLyAtLS0tLS0tLS0tLS0tLXN0YXRlIGNvbnN0YW50cy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICBfdGhpcy5zdGF0ZU9uID0gLTE7DQogICAgICAgIF90aGlzLnN0YXRlT2ZmID0gLTI7DQogICAgICAgIF90aGlzLnN0YXRlTm90T2sgPSAtOTk4Ow0KICAgICAgICBfdGhpcy5zdGF0ZU5vU3RhdGUgPSAtOTk5Ow0KICAgICAgICByZXR1cm4gX3RoaXM7DQogICAgfQ0KICAgIC8vIC0tLS0tLS0tLS0tLS0tTWVzc2FnZSBmb3IgdGhpcyBjaSAoY29udHJvbC9pbmRpY2F0b3IpPy0tLS0tDQogICAgQ2lNb3Rpb24xQ29udHJvbGxlci5wcm90b3R5cGUub25NZXNzYWdlID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHsNCiAgICAgICAgdmFyIF90aGlzID0gdGhpczsNCiAgICAgICAgLy8gLS0tLS0tLXNlYXJjaCBmb3IgbW90aW9uIHRvcGljLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgIHRoaXMubW90aW9uMXMuZm9yRWFjaChmdW5jdGlvbiAobW90aW9uMSkgew0KICAgICAgICAgICAgdmFyIGFTdWJUb3BpYyA9IG1vdGlvbjEuc3ViVG9waWMuc3BsaXQoJyAnKTsNCiAgICAgICAgICAgIGlmIChhU3ViVG9waWMuaW5jbHVkZXMobWVzc2FnZS50b3BpYykpIHsNCiAgICAgICAgICAgICAgICAvLyAtLS0tLS0tLW1vdGlvbjEgdG9waWMgZm91bmQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdvbk1lc3NhZ2U6JywgbWVzc2FnZS50b3BpYywgJywgcGF5bG9hZCcsIG1lc3NhZ2UucGF5bG9hZCkNCiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS50b3BpYy5pbmNsdWRlcygndGltZScpKSB7DQogICAgICAgICAgICAgICAgICAgIC8vIC0tLS0tLWJyb2tlcnRpbWUgeXl5eW1tZGQgSEhNTVNTIHJlY2VpdmVkPy0tLS0tLS0tLQ0KICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5wYXlsb2FkLmxlbmd0aCA9PT0gMTUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1vdGlvbjEubGFzdE1vdGlvbjFEYXRlID0gbWVzc2FnZS5wYXlsb2FkLnN1YnN0cmluZyg2LCA4KSArICcuJyArIG1lc3NhZ2UucGF5bG9hZC5zdWJzdHJpbmcoNCwgNikgKyAnLicgKyBtZXNzYWdlLnBheWxvYWQuc3Vic3RyaW5nKDIsIDQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgbW90aW9uMS5sYXN0TW90aW9uMVRpbWUgPSBtZXNzYWdlLnBheWxvYWQuc3Vic3RyaW5nKDksIDExKSArICc6JyArIG1lc3NhZ2UucGF5bG9hZC5zdWJzdHJpbmcoMTEsIDEzKSArICc6JyArIG1lc3NhZ2UucGF5bG9hZC5zdWJzdHJpbmcoMTMsIDE1KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIG1vdGlvbjEubGFzdE1vdGlvbjFEYXRlID0gZ2VvMGYubm9EYXRlOw0KICAgICAgICAgICAgICAgICAgICAgICAgbW90aW9uMS5sYXN0TW90aW9uMVRpbWUgPSBnZW8wZi5ub1RpbWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tLS0tRU5EIGJyb2tlcnRpbWUgeXl5eW1tZGQgSEhNTVNTIHJlY2VpdmVkPy0tLS0tDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAvLyAtLS0tLS13b3JrIG9uIGRpZmZlcmVudCBtb3Rpb24gdHlwZXMtLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgICAgICAgICAgICAgbW90aW9uMS5pTW90aW9uMVN0YXRlID0gX3RoaXMuc3RhdGVOb3RPazsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG1vdGlvbjEudHlwZSA9PT0gJ1JUQ0dRMTFMTScgfHwgbW90aW9uMS50eXBlID09PSAnRTE3NDUnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhUGF5bG9hZCA9IEpTT04ucGFyc2UobWVzc2FnZS5wYXlsb2FkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3Rpb24xLmJhdHRlcnkgPSAiIiArIGFQYXlsb2FkLmJhdHRlcnkgKyAnJSc7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFQYXlsb2FkLm9jY3VwYW5jeSA9PT0gdHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW90aW9uMS5pTW90aW9uMVN0YXRlID0gX3RoaXMuc3RhdGVPbjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYVBheWxvYWQub2NjdXBhbmN5ID09PSAndHJ1ZScpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdGlvbjEuaU1vdGlvbjFTdGF0ZSA9IF90aGlzLnN0YXRlT247DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFQYXlsb2FkLm9jY3VwYW5jeSA9PT0gZmFsc2UpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdGlvbjEuaU1vdGlvbjFTdGF0ZSA9IF90aGlzLnN0YXRlT2ZmOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhUGF5bG9hZC5vY2N1cGFuY3kgPT09ICdmYWxzZScpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdGlvbjEuaU1vdGlvbjFTdGF0ZSA9IF90aGlzLnN0YXRlT2ZmOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbW90aW9uMS5sYXN0TW90aW9uMURhdGUgPSAnRVJST1InOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vdGlvbjEubGFzdE1vdGlvbjFUaW1lID0gJ2pzb24nOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvbk1lc3NhZ2UgZXJyb3I9JywgZXJyb3IpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGlmIChtb3Rpb24xLnR5cGUgPT09ICdzb21ldGhpbmdfZWxzZScpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gLi4uYWRkIGZ1bmN0aW9uYWxpdHkgZm9yIGFub3RoZXIgc2Vuc29yIGhlcmUuLi4NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIChlcnJvcikgeyB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IC8vIC0tLS0tLUVORCB3b3JrIG9uIGRpZmZlcmVudCBtb3Rpb24gdHlwZXMtLS0tLS0tLS0tDQogICAgICAgICAgICB9IC8vIC0tLS0tLS0tRU5EIG1vdGlvbjEgdG9waWMgZm91bmQtLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgfSk7DQogICAgfTsNCiAgICBDaU1vdGlvbjFDb250cm9sbGVyLnByb3RvdHlwZS5wdWJsaXNoQ2kgPSBmdW5jdGlvbiAodG9waWMsIHBheWxvYWQpIHsNCiAgICAgICAgLy8gY29uc29sZS5sb2coJ3B1Ymxpc2g6JywgJy10ICcgKyB0b3BpYyArICcgLW0gJyArIHBheWxvYWQpDQogICAgICAgIHRoaXMucHVibGlzaCh0b3BpYywgcGF5bG9hZCwgZmFsc2UsIDApLmNhdGNoKGZ1bmN0aW9uIChlKSB7IGNvbnNvbGUuZXJyb3IoJ0NpTW90aW9uQ29udHJvbGxlcjogRVJST1I6JywgZSk7IH0pOw0KICAgIH07DQogICAgcmV0dXJuIENpTW90aW9uMUNvbnRyb2xsZXI7DQp9KENpQmFzZUNvbnRyb2xsZXIpKTsNCmV4cG9ydCB7IENpTW90aW9uMUNvbnRyb2xsZXIgfTsNCmV4cG9ydCB2YXIgY2lNb3Rpb24xQ29udHJvbGxlciA9IG5ldyBDaU1vdGlvbjFDb250cm9sbGVyKCk7DQo="},{"version":3,"file":"G:\\work3\\vue\\haus3\\src\\controller\\CiMotion1Controller.ts","sourceRoot":"","sources":["G:\\work3\\vue\\haus3\\src\\controller\\CiMotion1Controller.ts"],"names":[],"mappings":"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","sourcesContent":["// ______CiMotion1Controller.ts_________________khartinger_____\r\n// 2022-01-01: new\r\n// 2023-02-09: change at CiBase (add Geo.ts)\r\nimport { reactive } from 'vue'\r\nimport { Message } from '@/services/CiMqttClient'\r\nimport { CiBaseController, IBase } from './CiBaseController'\r\nimport { geo0f } from '../classes/Geo'\r\n\r\nexport interface Motion1 extends IBase {\r\n  // ---------mandatory-----------------------------------------\r\n  iMotion1State: number;\r\n  type: string;\r\n  lastMotion1Date: string;\r\n  lastMotion1Time: string;\r\n  // ---------optional------------------------------------------\r\n  battery?: string;\r\n  textFooter?: string;\r\n}\r\n\r\nexport class CiMotion1Controller extends CiBaseController {\r\n  public motion1s: Array<Motion1> = reactive(\r\n    [\r\n      { // Erdgeschoss: Bereich 1, Vorraum\r\n        id: 'bewegung1',\r\n        type: 'E1745', // IKEA\r\n        name: 'Beweg1 IKEA',\r\n        iMotion1State: -1,\r\n        battery: '-',\r\n        lastMotion1Date: '--.--.--',\r\n        lastMotion1Time: '--:--:--',\r\n        subTopic: 'zb/h/vr/bewegung/-1 zb/h/vr/bewegung/-1/time',\r\n        pubTopic: ''\r\n      },\r\n      { // ---Erdgeschoss: Bereich 1, Vorraum-------------------\r\n        id: 'bewegung3',\r\n        type: 'RTCGQ11LM', // Aqara 'zb',\r\n        name: 'Bewegung_3',\r\n        iMotion1State: -1,\r\n        battery: '-',\r\n        lastMotion1Date: '--.--.--',\r\n        lastMotion1Time: '--:--:--',\r\n        subTopic: 'zb/h/vr/bewegung/-3 zb/h/vr/bewegung/-3/time',\r\n        pubTopic: ''\r\n      },\r\n      { // ---motion 2: TEST  Arbeitszimmer---------------------\r\n        id: 'bewegung2',\r\n        type: 'RTCGQ11LM', // Aqara 'zb',\r\n        name: 'Bewegung_2',\r\n        iMotion1State: -1,\r\n        battery: '-',\r\n        lastMotion1Date: '--.--.--',\r\n        lastMotion1Time: '--:--:--',\r\n        subTopic: 'zb/h/xx/bewegung/-2 zb/h/xx/bewegung/-2/time',\r\n        pubTopic: ''\r\n      }\r\n    ]\r\n  );\r\n\r\n  // --------------state constants------------------------------\r\n  public stateOn = -1;\r\n  public stateOff = -2;\r\n  public stateNotOk = -998;\r\n  public stateNoState = -999;\r\n\r\n  // --------------Message for this ci (control/indicator)?-----\r\n  public onMessage (message: Message): void {\r\n    // -------search for motion topic---------------------------\r\n    this.motion1s.forEach(motion1 => {\r\n      const aSubTopic = motion1.subTopic.split(' ')\r\n      if (aSubTopic.includes(message.topic)) {\r\n        // --------motion1 topic found -------------------------\r\n        // console.log('onMessage:', message.topic, ', payload', message.payload)\r\n        if (message.topic.includes('time')) {\r\n          // ------brokertime yyyymmdd HHMMSS received?---------\r\n          if (message.payload.length === 15) {\r\n            motion1.lastMotion1Date = message.payload.substring(6, 8) + '.' + message.payload.substring(4, 6) + '.' + message.payload.substring(2, 4)\r\n            motion1.lastMotion1Time = message.payload.substring(9, 11) + ':' + message.payload.substring(11, 13) + ':' + message.payload.substring(13, 15)\r\n          } else {\r\n            motion1.lastMotion1Date = geo0f.noDate\r\n            motion1.lastMotion1Time = geo0f.noTime\r\n          }\r\n          // ------END brokertime yyyymmdd HHMMSS received?-----\r\n        } else {\r\n          // ------work on different motion types---------------\r\n          motion1.iMotion1State = this.stateNotOk\r\n          if (motion1.type === 'RTCGQ11LM' || motion1.type === 'E1745') {\r\n            try {\r\n              const aPayload = JSON.parse(message.payload)\r\n              motion1.battery = `${aPayload.battery}` + '%'\r\n              if (aPayload.occupancy === true) motion1.iMotion1State = this.stateOn\r\n              if (aPayload.occupancy === 'true') motion1.iMotion1State = this.stateOn\r\n              if (aPayload.occupancy === false) motion1.iMotion1State = this.stateOff\r\n              if (aPayload.occupancy === 'false') motion1.iMotion1State = this.stateOff\r\n            } catch (error) {\r\n              motion1.lastMotion1Date = 'ERROR'\r\n              motion1.lastMotion1Time = 'json'\r\n              console.log('onMessage error=', error)\r\n            }\r\n          }\r\n          if (motion1.type === 'something_else') {\r\n            try {\r\n              // ...add functionality for another sensor here...\r\n            } catch (error) { }\r\n          }\r\n        } // ------END work on different motion types----------\r\n      } // --------END motion1 topic found---------------------\r\n    })\r\n  }\r\n\r\n  public publishCi (topic: string, payload: string): void {\r\n    // console.log('publish:', '-t ' + topic + ' -m ' + payload)\r\n    this.publish(topic, payload, false, 0).catch((e) => { console.error('CiMotionController: ERROR:', e) })\r\n  }\r\n}\r\n\r\nexport const ciMotion1Controller = new CiMotion1Controller()\r\n"]}]}