{"remainingRequest":"G:\\work3\\vue\\haus2\\node_modules\\thread-loader\\dist\\cjs.js!G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js??ref--13-2!G:\\work3\\vue\\haus2\\src\\controller\\CiSocketController.ts","dependencies":[{"path":"G:\\work3\\vue\\haus2\\src\\controller\\CiSocketController.ts","mtime":1663146358971},{"path":"G:\\work3\\vue\\haus2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus2\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgX19leHRlbmRzIH0gZnJvbSAidHNsaWIiOw0KLy8gX19fX19fQ2lTb2NrZXRDb250cm9sbGVyLnRzX19fX19fX19fX19fX19fX19fX2toYXJ0aW5nZXJfX19fXw0KLy8gMjAyMi0wOS0xNDogYWRkIC5jYXRjaCgoZSkgLi4pIHRvIHRoaXMucHVibGlzaA0KaW1wb3J0IHsgcmVhY3RpdmUgfSBmcm9tICd2dWUnOw0KaW1wb3J0IHsgQ2lCYXNlQ29udHJvbGxlciB9IGZyb20gJy4vQ2lCYXNlQ29udHJvbGxlcic7DQp2YXIgQ2lTb2NrZXRDb250cm9sbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgew0KICAgIF9fZXh0ZW5kcyhDaVNvY2tldENvbnRyb2xsZXIsIF9zdXBlcik7DQogICAgZnVuY3Rpb24gQ2lTb2NrZXRDb250cm9sbGVyKCkgew0KICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsNCiAgICAgICAgX3RoaXMuc29ja2V0cyA9IHJlYWN0aXZlKFsNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0eXBlOiAnZTE2MDMnLA0KICAgICAgICAgICAgICAgIGlkOiAnc2UxYXJBJywNCiAgICAgICAgICAgICAgICBuYW1lOiAnQScsDQogICAgICAgICAgICAgICAgaVNvY2tldFN0YXRlOiAtOSwNCiAgICAgICAgICAgICAgICBiYXR0ZXJ5OiAnLScsDQogICAgICAgICAgICAgICAgdGV4dDU6ICdzb2NrZXRBJywNCiAgICAgICAgICAgICAgICBzdWJUb3BpYzogJ3piL2gvZG9zZS9lMTYwM2EnLA0KICAgICAgICAgICAgICAgIHB1YlRvcGljOiAnemIvaC9kb3NlL2UxNjAzYS9zZXQnLA0KICAgICAgICAgICAgICAgIHB1YlBheWxvYWQ6ICd7InN0YXRlIjogIlRPR0dMRSJ9Jw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0eXBlOiAnZTE2MDMnLA0KICAgICAgICAgICAgICAgIGlkOiAnc2UxYXJCJywNCiAgICAgICAgICAgICAgICBuYW1lOiAnQicsDQogICAgICAgICAgICAgICAgaVNvY2tldFN0YXRlOiAtOSwNCiAgICAgICAgICAgICAgICBiYXR0ZXJ5OiAnLScsDQogICAgICAgICAgICAgICAgdGV4dDU6ICdzb2NrZXRCJywNCiAgICAgICAgICAgICAgICBzdWJUb3BpYzogJ3piL2gvZG9zZS9lMTYwM2InLA0KICAgICAgICAgICAgICAgIHB1YlRvcGljOiAnemIvaC9kb3NlL2UxNjAzYi9zZXQnLA0KICAgICAgICAgICAgICAgIHB1YlBheWxvYWQ6ICd7InN0YXRlIjogIlRPR0dMRSJ9Jw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB0eXBlOiAnZTE2MDMnLA0KICAgICAgICAgICAgICAgIGlkOiAnc2UxYXJDJywNCiAgICAgICAgICAgICAgICBuYW1lOiAnQycsDQogICAgICAgICAgICAgICAgaVNvY2tldFN0YXRlOiAtOSwNCiAgICAgICAgICAgICAgICBiYXR0ZXJ5OiAnLScsDQogICAgICAgICAgICAgICAgdGV4dDU6ICdzb2NrZXRDJywNCiAgICAgICAgICAgICAgICBzdWJUb3BpYzogJ3piL2gvZG9zZS9lMTYwM2MnLA0KICAgICAgICAgICAgICAgIHB1YlRvcGljOiAnemIvaC9kb3NlL2UxNjAzYy9zZXQnLA0KICAgICAgICAgICAgICAgIHB1YlBheWxvYWQ6ICd7InN0YXRlIjogIlRPR0dMRSJ9Jw0KICAgICAgICAgICAgfQ0KICAgICAgICBdKTsNCiAgICAgICAgcmV0dXJuIF90aGlzOw0KICAgIH0NCiAgICBDaVNvY2tldENvbnRyb2xsZXIucHJvdG90eXBlLm9uTWVzc2FnZSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7DQogICAgICAgIHRoaXMuc29ja2V0cy5mb3JFYWNoKGZ1bmN0aW9uIChzb2NrZXQpIHsNCiAgICAgICAgICAgIHZhciBhU3ViVG9waWMgPSBzb2NrZXQuc3ViVG9waWMuc3BsaXQoJyAnKTsNCiAgICAgICAgICAgIGlmIChhU3ViVG9waWMuaW5jbHVkZXMobWVzc2FnZS50b3BpYykpIHsNCiAgICAgICAgICAgICAgICAvLyAtLS1zb2NrZXQgZm91bmQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgICAgICAgICAgaWYgKHNvY2tldC50eXBlID09PSAnZTE2MDMnKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciBhUGF5bG9hZCA9IEpTT04ucGFyc2UobWVzc2FnZS5wYXlsb2FkKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKChhUGF5bG9hZC5zdGF0ZSA9PT0gJ09OJykgfHwgKGFQYXlsb2FkLnN0YXRlID09PSAnb24nKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHNvY2tldC5pU29ja2V0U3RhdGUgPSAtMTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGFQYXlsb2FkLnN0YXRlID09PSAnT0ZGJykgfHwgKGFQYXlsb2FkLnN0YXRlID09PSAnb2ZmJykpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc29ja2V0LmlTb2NrZXRTdGF0ZSA9IC0yOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc29ja2V0LmlTb2NrZXRTdGF0ZSA9IC05Ow0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdDaVNvY2tldENvbnRyb2xsZXI6b25NZXNzYWdlOiBtZXNzYWdlLnBheWxvYWQ9JywgbWVzc2FnZS5wYXlsb2FkKQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9Ow0KICAgIENpU29ja2V0Q29udHJvbGxlci5wcm90b3R5cGUucHVibGlzaENpID0gZnVuY3Rpb24gKHRvcGljLCBwYXlsb2FkKSB7DQogICAgICAgIC8vIGNvbnNvbGUubG9nKCdDaVNvY2tldENvbnRyb2xsZXI6cHVibGlzaENpOicsICctdCAnICsgdG9waWMgKyAnIC1tICcgKyBwYXlsb2FkKQ0KICAgICAgICB0aGlzLnB1Ymxpc2godG9waWMsIHBheWxvYWQsIGZhbHNlLCAwKS5jYXRjaChmdW5jdGlvbiAoZSkgeyBjb25zb2xlLmVycm9yKCdDaVNvY2tldENvbnRyb2xsZXI6IEVSUk9SOicsIGUpOyB9KTsNCiAgICB9Ow0KICAgIHJldHVybiBDaVNvY2tldENvbnRyb2xsZXI7DQp9KENpQmFzZUNvbnRyb2xsZXIpKTsNCmV4cG9ydCB7IENpU29ja2V0Q29udHJvbGxlciB9Ow0KZXhwb3J0IHZhciBjaVNvY2tldENvbnRyb2xsZXIgPSBuZXcgQ2lTb2NrZXRDb250cm9sbGVyKCk7DQo="},{"version":3,"file":"G:\\work3\\vue\\haus2\\src\\controller\\CiSocketController.ts","sourceRoot":"","sources":["G:\\work3\\vue\\haus2\\src\\controller\\CiSocketController.ts"],"names":[],"mappings":";AAAA,gEAAgE;AAChE,iDAAiD;AACjD,OAAO,EAAE,QAAQ,EAAE,MAAM,KAAK,CAAA;AAE9B,OAAO,EAAE,gBAAgB,EAAS,MAAM,oBAAoB,CAAA;AAS5D;IAAwC,sCAAgB;IAAxD;QAAA,qEA6DC;QA5DQ,aAAO,GAAkB,QAAQ,CACtC;YACE;gBACE,IAAI,EAAE,OAAO;gBACb,EAAE,EAAE,QAAQ;gBACZ,IAAI,EAAE,GAAG;gBACT,YAAY,EAAE,CAAC,CAAC;gBAChB,OAAO,EAAE,GAAG;gBACZ,KAAK,EAAE,SAAS;gBAChB,QAAQ,EAAE,kBAAkB;gBAC5B,QAAQ,EAAE,sBAAsB;gBAChC,UAAU,EAAE,qBAAqB;aAClC;YACD;gBACE,IAAI,EAAE,OAAO;gBACb,EAAE,EAAE,QAAQ;gBACZ,IAAI,EAAE,GAAG;gBACT,YAAY,EAAE,CAAC,CAAC;gBAChB,OAAO,EAAE,GAAG;gBACZ,KAAK,EAAE,SAAS;gBAChB,QAAQ,EAAE,kBAAkB;gBAC5B,QAAQ,EAAE,sBAAsB;gBAChC,UAAU,EAAE,qBAAqB;aAClC;YACD;gBACE,IAAI,EAAE,OAAO;gBACb,EAAE,EAAE,QAAQ;gBACZ,IAAI,EAAE,GAAG;gBACT,YAAY,EAAE,CAAC,CAAC;gBAChB,OAAO,EAAE,GAAG;gBACZ,KAAK,EAAE,SAAS;gBAChB,QAAQ,EAAE,kBAAkB;gBAC5B,QAAQ,EAAE,sBAAsB;gBAChC,UAAU,EAAE,qBAAqB;aAClC;SACF,CACF,CAAC;;IAwBJ,CAAC;IAtBQ,sCAAS,GAAhB,UAAkB,OAAgB;QAChC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,UAAA,MAAM;YACzB,IAAM,SAAS,GAAG,MAAM,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;YAC5C,IAAI,SAAS,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBACrC,oDAAoD;gBACpD,IAAI,MAAM,CAAC,IAAI,KAAK,OAAO,EAAE;oBAC3B,IAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,CAAA;oBAC5C,IAAI,CAAC,QAAQ,CAAC,KAAK,KAAK,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,KAAK,IAAI,CAAC;wBAAE,MAAM,CAAC,YAAY,GAAG,CAAC,CAAC,CAAA;yBAC/E;wBACH,IAAI,CAAC,QAAQ,CAAC,KAAK,KAAK,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,KAAK,KAAK,CAAC;4BAAE,MAAM,CAAC,YAAY,GAAG,CAAC,CAAC,CAAA;6BACjF;4BAAE,MAAM,CAAC,YAAY,GAAG,CAAC,CAAC,CAAA;yBAAE;qBAClC;iBACF;gBACD,iFAAiF;aAClF;QACH,CAAC,CAAC,CAAA;IACJ,CAAC;IAEM,sCAAS,GAAhB,UAAkB,KAAa,EAAE,OAAe;QAC9C,iFAAiF;QACjF,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,UAAC,CAAC,IAAO,OAAO,CAAC,KAAK,CAAC,4BAA4B,EAAE,CAAC,CAAC,CAAA,CAAC,CAAC,CAAC,CAAA;IACzG,CAAC;IACH,yBAAC;AAAD,CAAC,AA7DD,CAAwC,gBAAgB,GA6DvD;;AAED,MAAM,CAAC,IAAM,kBAAkB,GAAG,IAAI,kBAAkB,EAAE,CAAA","sourcesContent":["// ______CiSocketController.ts___________________khartinger_____\r\n// 2022-09-14: add .catch((e) ..) to this.publish\r\nimport { reactive } from 'vue'\r\nimport { Message } from '@/services/CiMqttClient'\r\nimport { CiBaseController, IBase } from './CiBaseController'\r\n\r\nexport interface Socket extends IBase {\r\n  type: string;\r\n  iSocketState: number;\r\n  battery?: string;\r\n  text5?: string;\r\n}\r\n\r\nexport class CiSocketController extends CiBaseController {\r\n  public sockets: Array<Socket> = reactive(\r\n    [\r\n      {\r\n        type: 'e1603', // e1603=IKEA\r\n        id: 'se1arA',\r\n        name: 'A',\r\n        iSocketState: -9, // 0x9999FF,\r\n        battery: '-',\r\n        text5: 'socketA',\r\n        subTopic: 'zb/h/dose/e1603a',\r\n        pubTopic: 'zb/h/dose/e1603a/set',\r\n        pubPayload: '{\"state\": \"TOGGLE\"}'\r\n      },\r\n      {\r\n        type: 'e1603', // e1603=IKEA\r\n        id: 'se1arB',\r\n        name: 'B',\r\n        iSocketState: -9, // 0x9999FF,\r\n        battery: '-',\r\n        text5: 'socketB',\r\n        subTopic: 'zb/h/dose/e1603b',\r\n        pubTopic: 'zb/h/dose/e1603b/set',\r\n        pubPayload: '{\"state\": \"TOGGLE\"}'\r\n      },\r\n      {\r\n        type: 'e1603', // e1603=IKEA\r\n        id: 'se1arC',\r\n        name: 'C',\r\n        iSocketState: -9, // 0x9999FF,\r\n        battery: '-',\r\n        text5: 'socketC',\r\n        subTopic: 'zb/h/dose/e1603c',\r\n        pubTopic: 'zb/h/dose/e1603c/set',\r\n        pubPayload: '{\"state\": \"TOGGLE\"}'\r\n      }\r\n    ]\r\n  );\r\n\r\n  public onMessage (message: Message): void {\r\n    this.sockets.forEach(socket => {\r\n      const aSubTopic = socket.subTopic.split(' ')\r\n      if (aSubTopic.includes(message.topic)) {\r\n        // ---socket found ---------------------------------\r\n        if (socket.type === 'e1603') {\r\n          const aPayload = JSON.parse(message.payload)\r\n          if ((aPayload.state === 'ON') || (aPayload.state === 'on')) socket.iSocketState = -1\r\n          else {\r\n            if ((aPayload.state === 'OFF') || (aPayload.state === 'off')) socket.iSocketState = -2\r\n            else { socket.iSocketState = -9 }\r\n          }\r\n        }\r\n        // console.log('CiSocketController:onMessage: message.payload=', message.payload)\r\n      }\r\n    })\r\n  }\r\n\r\n  public publishCi (topic: string, payload: string): void {\r\n    // console.log('CiSocketController:publishCi:', '-t ' + topic + ' -m ' + payload)\r\n    this.publish(topic, payload, false, 0).catch((e) => { console.error('CiSocketController: ERROR:', e) })\r\n  }\r\n}\r\n\r\nexport const ciSocketController = new CiSocketController()\r\n"]}]}