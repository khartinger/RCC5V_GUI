{"remainingRequest":"G:\\work3\\vue\\haus2\\node_modules\\thread-loader\\dist\\cjs.js!G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js??ref--13-2!G:\\work3\\vue\\haus2\\src\\controller\\CiBlindController.ts","dependencies":[{"path":"G:\\work3\\vue\\haus2\\src\\controller\\CiBlindController.ts","mtime":1672656756761},{"path":"G:\\work3\\vue\\haus2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus2\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgX19leHRlbmRzIH0gZnJvbSAidHNsaWIiOw0KLy8gX19fX19fQ2lCbGluZENvbnRyb2xsZXIudHNfX19fX19fX19fX19fX19fX19fX2toYXJ0aW5nZXJfX19fXw0KLy8gMjAyMi0wOS0xNDogYWRkIC5jYXRjaCgoZSkgLi4pIHRvIHRoaXMucHVibGlzaA0KLy8gMjAyMy0wMS0wMjogaW1wb3J0IHsgZ2VvMCB9IGNoYW5nZWQNCmltcG9ydCB7IHJlYWN0aXZlIH0gZnJvbSAndnVlJzsNCmltcG9ydCB7IENpQmFzZUNvbnRyb2xsZXIgfSBmcm9tICcuL0NpQmFzZUNvbnRyb2xsZXInOw0KdmFyIENpQmxpbmRDb250cm9sbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgew0KICAgIF9fZXh0ZW5kcyhDaUJsaW5kQ29udHJvbGxlciwgX3N1cGVyKTsNCiAgICBmdW5jdGlvbiBDaUJsaW5kQ29udHJvbGxlcigpIHsNCiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7DQogICAgICAgIF90aGlzLmJsaW5kcyA9IHJlYWN0aXZlKFsNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZDogJ3JlMXZvMScsDQogICAgICAgICAgICAgICAgbmFtZTogJ1JvbGxvID8nLA0KICAgICAgICAgICAgICAgIGlCbGluZFN0YXRlOiAtMSwNCiAgICAgICAgICAgICAgICB0eXBlOiAnemInLA0KICAgICAgICAgICAgICAgIGJhdHRlcnk6ICctJywNCiAgICAgICAgICAgICAgICBzdWJUb3BpYzogJ3piL2gvZTEvdm8vcm9sbG96dSBlMS9oL3ZvL3JvbGxvJywNCiAgICAgICAgICAgICAgICBwdWJUb3BpYzogJycNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgaWQ6ICdyZTF3bzEnLA0KICAgICAgICAgICAgICAgIG5hbWU6ICdSb2xsbyA/JywNCiAgICAgICAgICAgICAgICBpQmxpbmRTdGF0ZTogLTEsDQogICAgICAgICAgICAgICAgdHlwZTogJ3piJywNCiAgICAgICAgICAgICAgICBiYXR0ZXJ5OiAnLScsDQogICAgICAgICAgICAgICAgc3ViVG9waWM6ICd6Yi9oL2UxL3dvL3JvbGxvenUgZTEvaC93by9yb2xsbycsDQogICAgICAgICAgICAgICAgcHViVG9waWM6ICcnDQogICAgICAgICAgICB9DQogICAgICAgIF0pOw0KICAgICAgICByZXR1cm4gX3RoaXM7DQogICAgfQ0KICAgIC8vIC0tLS0tLS0tLU1lc3NhZ2UgZm9yIHRoaXMgY2kgKGNvbnRyb2wvaW5kaWNhdG9yKT8tLS0tLS0tLS0tDQogICAgQ2lCbGluZENvbnRyb2xsZXIucHJvdG90eXBlLm9uTWVzc2FnZSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7DQogICAgICAgIHRoaXMuYmxpbmRzLmZvckVhY2goZnVuY3Rpb24gKGJsaW5kKSB7DQogICAgICAgICAgICB2YXIgYVN1YlRvcGljID0gYmxpbmQuc3ViVG9waWMuc3BsaXQoJyAnKTsNCiAgICAgICAgICAgIGlmIChhU3ViVG9waWMuaW5jbHVkZXMobWVzc2FnZS50b3BpYykpIHsNCiAgICAgICAgICAgICAgICAvLyAtLS1ibGluZCB0b3BpYyBmb3VuZCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgICAgICAgICBpZiAoYmxpbmQudHlwZSA9PT0gJ3piJykgew0KICAgICAgICAgICAgICAgICAgICB2YXIgYVBheWxvYWQgPSBKU09OLnBhcnNlKG1lc3NhZ2UucGF5bG9hZCk7DQogICAgICAgICAgICAgICAgICAgIGJsaW5kLmJhdHRlcnkgPSAiIiArIGFQYXlsb2FkLmJhdHRlcnk7DQogICAgICAgICAgICAgICAgICAgIHZhciBkb29yc3RhdGVfID0gU3RyaW5nKGFQYXlsb2FkLmNvbnRhY3QpOw0KICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnZG9vcnN0YXRlOicsIGRvb3JzdGF0ZV8pDQogICAgICAgICAgICAgICAgICAgIGlmIChkb29yc3RhdGVfID09PSAndHJ1ZScpDQogICAgICAgICAgICAgICAgICAgICAgICBibGluZC5pQmxpbmRTdGF0ZSA9IDA7DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRvb3JzdGF0ZV8gPT09ICdmYWxzZScpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxpbmQuaUJsaW5kU3RhdGUgPSAxOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJsaW5kLmlCbGluZFN0YXRlID0gLTE7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ0Rvb3JDb250cm9sbGVyOm9uTWVzc2FnZSgpLXpiJywgZG9vci5pRG9vclN0YXRlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IC8vIEVORCBibGluZCB0b3BpYyBmb3VuZA0KICAgICAgICB9KTsNCiAgICB9Ow0KICAgIENpQmxpbmRDb250cm9sbGVyLnByb3RvdHlwZS5wdWJsaXNoQ2kgPSBmdW5jdGlvbiAodG9waWMsIHBheWxvYWQpIHsNCiAgICAgICAgLy8gY29uc29sZS5sb2coJ3B1Ymxpc2g6JywgJy10ICcgKyB0b3BpYyArICcgLW0gJyArIHBheWxvYWQpDQogICAgICAgIHRoaXMucHVibGlzaCh0b3BpYywgcGF5bG9hZCwgZmFsc2UsIDApLmNhdGNoKGZ1bmN0aW9uIChlKSB7IGNvbnNvbGUuZXJyb3IoJ0NpQmxpbmRDb250cm9sbGVyOiBFUlJPUjonLCBlKTsgfSk7DQogICAgfTsNCiAgICByZXR1cm4gQ2lCbGluZENvbnRyb2xsZXI7DQp9KENpQmFzZUNvbnRyb2xsZXIpKTsNCmV4cG9ydCB7IENpQmxpbmRDb250cm9sbGVyIH07DQpleHBvcnQgdmFyIGNpQmxpbmRDb250cm9sbGVyID0gbmV3IENpQmxpbmRDb250cm9sbGVyKCk7DQo="},{"version":3,"file":"G:\\work3\\vue\\haus2\\src\\controller\\CiBlindController.ts","sourceRoot":"","sources":["G:\\work3\\vue\\haus2\\src\\controller\\CiBlindController.ts"],"names":[],"mappings":";AAAA,gEAAgE;AAChE,iDAAiD;AACjD,sCAAsC;AACtC,OAAO,EAAE,QAAQ,EAAE,MAAM,KAAK,CAAA;AAE9B,OAAO,EAAE,gBAAgB,EAAS,MAAM,oBAAoB,CAAA;AAS5D;IAAuC,qCAAgB;IAAvD;QAAA,qEAkDC;QAjDQ,YAAM,GAAiB,QAAQ,CACpC;YACE;gBACE,EAAE,EAAE,QAAQ;gBACZ,IAAI,EAAE,SAAS;gBACf,WAAW,EAAE,CAAC,CAAC;gBACf,IAAI,EAAE,IAAI;gBACV,OAAO,EAAE,GAAG;gBACZ,QAAQ,EAAE,kCAAkC;gBAC5C,QAAQ,EAAE,EAAE;aACb;YACD;gBACE,EAAE,EAAE,QAAQ;gBACZ,IAAI,EAAE,SAAS;gBACf,WAAW,EAAE,CAAC,CAAC;gBACf,IAAI,EAAE,IAAI;gBACV,OAAO,EAAE,GAAG;gBACZ,QAAQ,EAAE,kCAAkC;gBAC5C,QAAQ,EAAE,EAAE;aACb;SACF,CACF,CAAC;;IA4BJ,CAAC;IA1BC,8DAA8D;IACvD,qCAAS,GAAhB,UAAkB,OAAgB;QAChC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,UAAA,KAAK;YACvB,IAAM,SAAS,GAAG,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;YAC3C,IAAI,SAAS,CAAC,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE;gBACrC,yDAAyD;gBACzD,IAAI,KAAK,CAAC,IAAI,KAAK,IAAI,EAAE;oBACvB,IAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,CAAA;oBAC5C,KAAK,CAAC,OAAO,GAAG,KAAG,QAAQ,CAAC,OAAS,CAAA;oBACrC,IAAM,UAAU,GAAG,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAA;oBAC3C,wCAAwC;oBACxC,IAAI,UAAU,KAAK,MAAM;wBAAE,KAAK,CAAC,WAAW,GAAG,CAAC,CAAA;yBAC3C;wBACH,IAAI,UAAU,KAAK,OAAO;4BAAE,KAAK,CAAC,WAAW,GAAG,CAAC,CAAA;;4BAC5C,KAAK,CAAC,WAAW,GAAG,CAAC,CAAC,CAAA;qBAC5B;oBACD,iEAAiE;iBAClE;aACF,CAAC,wBAAwB;QAC5B,CAAC,CAAC,CAAA;IACJ,CAAC;IAEM,qCAAS,GAAhB,UAAkB,KAAa,EAAE,OAAe;QAC9C,4DAA4D;QAC5D,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,UAAC,CAAC,IAAO,OAAO,CAAC,KAAK,CAAC,2BAA2B,EAAE,CAAC,CAAC,CAAA,CAAC,CAAC,CAAC,CAAA;IACxG,CAAC;IACH,wBAAC;AAAD,CAAC,AAlDD,CAAuC,gBAAgB,GAkDtD;;AAED,MAAM,CAAC,IAAM,iBAAiB,GAAG,IAAI,iBAAiB,EAAE,CAAA","sourcesContent":["// ______CiBlindController.ts____________________khartinger_____\r\n// 2022-09-14: add .catch((e) ..) to this.publish\r\n// 2023-01-02: import { geo0 } changed\r\nimport { reactive } from 'vue'\r\nimport { Message } from '@/services/CiMqttClient'\r\nimport { CiBaseController, IBase } from './CiBaseController'\r\nexport interface Blind extends IBase {\r\n  iBlindState: number;\r\n  type: string;\r\n  iMotorState?: number;\r\n  battery?: string;\r\n  text5?: string;\r\n}\r\n\r\nexport class CiBlindController extends CiBaseController {\r\n  public blinds: Array<Blind> = reactive(\r\n    [\r\n      {\r\n        id: 're1vo1',\r\n        name: 'Rollo ?',\r\n        iBlindState: -1,\r\n        type: 'zb',\r\n        battery: '-',\r\n        subTopic: 'zb/h/e1/vo/rollozu e1/h/vo/rollo',\r\n        pubTopic: ''\r\n      },\r\n      {\r\n        id: 're1wo1',\r\n        name: 'Rollo ?',\r\n        iBlindState: -1,\r\n        type: 'zb',\r\n        battery: '-',\r\n        subTopic: 'zb/h/e1/wo/rollozu e1/h/wo/rollo',\r\n        pubTopic: ''\r\n      }\r\n    ]\r\n  );\r\n\r\n  // ---------Message for this ci (control/indicator)?----------\r\n  public onMessage (message: Message): void {\r\n    this.blinds.forEach(blind => {\r\n      const aSubTopic = blind.subTopic.split(' ')\r\n      if (aSubTopic.includes(message.topic)) {\r\n        // ---blind topic found ---------------------------------\r\n        if (blind.type === 'zb') {\r\n          const aPayload = JSON.parse(message.payload)\r\n          blind.battery = `${aPayload.battery}`\r\n          const doorstate_ = String(aPayload.contact)\r\n          // console.log('doorstate:', doorstate_)\r\n          if (doorstate_ === 'true') blind.iBlindState = 0\r\n          else {\r\n            if (doorstate_ === 'false') blind.iBlindState = 1\r\n            else blind.iBlindState = -1\r\n          }\r\n          // console.log('DoorController:onMessage()-zb', door.iDoorState);\r\n        }\r\n      } // END blind topic found\r\n    })\r\n  }\r\n\r\n  public publishCi (topic: string, payload: string): void {\r\n    // console.log('publish:', '-t ' + topic + ' -m ' + payload)\r\n    this.publish(topic, payload, false, 0).catch((e) => { console.error('CiBlindController: ERROR:', e) })\r\n  }\r\n}\r\n\r\nexport const ciBlindController = new CiBlindController()\r\n"]}]}