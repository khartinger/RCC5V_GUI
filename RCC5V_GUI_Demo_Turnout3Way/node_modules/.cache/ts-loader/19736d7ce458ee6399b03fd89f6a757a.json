{"remainingRequest":"G:\\work3\\vue\\haus2\\node_modules\\thread-loader\\dist\\cjs.js!G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js??ref--13-2!G:\\work3\\vue\\haus2\\src\\controller\\CiWindowController.ts","dependencies":[{"path":"G:\\work3\\vue\\haus2\\src\\controller\\CiWindowController.ts","mtime":1641046621773},{"path":"G:\\work3\\vue\\haus2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus2\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgX19leHRlbmRzIH0gZnJvbSAidHNsaWIiOw0KLy8gX19fX19fQ2lXaW5kb3dDb250cm9sbGVyLnRzX19fX19fX19fX19fX19fX19fXzIwMjItMDEtMDFfX19fXw0KaW1wb3J0IHsgcmVhY3RpdmUgfSBmcm9tICd2dWUnOw0KaW1wb3J0IHsgQ2lCYXNlQ29udHJvbGxlciB9IGZyb20gJy4vQ2lCYXNlQ29udHJvbGxlcic7DQp2YXIgQ2lXaW5kb3dDb250cm9sbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgew0KICAgIF9fZXh0ZW5kcyhDaVdpbmRvd0NvbnRyb2xsZXIsIF9zdXBlcik7DQogICAgZnVuY3Rpb24gQ2lXaW5kb3dDb250cm9sbGVyKCkgew0KICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpczsNCiAgICAgICAgX3RoaXMud2luZG93cyA9IHJlYWN0aXZlKFsNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZDogJ2ZvMnNsMXpiJywNCiAgICAgICAgICAgICAgICBuYW1lOiAnS2lwcGZlbnN0ZXInLA0KICAgICAgICAgICAgICAgIGlXaW5kb3dTdGF0ZTogLTEsDQogICAgICAgICAgICAgICAgdHlwZTogJ3piJywNCiAgICAgICAgICAgICAgICBiYXR0ZXJ5OiAnLScsDQogICAgICAgICAgICAgICAgc3ViVG9waWM6ICd6Yi9oL28yL3NsL2ZlbnN0ZXIvLTEnLA0KICAgICAgICAgICAgICAgIHB1YlRvcGljOiAnJw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZDogJ3RlMWFyMXpiJywNCiAgICAgICAgICAgICAgICBuYW1lOiAnVEVTVF9aQicsDQogICAgICAgICAgICAgICAgaVdpbmRvd1N0YXRlOiAtMSwNCiAgICAgICAgICAgICAgICB0eXBlOiAnemInLA0KICAgICAgICAgICAgICAgIGJhdHRlcnk6ICctJywNCiAgICAgICAgICAgICAgICBzdWJUb3BpYzogJ3piL2gvYXovdHVlcmUvLTEnLA0KICAgICAgICAgICAgICAgIHB1YlRvcGljOiAnJw0KICAgICAgICAgICAgfQ0KICAgICAgICBdKTsNCiAgICAgICAgcmV0dXJuIF90aGlzOw0KICAgIH0NCiAgICAvLyAtLS0tLS0tLS1NZXNzYWdlIGZvciB0aGlzIGNpIChjb250cm9sL2luZGljYXRvcik/LS0tLS0tLS0tLQ0KICAgIENpV2luZG93Q29udHJvbGxlci5wcm90b3R5cGUub25NZXNzYWdlID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHsNCiAgICAgICAgdGhpcy53aW5kb3dzLmZvckVhY2goZnVuY3Rpb24gKHdpbmRvdykgew0KICAgICAgICAgICAgdmFyIGFTdWJUb3BpYyA9IHdpbmRvdy5zdWJUb3BpYy5zcGxpdCgnICcpOw0KICAgICAgICAgICAgaWYgKGFTdWJUb3BpYy5pbmNsdWRlcyhtZXNzYWdlLnRvcGljKSkgew0KICAgICAgICAgICAgICAgIC8vIC0tLXdpbmRvdyB0b3BpYyBmb3VuZCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgICAgICAgICAgICAgICBpZiAod2luZG93LnR5cGUgPT09ICd6YicpIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGFQYXlsb2FkID0gSlNPTi5wYXJzZShtZXNzYWdlLnBheWxvYWQpOw0KICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYmF0dGVyeSA9ICIiICsgYVBheWxvYWQuYmF0dGVyeTsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHdpbmRvd3N0YXRlXyA9IFN0cmluZyhhUGF5bG9hZC5jb250YWN0KTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvd3N0YXRlXyA9PT0gJ3RydWUnKQ0KICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmlXaW5kb3dTdGF0ZSA9IDA7DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvd3N0YXRlXyA9PT0gJ2ZhbHNlJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuaVdpbmRvd1N0YXRlID0gMTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuaVdpbmRvd1N0YXRlID0gLTE7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ1dpbmRvd0NvbnRyb2xsZXI6b25NZXNzYWdlKCktemInLCB3aW5kb3cuaVdpbmRvd1N0YXRlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy50eXBlID09PSAnRDEnKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdXaW5kb3dDb250cm9sbGVyOm9uTWVzc2FnZSgpLUQxOiAnLCAid2luZG93IGZvdW5kICIgKyBtZXNzYWdlLnRvcGljICsgInwiICsgbWVzc2FnZS5wYXlsb2FkKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudG9waWMuaW5jbHVkZXMoJ3N0YXR1cycpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKG1lc3NhZ2UucGF5bG9hZCA9PT0gJzEnKSB8fCAobWVzc2FnZS5wYXlsb2FkID09PSAnZWluJykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuaVdpbmRvd1N0YXRlID0gMTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgobWVzc2FnZS5wYXlsb2FkID09PSAnMCcpIHx8IChtZXNzYWdlLnBheWxvYWQgPT09ICdhdXMnKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuaVdpbmRvd1N0YXRlID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5pV2luZG93U3RhdGUgPSAtMTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UudG9waWMuaW5jbHVkZXMoJ3ZvbHRhZ2UnKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmJhdHRlcnkgPSAiIiArIG1lc3NhZ2UucGF5bG9hZDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gLy8gRU5EIHdpbmRvdyB0b3BpYyBmb3VuZA0KICAgICAgICB9KTsNCiAgICB9Ow0KICAgIENpV2luZG93Q29udHJvbGxlci5wcm90b3R5cGUucHVibGlzaENpID0gZnVuY3Rpb24gKHRvcGljLCBwYXlsb2FkKSB7DQogICAgICAgIC8vIGNvbnNvbGUubG9nKCdwdWJsaXNoOicsICctdCAnICsgdG9waWMgKyAnIC1tICcgKyBwYXlsb2FkKQ0KICAgICAgICB0aGlzLnB1Ymxpc2godG9waWMsIHBheWxvYWQsIGZhbHNlLCAwKTsNCiAgICB9Ow0KICAgIHJldHVybiBDaVdpbmRvd0NvbnRyb2xsZXI7DQp9KENpQmFzZUNvbnRyb2xsZXIpKTsNCmV4cG9ydCB7IENpV2luZG93Q29udHJvbGxlciB9Ow0KZXhwb3J0IHZhciBjaVdpbmRvd0NvbnRyb2xsZXIgPSBuZXcgQ2lXaW5kb3dDb250cm9sbGVyKCk7DQo="},{"version":3,"file":"G:\\work3\\vue\\haus2\\src\\controller\\CiWindowController.ts","sourceRoot":"","sources":["G:\\work3\\vue\\haus2\\src\\controller\\CiWindowController.ts"],"names":[],"mappings":"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","sourcesContent":["// ______CiWindowController.ts___________________2022-01-01_____\r\nimport { reactive } from 'vue'\r\nimport { Message } from '@/services/CiMqttClient'\r\nimport { CiBaseController, IBase } from './CiBaseController'\r\n\r\nexport interface Window extends IBase {\r\n  iWindowState: number;\r\n  type?: string;\r\n  battery?: string;\r\n  text5?: string;\r\n}\r\n\r\nexport class CiWindowController extends CiBaseController {\r\n  public windows: Array<Window> = reactive(\r\n    [\r\n      { // 1. Stock: Bereich 2, Schlafzimmer\r\n        id: 'fo2sl1zb',\r\n        name: 'Kippfenster',\r\n        iWindowState: -1,\r\n        type: 'zb',\r\n        battery: '-',\r\n        subTopic: 'zb/h/o2/sl/fenster/-1',\r\n        pubTopic: ''\r\n      },\r\n      { // TEST\r\n        id: 'te1ar1zb',\r\n        name: 'TEST_ZB',\r\n        iWindowState: -1,\r\n        type: 'zb',\r\n        battery: '-',\r\n        subTopic: 'zb/h/az/tuere/-1',\r\n        pubTopic: ''\r\n      }\r\n    ]\r\n  );\r\n\r\n  // ---------Message for this ci (control/indicator)?----------\r\n  public onMessage (message: Message): void {\r\n    this.windows.forEach(window => {\r\n      const aSubTopic = window.subTopic.split(' ')\r\n      if (aSubTopic.includes(message.topic)) {\r\n        // ---window topic found ---------------------------------\r\n        if (window.type === 'zb') {\r\n          const aPayload = JSON.parse(message.payload)\r\n          window.battery = `${aPayload.battery}`\r\n          const windowstate_ = String(aPayload.contact)\r\n          if (windowstate_ === 'true') window.iWindowState = 0\r\n          else {\r\n            if (windowstate_ === 'false') window.iWindowState = 1\r\n            else window.iWindowState = -1\r\n          }\r\n          // console.log('WindowController:onMessage()-zb', window.iWindowState);\r\n        }\r\n        if (window.type === 'D1') {\r\n          console.log('WindowController:onMessage()-D1: ', `window found ${message.topic}|${message.payload}`);\r\n          if (message.topic.includes('status')) {\r\n            if ((message.payload === '1') || (message.payload === 'ein')) { window.iWindowState = 1 }\r\n            else {\r\n              if ((message.payload === '0') || (message.payload === 'aus')) { window.iWindowState = 0 }\r\n              else { window.iWindowState = -1 }\r\n            }\r\n          }\r\n          if (message.topic.includes('voltage')) {\r\n            window.battery = `${message.payload}`\r\n          }\r\n        }\r\n      } // END window topic found\r\n    })\r\n  }\r\n\r\n  public publishCi (topic: string, payload: string): void {\r\n    // console.log('publish:', '-t ' + topic + ' -m ' + payload)\r\n    this.publish(topic, payload, false, 0)\r\n  }\r\n}\r\n\r\nexport const ciWindowController = new CiWindowController()\r\n"]}]}