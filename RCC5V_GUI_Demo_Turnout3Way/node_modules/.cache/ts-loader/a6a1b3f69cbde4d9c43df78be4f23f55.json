{"remainingRequest":"G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js??ref--13-1!G:\\work3\\vue\\haus2\\src\\controller\\CiRepeaterController.ts","dependencies":[{"path":"G:\\work3\\vue\\haus2\\src\\controller\\CiRepeaterController.ts","mtime":1672657015105},{"path":"G:\\work3\\vue\\haus2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"G:\\work3\\vue\\haus2\\node_modules\\ts-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgX19leHRlbmRzIH0gZnJvbSAidHNsaWIiOw0KLy8gX19fX19fQ2lSZXBlYXRlckNvbnRyb2xsZXIudHNfX19fX19fX19fX19fX19fX2toYXJ0aW5nZXJfX19fXw0KLy8gMjAyMi0xMC0xOTogTmV3DQovLyAyMDIzLTAxLTAyOiBpbXBvcnQgeyBnZW8wIH0gY2hhbmdlZA0KaW1wb3J0IHsgcmVhY3RpdmUgfSBmcm9tICd2dWUnOw0KaW1wb3J0IHsgQ2lCYXNlQ29udHJvbGxlciB9IGZyb20gJy4vQ2lCYXNlQ29udHJvbGxlcic7DQppbXBvcnQgeyBnZW8wIH0gZnJvbSAnLi4vY2xhc3Nlcy9HZW8nOw0KdmFyIENpUmVwZWF0ZXJDb250cm9sbGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikgew0KICAgIF9fZXh0ZW5kcyhDaVJlcGVhdGVyQ29udHJvbGxlciwgX3N1cGVyKTsNCiAgICBmdW5jdGlvbiBDaVJlcGVhdGVyQ29udHJvbGxlcigpIHsNCiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7DQogICAgICAgIF90aGlzLnJlcGVhdGVycyA9IHJlYWN0aXZlKFsNCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICBpZDogJ3JlcGVhdGVyMScsDQogICAgICAgICAgICAgICAgdHlwZTogJ1RSQURGUkknLA0KICAgICAgICAgICAgICAgIG5hbWU6ICdSZXBlYXQxIElLRUEnLA0KICAgICAgICAgICAgICAgIGlSZXBlYXRlclN0YXRlOiAtMSwNCiAgICAgICAgICAgICAgICBiYXR0ZXJ5OiAnLScsDQogICAgICAgICAgICAgICAgbGFzdFJlcGVhdGVyRGF0ZTogJy0tLi0tLi0tJywNCiAgICAgICAgICAgICAgICBsYXN0UmVwZWF0ZXJUaW1lOiAnLS06LS06LS0nLA0KICAgICAgICAgICAgICAgIHN1YlRvcGljOiAnemIvaC9lMS9rdS9yZXBlYXRlciB6Yi9oL2UxL2t1L3JlcGVhdGVyL3RpbWUnLA0KICAgICAgICAgICAgICAgIHB1YlRvcGljOiAnJw0KICAgICAgICAgICAgfQ0KICAgICAgICBdKTsNCiAgICAgICAgcmV0dXJuIF90aGlzOw0KICAgIH0NCiAgICAvLyAtLS0tLS0tLS1NZXNzYWdlIGZvciB0aGlzIGNpIChjb250cm9sL2luZGljYXRvcik/LS0tLS0tLS0tLQ0KICAgIENpUmVwZWF0ZXJDb250cm9sbGVyLnByb3RvdHlwZS5vbk1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSkgew0KICAgICAgICAvLyAtLS0tLS0tc2VhcmNoIGZvciByZXBlYXRlciB0b3BpYy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICB0aGlzLnJlcGVhdGVycy5mb3JFYWNoKGZ1bmN0aW9uIChyZXBlYXRlcikgew0KICAgICAgICAgICAgdmFyIGFTdWJUb3BpYyA9IHJlcGVhdGVyLnN1YlRvcGljLnNwbGl0KCcgJyk7DQogICAgICAgICAgICBpZiAoYVN1YlRvcGljLmluY2x1ZGVzKG1lc3NhZ2UudG9waWMpKSB7DQogICAgICAgICAgICAgICAgLy8gLS0tcmVwZWF0ZXIgdG9waWMgZm91bmQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlLnRvcGljLmluY2x1ZGVzKCd0aW1lJykpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UucGF5bG9hZC5sZW5ndGggPT09IDE1KSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXRlci5sYXN0UmVwZWF0ZXJEYXRlID0gbWVzc2FnZS5wYXlsb2FkLnN1YnN0cmluZyg2LCA4KSArICcuJyArIG1lc3NhZ2UucGF5bG9hZC5zdWJzdHJpbmcoNCwgNikgKyAnLicgKyBtZXNzYWdlLnBheWxvYWQuc3Vic3RyaW5nKDIsIDQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0ZXIubGFzdFJlcGVhdGVyVGltZSA9IG1lc3NhZ2UucGF5bG9hZC5zdWJzdHJpbmcoOSwgMTEpICsgJzonICsgbWVzc2FnZS5wYXlsb2FkLnN1YnN0cmluZygxMSwgMTMpICsgJzonICsgbWVzc2FnZS5wYXlsb2FkLnN1YnN0cmluZygxMywgMTUpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0ZXIubGFzdFJlcGVhdGVyRGF0ZSA9IGdlbzAubm9EYXRlOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0ZXIubGFzdFJlcGVhdGVyVGltZSA9IGdlbzAubm9UaW1lOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2UgeyAvLyAtcmVwZWF0ZXIgaW5mby0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgICAgICAgICAgICAgICAgIHJlcGVhdGVyLmxhc3RSZXBlYXRlckRhdGUgPSBnZW8wLm5vRGF0ZTsNCiAgICAgICAgICAgICAgICAgICAgcmVwZWF0ZXIubGFzdFJlcGVhdGVyVGltZSA9IGdlbzAubm9UaW1lOw0KICAgICAgICAgICAgICAgICAgICBpZiAocmVwZWF0ZXIudHlwZSA9PT0gJ1RSQURGUkknKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgYVBheWxvYWQgPSBKU09OLnBhcnNlKG1lc3NhZ2UucGF5bG9hZCk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXBlYXRlci5pUmVwZWF0ZXJTdGF0ZSA9IC0xOw0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gemIvaC9lMS9rdS9yZXBlYXRlciB7Imxhc3Rfc2VlbiI6IjIwMjItMTAtMTlUMTc6MDM6MDArMDI6MDAiLCJsaW5rcXVhbGl0eSI6NzIsInVwZGF0ZSI6eyJzdGF0ZSI6ImlkbGUifSwidXBkYXRlX2F2YWlsYWJsZSI6ZmFsc2V9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYVBheWxvYWQubGFzdF9zZWVuLmxlbmd0aCA+IDI0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGR0ID0gYVBheWxvYWQubGFzdF9zZWVuOyAvLyAibGFzdF9zZWVuIjoiMjAyMi0xMC0xOVQxNzowMzowMCswMjowMCINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0ZTEgPSBkdC5zdWJzdHJpbmcoOCwgMTApICsgJy4nICsgZHQuc3Vic3RyaW5nKDUsIDcpICsgJy4nICsgZHQuc3Vic3RyaW5nKDIsIDQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdGVyLmxhc3RSZXBlYXRlckRhdGUgPSBkYXRlMTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXRlci5sYXN0UmVwZWF0ZXJUaW1lID0gZHQuc3Vic3RyaW5nKDExLCAxOSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0ZXIuaVJlcGVhdGVyU3RhdGUgPSAxOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdSZXBlYXRlcjonLCBhUGF5bG9hZC5sYXN0X3NlZW4gKyAnID0gJyArIGRhdGUxICsgJyAnICsgZHQuc3Vic3RyaW5nKDExLCAxOSkgKyAnIHN0YXRlPScgKyByZXBlYXRlci5pUmVwZWF0ZXJTdGF0ZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAvLyBpZiAocmVwZWF0ZXIudHlwZSA9PT0gJ0QxJykgew0KICAgICAgICAgICAgICAgICAgICAvLyB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSAvLyBFTkQgcmVwZWF0ZXIgdG9waWMgZm91bmQNCiAgICAgICAgfSk7DQogICAgfTsNCiAgICBDaVJlcGVhdGVyQ29udHJvbGxlci5wcm90b3R5cGUucHVibGlzaENpID0gZnVuY3Rpb24gKHRvcGljLCBwYXlsb2FkKSB7DQogICAgICAgIC8vIGNvbnNvbGUubG9nKCdwdWJsaXNoOicsICctdCAnICsgdG9waWMgKyAnIC1tICcgKyBwYXlsb2FkKQ0KICAgICAgICB0aGlzLnB1Ymxpc2godG9waWMsIHBheWxvYWQsIGZhbHNlLCAwKS5jYXRjaChmdW5jdGlvbiAoZSkgeyBjb25zb2xlLmVycm9yKCdDaVJlcGVhdGVyQ29udHJvbGxlcjogRVJST1I6JywgZSk7IH0pOw0KICAgIH07DQogICAgcmV0dXJuIENpUmVwZWF0ZXJDb250cm9sbGVyOw0KfShDaUJhc2VDb250cm9sbGVyKSk7DQpleHBvcnQgeyBDaVJlcGVhdGVyQ29udHJvbGxlciB9Ow0KZXhwb3J0IHZhciBjaVJlcGVhdGVyQ29udHJvbGxlciA9IG5ldyBDaVJlcGVhdGVyQ29udHJvbGxlcigpOw0K"},{"version":3,"file":"G:\\work3\\vue\\haus2\\src\\controller\\CiRepeaterController.ts","sourceRoot":"","sources":["G:\\work3\\vue\\haus2\\src\\controller\\CiRepeaterController.ts"],"names":[],"mappings":"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","sourcesContent":["// ______CiRepeaterController.ts_________________khartinger_____\r\n// 2022-10-19: New\r\n// 2023-01-02: import { geo0 } changed\r\nimport { reactive } from 'vue'\r\nimport { Message } from '@/services/CiMqttClient'\r\nimport { CiBaseController, IBase } from './CiBaseController'\r\nimport { geo0 } from '../classes/Geo'\r\n\r\nexport interface Repeater extends IBase {\r\n  type: string;\r\n  iRepeaterState: number;\r\n  battery?: string;\r\n  text5?: string;\r\n  lastRepeaterDate: string;\r\n  lastRepeaterTime: string;\r\n}\r\n\r\nexport class CiRepeaterController extends CiBaseController {\r\n  public repeaters: Array<Repeater> = reactive(\r\n    [\r\n      { // Erdgeschoss: Bereich 1, Kueche\r\n        id: 'repeater1',\r\n        type: 'TRADFRI', // IKEA\r\n        name: 'Repeat1 IKEA',\r\n        iRepeaterState: -1,\r\n        battery: '-',\r\n        lastRepeaterDate: '--.--.--',\r\n        lastRepeaterTime: '--:--:--',\r\n        subTopic: 'zb/h/e1/ku/repeater zb/h/e1/ku/repeater/time',\r\n        pubTopic: ''\r\n      }\r\n    ]\r\n  );\r\n\r\n  // ---------Message for this ci (control/indicator)?----------\r\n  public onMessage (message: Message): void {\r\n    // -------search for repeater topic---------------------------\r\n    this.repeaters.forEach(repeater => {\r\n      const aSubTopic = repeater.subTopic.split(' ')\r\n      if (aSubTopic.includes(message.topic)) {\r\n        // ---repeater topic found -------------------------------\r\n        if (message.topic.includes('time')) {\r\n          if (message.payload.length === 15) {\r\n            repeater.lastRepeaterDate = message.payload.substring(6, 8) + '.' + message.payload.substring(4, 6) + '.' + message.payload.substring(2, 4)\r\n            repeater.lastRepeaterTime = message.payload.substring(9, 11) + ':' + message.payload.substring(11, 13) + ':' + message.payload.substring(13, 15)\r\n          } else {\r\n            repeater.lastRepeaterDate = geo0.noDate\r\n            repeater.lastRepeaterTime = geo0.noTime\r\n          }\r\n        } else { // -repeater info--------------------------------\r\n          repeater.lastRepeaterDate = geo0.noDate\r\n          repeater.lastRepeaterTime = geo0.noTime\r\n          if (repeater.type === 'TRADFRI') {\r\n            const aPayload = JSON.parse(message.payload)\r\n            repeater.iRepeaterState = -1\r\n            // zb/h/e1/ku/repeater {\"last_seen\":\"2022-10-19T17:03:00+02:00\",\"linkquality\":72,\"update\":{\"state\":\"idle\"},\"update_available\":false}\r\n            if (aPayload.last_seen.length > 24) {\r\n              const dt = aPayload.last_seen // \"last_seen\":\"2022-10-19T17:03:00+02:00\"\r\n              const date1 = dt.substring(8, 10) + '.' + dt.substring(5, 7) + '.' + dt.substring(2, 4)\r\n              repeater.lastRepeaterDate = date1\r\n              repeater.lastRepeaterTime = dt.substring(11, 19)\r\n              repeater.iRepeaterState = 1\r\n              // console.log('Repeater:', aPayload.last_seen + ' = ' + date1 + ' ' + dt.substring(11, 19) + ' state=' + repeater.iRepeaterState)\r\n            }\r\n          }\r\n          // if (repeater.type === 'D1') {\r\n          // }\r\n        }\r\n      } // END repeater topic found\r\n    })\r\n  }\r\n\r\n  public publishCi (topic: string, payload: string): void {\r\n    // console.log('publish:', '-t ' + topic + ' -m ' + payload)\r\n    this.publish(topic, payload, false, 0).catch((e) => { console.error('CiRepeaterController: ERROR:', e) })\r\n  }\r\n}\r\n\r\nexport const ciRepeaterController = new CiRepeaterController()\r\n"]}]}